import{y as n,A as b,O as X,B as l,C as o,D as t,I as v,J as i,K as u,H as Y,U as D,ay as L,S as y,aA as V,as as Z,aB as tt,a as et}from"./AuthUserStore-67h2FHdL.js";import{S as x}from"./sweetalert2.esm.all-9Qm2jZ7z.js";import{_ as st,b as at}from"./app-CZBZEz52.js";const lt={class:"modal fade",id:"reRegisterModal",tabindex:"-1",role:"dialog","aria-hidden":"true"},ot={class:"modal-dialog modal-xl modal-dialog-scrollable",role:"document"},nt={class:"modal-content"},it={class:"modal-header"},rt=["disabled"],dt={key:0,class:"modal-body"},ut={class:"card mb-3"},ct={class:"card-body py-3"},mt={class:"d-flex flex-wrap justify-content-between"},vt={class:"mb-2"},_t={class:"h6 mb-1"},bt={class:"text-sm text-muted"},ft={class:"text-sm text-muted"},ht={key:0,class:"text-sm text-muted"},pt={class:"text-sm"},gt={class:"mb-1"},kt={class:"badge badge-light border"},yt={key:0,class:"mb-1"},xt={class:"badge badge-info"},wt={class:"row"},Ct={class:"col-md-6 mb-3"},Tt={class:"card h-100"},Pt={class:"card-body d-flex justify-content-center align-items-center"},Ut={class:"photo-frame"},Kt=["src"],jt={key:1,class:"text-muted text-sm"},St={class:"col-md-6 mb-3"},Bt={class:"card h-100"},Dt={class:"card-body d-flex justify-content-center align-items-center"},Lt={class:"photo-frame"},Vt={key:0,class:"w-100 h-100 d-flex flex-column"},Mt=["src"],It={class:"pt-2 text-center"},Rt=["href"],Ft=["src"],Nt={key:2,class:"text-center"},At=["href"],Wt={key:3,class:"text-muted text-sm"},zt={class:"card mb-3"},Gt={class:"card-body"},Ot={class:"d-flex flex-wrap"},Ht=["href"],Jt=["href"],$t=["href"],qt=["href"],Et={key:4,class:"text-muted text-sm"},Qt={class:"card mb-3"},Xt={class:"card-body"},Yt={class:"row"},Zt={class:"col-md-6"},te=["id","onUpdate:modelValue"],ee=["for"],se={class:"col-md-6"},ae=["id","onUpdate:modelValue"],le=["for"],oe={class:"form-group mt-3 mb-0"},ne={class:"form-group"},ie={class:"modal-footer"},re=["disabled"],de=["disabled"],ue={__name:"ReRegisterModal",props:{eventParticipant:Object},emits:["updated","request-draw"],setup(M,{emit:I}){const R=at(),F=n(()=>R.isDevelopment===!0),j=M,N=I,m=n(()=>j.eventParticipant||null),a=n(()=>{var s;return((s=m.value)==null?void 0:s.participant)||null}),p=b(!1),g=b(""),f=b(""),c=b({face_match:!1,nik_match:!1,name_match:!1,birth_match:!1,contingent_match:!1,category_match:!1}),A={face_match:"Wajah sesuai KTP",nik_match:"NIK sesuai",name_match:"Nama sesuai"},W={birth_match:"TTL sesuai",contingent_match:"Kontingen sesuai",category_match:"Cabang/Golongan sesuai"},z=n(()=>c.value.face_match&&c.value.nik_match&&c.value.name_match&&c.value.birth_match),h=s=>typeof s=="string"&&s.trim()!==""?s:null,S=n(()=>{var s;return h((s=a.value)==null?void 0:s.photo_url)}),r=n(()=>{var s;return h((s=a.value)==null?void 0:s.id_card_url)}),w=n(()=>{var s;return h((s=a.value)==null?void 0:s.family_card_url)}),C=n(()=>{var s;return h((s=a.value)==null?void 0:s.bank_book_url)}),T=n(()=>{var s;return h((s=a.value)==null?void 0:s.certificate_url)}),P=n(()=>{var s;return h((s=a.value)==null?void 0:s.other_url)}),B=n(()=>a.value?[a.value.address,a.value.village_name,a.value.district_name,a.value.regency_name,a.value.province_name].filter(Boolean).join(", "):""),G=s=>String(s).split("?")[0].toLowerCase().endsWith(".pdf"),O=s=>[".jpg",".jpeg",".png",".webp",".gif"].some(e=>String(s).split("?")[0].toLowerCase().endsWith(e)),H=n(()=>r.value&&G(r.value)),J=n(()=>r.value&&O(r.value));b([]);const q=b(!1),U=b(null);n(()=>U.value==null?"":U.value%2===0?"even":"odd");const E=async()=>{var s,e;if(!f.value){x.fire("Pilih keputusan","Silakan pilih ACC atau Tolak.","warning");return}if(!F.value&&f.value==="verified"&&!z.value){x.fire("Checklist belum lengkap","Lengkapi checklist inti sebelum ACC.","warning");return}p.value=!0;try{await et.post(`/api/v1/event-participants/${m.value.id}/re-registration`,{reregistration_status:f.value,reregistration_notes:g.value||null}),$("#reRegisterModal").modal("hide"),await x.fire({icon:"success",title:"Berhasil",text:"Daftar ulang peserta berhasil diproses.",timer:1500,showConfirmButton:!1}),N("updated")}catch(k){x.fire("Gagal",((e=(s=k.response)==null?void 0:s.data)==null?void 0:e.message)||"Terjadi kesalahan.","error")}finally{p.value=!1}},Q=s=>s==="verified"?"badge-success":s==="rejected"?"badge-danger":"badge-secondary";return X(()=>j.eventParticipant,()=>{g.value="",f.value="",U.value=null,q.value=!1,c.value={face_match:!1,nik_match:!1,name_match:!1,birth_match:!1,contingent_match:!1,category_match:!1}}),(s,e)=>{var k;return o(),l("div",lt,[t("div",ot,[t("div",nt,[t("div",it,[e[3]||(e[3]=t("div",null,[t("h5",{class:"modal-title"},"Proses Daftar Ulang"),t("div",{class:"text-sm text-muted"}," Cocokkan wajah (photo_url) dengan KTP (id_card_url) dan validasi data peserta. ")],-1)),t("button",{type:"button",class:"close","data-dismiss":"modal",disabled:p.value},e[2]||(e[2]=[t("span",null,"×",-1)]),8,rt)]),m.value&&a.value?(o(),l("div",dt,[t("div",ut,[t("div",ct,[t("div",mt,[t("div",vt,[t("div",_t,i(a.value.full_name),1),t("div",bt,[e[4]||(e[4]=u(" NIK: ")),t("strong",null,i(a.value.nik),1),e[5]||(e[5]=t("span",{class:"mx-2"},"•",-1)),e[6]||(e[6]=u(" JK: ")),t("strong",null,i(a.value.gender),1),e[7]||(e[7]=t("span",{class:"mx-2"},"•",-1)),e[8]||(e[8]=u(" HP: ")),t("strong",null,i(a.value.phone_number||"-"),1)]),t("div",ft,[e[9]||(e[9]=u(" TTL: ")),t("strong",null,i(a.value.place_of_birth),1),e[10]||(e[10]=u(", ")),t("strong",null,i(a.value.date_of_birth),1)]),B.value?(o(),l("div",ht," Alamat: "+i(B.value),1)):v("",!0)]),t("div",pt,[t("div",gt,[e[11]||(e[11]=u(" Kontingen: ")),t("span",kt,i(m.value.contingent||"-"),1)]),m.value.event_category?(o(),l("div",yt,[e[12]||(e[12]=u(" Cabang/Golongan: ")),t("span",xt,i(((k=m.value.event_category)==null?void 0:k.full_name)||"-"),1)])):v("",!0),t("div",null,[e[13]||(e[13]=u(" Status sekarang: ")),t("span",{class:Y(["badge",Q(m.value.reregistration_status)])},i(m.value.reregistration_status),3)])])])])]),t("div",wt,[t("div",Ct,[t("div",Tt,[e[14]||(e[14]=t("div",{class:"card-header py-2"},[t("strong",null,"Foto Wajah"),t("small",{class:"text-muted"},"(photo_url)")],-1)),t("div",Pt,[t("div",Ut,[S.value?(o(),l("img",{key:0,src:S.value,alt:"Foto Wajah",loading:"lazy"},null,8,Kt)):(o(),l("div",jt," Tidak ada foto wajah "))])])])]),t("div",St,[t("div",Bt,[e[18]||(e[18]=t("div",{class:"card-header py-2"},[t("strong",null,"Foto KTP"),t("small",{class:"text-muted"},"(id_card_url)")],-1)),t("div",Dt,[t("div",Lt,[r.value&&H.value?(o(),l("div",Vt,[t("iframe",{class:"pdf-frame flex-grow-1",src:r.value,title:"KTP PDF"},null,8,Mt),t("div",It,[t("a",{class:"btn btn-outline-primary btn-sm",href:r.value,target:"_blank"},e[15]||(e[15]=[t("i",{class:"far fa-file-pdf mr-1"},null,-1),u(" Buka PDF ")]),8,Rt)])])):r.value&&J.value?(o(),l("img",{key:1,src:r.value,alt:"Foto KTP",loading:"lazy"},null,8,Ft)):r.value?(o(),l("div",Nt,[e[17]||(e[17]=t("div",{class:"text-muted text-sm mb-2"}," Dokumen KTP tidak bisa dipreview ",-1)),t("a",{class:"btn btn-outline-primary btn-sm",href:r.value,target:"_blank"},e[16]||(e[16]=[t("i",{class:"far fa-file mr-1"},null,-1),u(" Buka Dokumen ")]),8,At)])):(o(),l("div",Wt," Tidak ada foto KTP "))])])])])]),t("div",zt,[e[19]||(e[19]=t("div",{class:"card-header py-2"},[t("strong",null,"Lampiran Lainnya")],-1)),t("div",Gt,[t("div",Ot,[w.value?(o(),l("a",{key:0,class:"btn btn-outline-secondary btn-sm mr-2 mb-2",href:w.value,target:"_blank"},"KK",8,Ht)):v("",!0),C.value?(o(),l("a",{key:1,class:"btn btn-outline-secondary btn-sm mr-2 mb-2",href:C.value,target:"_blank"},"Buku Tabungan",8,Jt)):v("",!0),T.value?(o(),l("a",{key:2,class:"btn btn-outline-secondary btn-sm mr-2 mb-2",href:T.value,target:"_blank"},"Sertifikat",8,$t)):v("",!0),P.value?(o(),l("a",{key:3,class:"btn btn-outline-secondary btn-sm mr-2 mb-2",href:P.value,target:"_blank"},"Lainnya",8,qt)):v("",!0),!w.value&&!C.value&&!T.value&&!P.value?(o(),l("span",Et," Tidak ada lampiran tambahan ")):v("",!0)])])]),t("div",Qt,[e[21]||(e[21]=t("div",{class:"card-header py-2"},[t("strong",null,"Checklist Verifikasi")],-1)),t("div",Xt,[t("div",Yt,[t("div",Zt,[(o(),l(D,null,L(A,(_,d)=>t("div",{class:"custom-control custom-checkbox mb-2",key:d},[y(t("input",{class:"custom-control-input",type:"checkbox",id:d,"onUpdate:modelValue":K=>c.value[d]=K},null,8,te),[[V,c.value[d]]]),t("label",{class:"custom-control-label text-sm",for:d},i(_),9,ee)])),64))]),t("div",se,[(o(),l(D,null,L(W,(_,d)=>t("div",{class:"custom-control custom-checkbox mb-2",key:d},[y(t("input",{class:"custom-control-input",type:"checkbox",id:d,"onUpdate:modelValue":K=>c.value[d]=K},null,8,ae),[[V,c.value[d]]]),t("label",{class:"custom-control-label text-sm",for:d},i(_),9,le)])),64))])]),t("div",oe,[e[20]||(e[20]=t("label",{class:"text-sm mb-1"},"Catatan Verifikator",-1)),y(t("textarea",{"onUpdate:modelValue":e[0]||(e[0]=_=>g.value=_),class:"form-control",rows:"3",placeholder:"Catatan verifikasi"},null,512),[[Z,g.value]])])])]),t("div",ne,[e[23]||(e[23]=t("label",{class:"text-sm"},"Keputusan",-1)),y(t("select",{"onUpdate:modelValue":e[1]||(e[1]=_=>f.value=_),class:"form-control"},e[22]||(e[22]=[t("option",{value:""},"-- pilih keputusan --",-1),t("option",{value:"verified"},"ACC / Terima",-1),t("option",{value:"rejected"},"Tolak",-1)]),512),[[tt,f.value]])])])):v("",!0),t("div",ie,[t("button",{type:"button",class:"btn btn-light","data-dismiss":"modal",disabled:p.value}," Tutup ",8,re),t("button",{type:"button",class:"btn btn-primary",disabled:p.value,onClick:E}," Submit ",8,de)])])])])}}},_e=st(ue,[["__scopeId","data-v-5d63dc05"]]);export{_e as R};
