import{B as w,F as h,G as K,J as ot,P as o,Q as l,R as t,W as F,Z as C,U as u,T as J,ah as G,av as Q,a5 as f,aw as b,ap as lt,ax as it,S as rt}from"./pinia-BDOwh8JO.js";import{_ as ut,u as dt,c as ct,b as L,a as mt}from"./app-D-g1j7c6.js";import{S as W}from"./sweetalert2.esm.all-9Qm2jZ7z.js";const vt={class:"content-header"},_t={class:"container-fluid"},pt={class:"d-flex justify-content-between align-items-center"},gt={class:"mb-0 text-muted text-sm"},ht={key:0,class:"ml-2"},ft=["disabled"],bt={class:"row mt-3"},yt={class:"col-md-12 mb-2"},xt=["disabled"],kt=["label"],St=["value"],wt={key:0,class:"text-muted"},Ct={class:"row"},Ut={class:"col-md-6 mb-2"},At=["placeholder","disabled"],Mt={class:"col-md-3 mb-2"},Et=["disabled"],Nt={class:"col-md-3 mb-2"},Tt=["disabled"],jt={key:0,class:"mb-2"},Bt={class:"nav nav-pills"},Kt=["onClick"],Pt={class:"badge badge-light border ml-2"},Rt={class:"content"},Vt={class:"container-fluid"},$t={class:"card"},Dt={class:"card-body table-responsive p-0"},It={key:0,class:"table table-bordered table-hover text-sm mb-0"},Ft={class:"thead-light"},Gt={key:0},Lt=["colspan"],qt={key:1},Ot=["colspan"],zt={key:2},Jt=["colspan"],Qt={class:"text-center"},Wt={class:"font-weight-bold"},Zt={class:"text-muted"},Ht={class:"text-sm"},Xt={class:"text-center font-weight-bold"},Yt={class:"text-center"},te={key:1,class:"table table-bordered table-hover text-sm mb-0"},ee={class:"thead-light"},se={key:0},ne=["colspan"],ae={key:1},oe=["colspan"],le={key:2},ie=["colspan"],re={class:"font-weight-bold"},ue={class:"text-muted"},de={class:"d-flex flex-column align-items-center"},ce={class:"btn-group btn-group-sm mt-1"},me=["disabled","onClick"],ve=["disabled","onClick"],_e={class:"text-muted mt-1"},pe={class:"text-center font-weight-bold"},ge={class:"text-center"},he={class:"card-footer text-muted text-sm"},fe={__name:"EventCompetitionScores",setup(be){const U=ct(),Z=mt(),H=dt(),X=w(()=>H.eventData||null),T=w(()=>{var n;return((n=X.value)==null?void 0:n.id)||null}),q=w(()=>String(U.params.id||"")),j=h(!1),O=h([]),c=h(String(U.params.id||"")),A=h(!1),P=h(""),R=h(""),M=h(null),m=h([]),y=h([]),E=n=>Number(n||0).toFixed(2),g=w(()=>{var e;const n=M.value||{};return typeof n.is_team<"u"?!!n.is_team:!!((e=n==null?void 0:n.event_group)!=null&&e.is_team)}),Y=async()=>{if(T.value){j.value=!0;try{const{data:n}=await L.get(`/api/v1/events/${T.value}/competitions/tree`,{params:{search:""}});O.value=n.rounds||[]}catch(n){console.error(n),W.fire("Gagal","Gagal memuat daftar kompetisi.","error")}finally{j.value=!1}}},x=async()=>{const n=c.value||q.value;if(!n){M.value=null,m.value=[],y.value=[];return}A.value=!0;try{const{data:e}=await L.get(`/api/v1/event-competitions/${n}/scores`,{params:{search:P.value||void 0,status:R.value||void 0}});M.value=e.competition,m.value=e.judges||[],y.value=e.participants||[]}finally{A.value=!1}},z=async(n,e)=>{const d=c.value||q.value;!d||!n||(await L.patch(`/api/v1/event-competitions/${d}/scoresheets/${n}`,e),await x())},tt=async n=>{n&&(U.name!=="admin.event.scores.index"||String(U.params.id)!==String(n))&&await Z.replace({name:"admin.event.scores.index",params:{id:String(n)},query:{...U.query}})},k=h("all"),V=w(()=>{var s,v,r;if(g.value)return[{id:"all",name:"SEMUA KONTINGEN",count:(y.value||[]).length}];const n=new Map;for(const a of y.value||[]){const i=a.event_category_id??((s=a.event_category)==null?void 0:s.id)??null,p=a.category_name??((v=a.event_category)==null?void 0:v.category_name)??((r=a.event_category)==null?void 0:r.full_name)??a.category??null;i&&(n.has(String(i))||n.set(String(i),{id:String(i),name:String(p||"Kategori"),count:0}),n.get(String(i)).count++)}const e=Array.from(n.values()),d=a=>{const i=(a||"").toLowerCase();return i.includes("putera")||i.includes("putra")?1:i.includes("puteri")||i.includes("putri")?2:99};return e.sort((a,i)=>{const p=d(a.name),_=d(i.name);return p!==_?p-_:a.name.localeCompare(i.name)}),[{id:"all",name:"SEMUA PESERTA",count:(y.value||[]).length},...e.map(a=>({id:a.id,name:`PESERTA ${a.name.toUpperCase()}`,count:a.count}))]}),B=w(()=>{const n=y.value||[];return k.value==="all"||g.value?n:n.filter(e=>String(e.event_category_id||"")===String(k.value))});K(()=>y.value,()=>{if(k.value==="all")return;(V.value||[]).some(e=>e.id===k.value)||(k.value="all")}),K(()=>g.value,()=>{k.value="all"});const $=w(()=>{var v;if(!g.value)return[];const n=B.value||[],e=new Map;for(const r of n){const a=String(r.contingent||"-");e.has(a)||e.set(a,{contingent:a,members:[],judgeScores:{}});const i=e.get(a);i.members.push(r.full_name||"-");for(const p of m.value||[]){const _=p.id,N=Number(((v=r.scores)==null?void 0:v[_])??0);i.judgeScores[_]||(i.judgeScores[_]=[]),r.scores&&typeof r.scores[_]<"u"&&i.judgeScores[_].push(N)}}const d=[],s=Array.from(e.keys()).sort((r,a)=>r==="-"?1:a==="-"?-1:r.localeCompare(a));for(const r of s){const a=e.get(r),i={};let p=0,_=0;for(const S of m.value||[]){const D=S.id,I=a.judgeScores[D]||[],st=I.length?I.reduce((nt,at)=>nt+at,0)/I.length:0;i[D]=Number(st.toFixed(2)),p+=i[D],_++}const N=_?p/_:0;d.push({contingent:a.contingent,members:a.members,member_count:a.members.length,scores:i,sum_score:Number(p.toFixed(2)),avg_score:Number(N.toFixed(2))})}return d}),et=(n=[],e=6)=>{const d=Array.isArray(n)?n.filter(Boolean):[];return d.length?d.length<=e?d.join(", "):`${d.slice(0,e).join(", ")}, ...`:"-"};return ot(async()=>{if(!T.value){W.fire("Event belum dipilih","Silakan pilih event melalui Portal Event terlebih dahulu.","info");return}await Y(),c.value&&await x()}),K(()=>U.params.id,async n=>{const e=String(n||"");c.value=e,await x()}),K(()=>c.value,async n=>{if(!n){M.value=null,m.value=[],y.value=[];return}await tt(n),await x()}),(n,e)=>{var d;return l(),o(f,null,[t("section",vt,[t("div",_t,[t("div",pt,[t("div",null,[e[3]||(e[3]=t("h1",{class:"mb-1"},"Rekap Nilai Kompetisi",-1)),t("p",gt,[C(u(((d=M.value)==null?void 0:d.full_name)||"Pilih kompetisi terlebih dahulu.")+" ",1),c.value&&M.value?(l(),o("span",ht,[t("span",{class:J(["badge",g.value?"badge-info":"badge-secondary"])},u(g.value?"TEAM / GROUP (By Kontingen)":"INDIVIDU"),3)])):F("",!0)])]),t("button",{class:"btn btn-sm btn-outline-secondary",onClick:x,disabled:A.value||!c.value},e[4]||(e[4]=[t("i",{class:"fas fa-sync"},null,-1),C(" Refresh ")]),8,ft)]),t("div",bt,[t("div",yt,[e[7]||(e[7]=t("label",{class:"mb-1 text-sm"},[C("Kompetisi "),t("span",{class:"text-danger"},"*")],-1)),G(t("select",{"onUpdate:modelValue":e[0]||(e[0]=s=>c.value=s),class:"form-control form-control-sm",disabled:!T.value||j.value},[e[5]||(e[5]=t("option",{value:"",disabled:""},"-- Pilih Kompetisi --",-1)),(l(!0),o(f,null,b(O.value,s=>(l(),o("optgroup",{key:"round-"+s.id,label:s.name},[(l(!0),o(f,null,b(s.competitions,v=>(l(),o("option",{key:v.id,value:String(v.id)},u(v.full_name),9,St))),128))],8,kt))),128))],8,xt),[[Q,c.value]]),j.value?(l(),o("small",wt,e[6]||(e[6]=[t("i",{class:"fas fa-spinner fa-spin mr-1"},null,-1),C(" Memuat daftar kompetisi... ")]))):F("",!0)])]),t("div",Ct,[t("div",Ut,[G(t("input",{"onUpdate:modelValue":e[1]||(e[1]=s=>P.value=s),class:"form-control form-control-sm",placeholder:g.value?"Cari nama kontingen/anggota...":"Cari nama peserta...",disabled:!c.value,onKeyup:it(x,["enter"])},null,40,At),[[lt,P.value]])]),t("div",Mt,[G(t("select",{"onUpdate:modelValue":e[2]||(e[2]=s=>R.value=s),class:"form-control form-control-sm",disabled:!c.value,onChange:x},e[8]||(e[8]=[t("option",{value:""},"Semua Status",-1),t("option",{value:"draft"},"Draft",-1),t("option",{value:"submitted"},"Submitted",-1),t("option",{value:"locked"},"Locked",-1)]),40,Et),[[Q,R.value]])]),t("div",Nt,[t("button",{class:"btn btn-sm btn-primary w-100",onClick:x,disabled:A.value||!c.value},e[9]||(e[9]=[t("i",{class:"fas fa-search"},null,-1),C(" Filter ")]),8,Tt)])]),c.value&&!g.value&&V.value.length?(l(),o("div",jt,[t("ul",Bt,[(l(!0),o(f,null,b(V.value,s=>(l(),o("li",{class:"nav-item",key:"tab-"+s.id},[t("a",{href:"#",class:J(["nav-link",{active:k.value===s.id}]),onClick:rt(v=>k.value=s.id,["prevent"]),style:{"font-weight":"600"}},[C(u(s.name)+" ",1),t("span",Pt,u(s.count),1)],10,Kt)]))),128))])])):F("",!0)])]),t("section",Rt,[t("div",Vt,[t("div",$t,[t("div",Dt,[g.value?(l(),o("table",It,[t("thead",Ft,[t("tr",null,[e[10]||(e[10]=t("th",{style:{width:"50px"}},"#",-1)),e[11]||(e[11]=t("th",{style:{"min-width":"220px"}},"Kontingen",-1)),e[12]||(e[12]=t("th",{style:{"min-width":"420px"}},"Anggota",-1)),(l(!0),o(f,null,b(m.value,s=>(l(),o("th",{key:s.id,class:"text-center"},u(s.name),1))),128)),e[13]||(e[13]=t("th",{class:"text-center"},"AVG",-1)),e[14]||(e[14]=t("th",{class:"text-center"},"SUM",-1))])]),t("tbody",null,[c.value?A.value?(l(),o("tr",qt,[t("td",{colspan:5+m.value.length,class:"text-center p-3 text-muted"},"Loading...",8,Ot)])):$.value.length===0?(l(),o("tr",zt,[t("td",{colspan:5+m.value.length,class:"text-center p-3 text-muted"},"Tidak ada data.",8,Jt)])):(l(!0),o(f,{key:3},b($.value,(s,v)=>(l(),o("tr",{key:"cont-"+s.contingent},[t("td",Qt,u(v+1),1),t("td",null,[t("div",Wt,u(s.contingent),1),t("small",Zt,u(s.member_count)+" anggota",1)]),t("td",null,[t("div",Ht,u(et(s.members,10)),1)]),(l(!0),o(f,null,b(m.value,r=>{var a;return l(),o("td",{key:r.id,class:"text-center font-weight-bold"},u(E((a=s.scores)==null?void 0:a[r.id])),1)}),128)),t("td",Xt,u(E(s.avg_score)),1),t("td",Yt,u(E(s.sum_score)),1)]))),128)):(l(),o("tr",Gt,[t("td",{colspan:5+m.value.length,class:"text-center p-3 text-muted"}," Silakan pilih kompetisi terlebih dahulu. ",8,Lt)]))])])):(l(),o("table",te,[t("thead",ee,[t("tr",null,[e[15]||(e[15]=t("th",{style:{width:"50px"}},"#",-1)),e[16]||(e[16]=t("th",null,"Peserta",-1)),e[17]||(e[17]=t("th",null,"Kontingen",-1)),(l(!0),o(f,null,b(m.value,s=>(l(),o("th",{key:s.id,class:"text-center"},u(s.name),1))),128)),e[18]||(e[18]=t("th",{class:"text-center"},"AVG",-1)),e[19]||(e[19]=t("th",{class:"text-center"},"SUM",-1))])]),t("tbody",null,[c.value?A.value?(l(),o("tr",ae,[t("td",{colspan:6+m.value.length,class:"text-center p-3 text-muted"},"Loading...",8,oe)])):B.value.length===0?(l(),o("tr",le,[t("td",{colspan:6+m.value.length,class:"text-center p-3 text-muted"},"Tidak ada data.",8,ie)])):(l(!0),o(f,{key:3},b(B.value,(s,v)=>(l(),o("tr",{key:s.event_participant_id||v},[t("td",null,u(v+1),1),t("td",null,[t("div",re,u(s.full_name),1),t("small",ue,u(s.category_name||"-"),1)]),t("td",null,u(s.contingent||"-"),1),(l(!0),o(f,null,b(m.value,r=>{var a,i,p,_;return l(),o("td",{key:r.id,class:"text-center"},[t("div",de,[t("span",null,u(E((a=s.scores)==null?void 0:a[r.id])),1),t("div",ce,[t("button",{class:"btn btn-outline-secondary",disabled:!((i=s.scoresheet_id_by_judge)!=null&&i[r.id]),onClick:N=>{var S;return z((S=s.scoresheet_id_by_judge)==null?void 0:S[r.id],{status:"locked"})},title:"Lock"},e[20]||(e[20]=[t("i",{class:"fas fa-lock"},null,-1)]),8,me),t("button",{class:"btn btn-outline-secondary",disabled:!((p=s.scoresheet_id_by_judge)!=null&&p[r.id]),onClick:N=>{var S;return z((S=s.scoresheet_id_by_judge)==null?void 0:S[r.id],{status:"submitted"})},title:"Unlock (Submitted)"},e[21]||(e[21]=[t("i",{class:"fas fa-unlock"},null,-1)]),8,ve)]),t("small",_e,u(((_=s.status_by_judge)==null?void 0:_[r.id])||"-"),1)])])}),128)),t("td",pe,u(E(s.avg_score)),1),t("td",ge,u(E(s.sum_score)),1)]))),128)):(l(),o("tr",se,[t("td",{colspan:6+m.value.length,class:"text-center p-3 text-muted"}," Silakan pilih kompetisi terlebih dahulu. ",8,ne)]))])]))]),t("div",he,[e[22]||(e[22]=C(" Total: ")),t("strong",null,u(g.value?$.value.length+" kontingen":B.value.length+" peserta"),1)])])])])],64)}}},Se=ut(fe,[["__scopeId","data-v-2ead7b88"]]);export{Se as default};
