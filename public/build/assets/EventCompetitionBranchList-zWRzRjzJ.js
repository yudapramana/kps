import{z as H,A as d,O as P,V as R,B as n,C as i,D as e,K as c,I as T,J as l,S as m,as as y,aB as _,U as b,ay as k,H as D,F as A,a as f,aC as N}from"./AuthUserStore-67h2FHdL.js";import{S as J}from"./sweetalert2.esm.all-9Qm2jZ7z.js";import{_ as Q}from"./app-CZBZEz52.js";const W={class:"content-header"},X={class:"container-fluid"},Y={class:"d-flex justify-content-between align-items-center"},Z={key:0,class:"text-sm text-muted mb-0"},ee={key:0},te={key:1,class:"text-sm text-danger mb-0"},ae={class:"btn-group btn-group-sm"},oe=["disabled"],se={key:0,class:"fas fa-spinner fa-spin mr-1"},le={key:1,class:"fas fa-magic mr-1"},ne=["disabled"],ie={class:"content"},re={class:"container-fluid"},de={class:"card"},ue={class:"card-header"},me={class:"row align-items-center"},pe={class:"col-md-4 mb-2 mb-md-0"},ve={class:"col-md-3 mb-2 mb-md-0"},ce=["value"],_e={class:"col-md-3 mb-2 mb-md-0"},ge=["value"],be={class:"col-md-2 text-right"},fe={class:"text-muted text-sm"},ye={class:"card-body table-responsive p-0"},ke={class:"table table-bordered table-hover text-sm"},xe={key:0},he={key:1},we={key:2},Ce={class:"text-center"},Me={key:0},Ge={key:1},Se={class:"text-center"},Ue={class:"btn-group btn-group-sm"},Be=["onClick"],Ve={key:0,class:"card-footer clearfix"},Ee={class:"d-flex justify-content-between align-items-center"},Pe={class:"text-muted text-sm"},Te={class:"pagination pagination-sm m-0"},De={class:"page-item disabled"},Ae={class:"page-link"},Ie={class:"modal fade",id:"eventBranchModal",tabindex:"-1",role:"dialog"},$e={class:"modal-dialog modal-lg",role:"document"},Fe={class:"modal-content"},Ke={class:"modal-header py-2"},Ne={class:"modal-title",id:"eventBranchModalLabel"},Le={class:"modal-body pt-2"},qe={class:"row"},Oe={class:"col-md-6"},ze={class:"form-group mb-2"},je=["value"],He={class:"form-group mb-2"},Re={class:"text-muted"},Je={class:"form-group mb-2"},Qe=["value"],We={class:"form-group mb-2"},Xe=["value"],Ye={class:"form-group mb-2"},Ze={class:"form-group mb-2"},et={class:"col-md-6"},tt={class:"form-group mb-2"},at={class:"form-group mb-2"},ot={class:"form-group mb-2"},st={class:"form-group mb-2"},lt={class:"form-group mb-0"},nt={class:"text-xs text-muted mb-0"},it={class:"text-end mt-3"},rt=["disabled"],dt={key:0,class:"fas fa-spinner fa-spin me-1"},ut={key:1,class:"fas fa-save me-1"},mt={__name:"EventCompetitionBranchList",setup(pt){const U=H(),x=d([]),r=d({current_page:1,per_page:10,total:0,from:0,to:0,last_page:1}),h=d(""),w=d(""),C=d(""),B=d(!1),M=d(!1),G=d(!1),S=d(!1),p=d(null),u=d(null),o=d({id:null,event_id:null,master_competition_branch_id:null,code:"",master_competition_group_id:null,master_competition_category_id:null,type:"Putra",format:"individu",name:"",max_age:0,order_number:1,description:"",is_active:!0}),V=d([]),E=d([]),L=async()=>{var s,t;if(!u.value){alert("Event belum dipilih. Silakan kembali ke landing dan pilih event terlebih dahulu.");return}if(confirm(`Generate ulang cabang dari template master?
Data cabang event yang ada akan diganti.`)){S.value=!0;try{await f.post(`/api/v1/events/${u.value}/competition-branches/generate-from-master`),await v(1),J.fire({icon:"success",title:"Cabang/golongan event berhasil digenerate dari template master.",showConfirmButton:!1,timer:2e3})}catch(a){console.error("Gagal generate cabang dari master:",a),alert(((t=(s=a.response)==null?void 0:s.data)==null?void 0:t.message)||"Gagal generate cabang dari master.")}finally{S.value=!1}}},q=async()=>{try{const[s,t]=await Promise.all([f.get("/api/v1/master-competition-groups",{params:{per_page:999}}),f.get("/api/v1/master-competition-categories",{params:{per_page:999}})]),a=s.data.data;V.value=a.data||[];const g=t.data.data;E.value=g.data||[]}catch(s){console.error("Gagal memuat master group/category:",s)}},v=async(s=1)=>{if(!u.value){x.value=[],r.value={current_page:1,per_page:10,total:0,from:0,to:0,last_page:1};return}B.value=!0;try{const a=(await f.get("/api/v1/event-competition-branches",{params:{page:s,search:h.value,event_id:u.value,group_id:w.value||void 0,category_id:C.value||void 0}})).data.data;x.value=a.data||[],r.value={current_page:a.current_page,per_page:a.per_page,total:a.total,from:a.from,to:a.to,last_page:a.last_page}}catch(t){t.response&&t.response.status===401?(console.warn("Unauthorized. Logging out..."),U.logout()):console.error("Gagal memuat cabang event:",t)}finally{B.value=!1}},I=s=>{s<1||s>r.value.last_page||v(s)},O=()=>{if(!u.value){alert("Event belum dipilih. Silakan kembali ke landing dan pilih event dulu.");return}M.value=!1,o.value={id:null,event_id:u.value,master_competition_branch_id:null,code:"",master_competition_group_id:null,master_competition_category_id:null,type:"Putra",format:"individu",name:"",max_age:0,order_number:(r.value.total||0)+1,description:"",is_active:!0},$("#eventBranchModal").modal("show")},z=s=>{M.value=!0,o.value={id:s.id,event_id:s.event_id,master_competition_branch_id:s.master_competition_branch_id,code:s.code,master_competition_group_id:s.master_competition_group_id,master_competition_category_id:s.master_competition_category_id,type:s.type,format:s.format,name:s.name,max_age:s.max_age,order_number:s.order_number,description:s.description,is_active:!!s.is_active},$("#eventBranchModal").modal("show")},j=async()=>{var t,a;G.value=!0;const s={event_id:o.value.event_id,master_competition_branch_id:o.value.master_competition_branch_id,code:o.value.code,master_competition_group_id:o.value.master_competition_group_id,master_competition_category_id:o.value.master_competition_category_id,type:o.value.type,format:o.value.format,name:o.value.name,max_age:o.value.max_age,order_number:o.value.order_number,description:o.value.description,is_active:o.value.is_active};try{M.value&&o.value.id?await f.put(`/api/v1/event-competition-branches/${o.value.id}`,s):await f.post("/api/v1/event-competition-branches",s),$("#eventBranchModal").modal("hide"),v(r.value.current_page)}catch(g){console.error("Gagal menyimpan cabang event:",g),alert(((a=(t=g.response)==null?void 0:t.data)==null?void 0:a.message)||"Gagal menyimpan data cabang event.")}finally{G.value=!1}};return P(()=>u.value,()=>{v(1)}),P(()=>h.value,N(()=>v(1),400)),P(()=>[w.value,C.value],N(()=>v(1),300),{deep:!0}),R(async()=>{p.value=U.eventData,u.value=U.eventData.id,await q(),v()}),(s,t)=>(i(),n(b,null,[e("section",W,[e("div",X,[e("div",Y,[e("div",null,[t[15]||(t[15]=e("h1",{class:"mb-1"},"Cabang/Golongan per Event",-1)),p.value?(i(),n("p",Z,[t[14]||(t[14]=c(" Event: ")),e("strong",null,l(p.value.nama_event||p.value.name),1),p.value.nama_aplikasi||p.value.app_name?(i(),n("span",ee," — "+l(p.value.nama_aplikasi||p.value.app_name),1)):T("",!0)])):(i(),n("p",te," Event belum dipilih. Silakan kembali ke halaman landing dan pilih event terlebih dahulu. "))]),e("div",ae,[e("button",{class:"btn btn-outline-secondary",onClick:L,disabled:!u.value||S.value,title:"Generate dari Template Master Cabang"},[S.value?(i(),n("i",se)):(i(),n("i",le)),t[16]||(t[16]=e("span",{class:"d-none d-md-inline"},"Generate dari Master",-1))],8,oe),e("button",{class:"btn btn-primary",onClick:O,disabled:!u.value},t[17]||(t[17]=[e("i",{class:"fas fa-plus mr-1"},null,-1),e("span",{class:"d-none d-md-inline"},"Tambah",-1)]),8,ne)])])])]),e("section",ie,[e("div",re,[e("div",de,[e("div",ue,[e("div",me,[e("div",pe,[m(e("input",{"onUpdate:modelValue":t[0]||(t[0]=a=>h.value=a),type:"text",class:"form-control form-control-sm",placeholder:"Cari kode, nama, atau kombinasi..."},null,512),[[y,h.value]])]),e("div",ve,[m(e("select",{"onUpdate:modelValue":t[1]||(t[1]=a=>w.value=a),class:"form-control form-control-sm"},[t[18]||(t[18]=e("option",{value:""},"-- Semua Group --",-1)),(i(!0),n(b,null,k(V.value,a=>(i(),n("option",{key:a.id,value:a.id},l(a.name),9,ce))),128))],512),[[_,w.value]])]),e("div",_e,[m(e("select",{"onUpdate:modelValue":t[2]||(t[2]=a=>C.value=a),class:"form-control form-control-sm"},[t[19]||(t[19]=e("option",{value:""},"-- Semua Kategori --",-1)),(i(!0),n(b,null,k(E.value,a=>(i(),n("option",{key:a.id,value:a.id},l(a.name),9,ge))),128))],512),[[_,C.value]])]),e("div",be,[e("span",fe,[t[20]||(t[20]=c(" Total: ")),e("strong",null,l(r.value.total||0),1),t[21]||(t[21]=c(" cabang "))])])])]),e("div",ye,[e("table",ke,[t[26]||(t[26]=e("thead",{class:"thead-light"},[e("tr",null,[e("th",{style:{width:"40px"}},"#"),e("th",null,"Nama Cabang/Golongan"),e("th",null,"Group"),e("th",null,"Kategori"),e("th",{style:{width:"80px"}},"Type"),e("th",{style:{width:"80px"}},"Format"),e("th",{style:{width:"80px"}},"Max"),e("th",{style:{width:"90px"}},"Status"),e("th",{style:{width:"90px"},class:"text-center"},"Aksi")])],-1)),e("tbody",null,[u.value?B.value?(i(),n("tr",he,t[23]||(t[23]=[e("td",{colspan:"11",class:"text-center"},"Memuat data...",-1)]))):x.value.length===0?(i(),n("tr",we,t[24]||(t[24]=[e("td",{colspan:"11",class:"text-center"}," Belum ada data cabang/golongan untuk event ini. ",-1)]))):T("",!0):(i(),n("tr",xe,t[22]||(t[22]=[e("td",{colspan:"11",class:"text-center"}," Event belum dipilih. Silakan kembali ke halaman landing dan pilih event. ",-1)]))),(i(!0),n(b,null,k(x.value,(a,g)=>{var F,K;return i(),n("tr",{key:a.id},[e("td",null,l(g+1+(r.value.current_page-1)*r.value.per_page),1),e("td",null,[e("strong",null,l(a.name),1)]),e("td",null,l(((F=a.group)==null?void 0:F.name)||"-"),1),e("td",null,l(((K=a.category)==null?void 0:K.name)||"-"),1),e("td",null,l(a.type),1),e("td",null,l(a.format),1),e("td",Ce,[a.max_age>0?(i(),n("span",Me,l(a.max_age),1)):(i(),n("span",Ge,"-"))]),e("td",null,[e("span",{class:D(["badge",a.is_active?"badge-success":"badge-secondary"])},l(a.is_active?"Aktif":"Nonaktif"),3)]),e("td",Se,[e("div",Ue,[e("button",{class:"btn btn-warning",onClick:vt=>z(a),title:"Edit"},t[25]||(t[25]=[e("i",{class:"fas fa-edit"},null,-1)]),8,Be)])])])}),128))])])]),u.value?(i(),n("div",Ve,[e("div",Ee,[e("div",Pe," Menampilkan "+l(r.value.from||0)+" - "+l(r.value.to||0)+" dari "+l(r.value.total||0)+" cabang ",1),e("ul",Te,[e("li",{class:D(["page-item",{disabled:r.value.current_page===1}])},[e("a",{class:"page-link",href:"#",onClick:t[3]||(t[3]=A(a=>I(r.value.current_page-1),["prevent"]))}," « ")],2),e("li",De,[e("span",Ae," Halaman "+l(r.value.current_page)+" / "+l(r.value.last_page||1),1)]),e("li",{class:D(["page-item",{disabled:r.value.current_page===r.value.last_page}])},[e("a",{class:"page-link",href:"#",onClick:t[4]||(t[4]=A(a=>I(r.value.current_page+1),["prevent"]))}," » ")],2)])])])):T("",!0)])]),e("div",Ie,[e("div",$e,[e("div",Fe,[e("div",Ke,[e("h5",Ne,[t[27]||(t[27]=e("i",{class:"fas fa-sitemap me-2"},null,-1)),c(" "+l(M.value?"Edit Cabang":"Tambah Cabang"),1)]),t[28]||(t[28]=e("button",{type:"button",class:"close","data-dismiss":"modal"},[e("span",null,"×")],-1))]),e("div",Le,[e("form",{onSubmit:A(j,["prevent"])},[e("div",qe,[e("div",Oe,[e("div",ze,[t[29]||(t[29]=e("label",{class:"mb-1"},"Event",-1)),e("input",{type:"text",class:"form-control form-control-sm",value:p.value?p.value.nama_event||p.value.name:"",readonly:""},null,8,je)]),e("div",He,[t[30]||(t[30]=e("label",{class:"mb-1"},"Nama Cabang/Golongan",-1)),m(e("input",{"onUpdate:modelValue":t[5]||(t[5]=a=>o.value.name=a),class:"form-control form-control-sm",required:"",placeholder:"Misal: Tilawah Anak-Anak Putra",readonly:""},null,512),[[y,o.value.name]]),e("small",Re,l(o.value.code),1)]),e("div",Je,[t[32]||(t[32]=e("label",{class:"mb-1"},"Group Kompetisi",-1)),m(e("select",{readonly:"","onUpdate:modelValue":t[6]||(t[6]=a=>o.value.master_competition_group_id=a),class:"form-control form-control-sm"},[t[31]||(t[31]=e("option",{value:null},"-- Pilih Group --",-1)),(i(!0),n(b,null,k(V.value,a=>(i(),n("option",{key:a.id,value:a.id},l(a.code)+" — "+l(a.name),9,Qe))),128))],512),[[_,o.value.master_competition_group_id]])]),e("div",We,[t[34]||(t[34]=e("label",{class:"mb-1"},"Kategori Kompetisi",-1)),m(e("select",{readonly:"","onUpdate:modelValue":t[7]||(t[7]=a=>o.value.master_competition_category_id=a),class:"form-control form-control-sm"},[t[33]||(t[33]=e("option",{value:null},"-- Pilih Kategori --",-1)),(i(!0),n(b,null,k(E.value,a=>(i(),n("option",{key:a.id,value:a.id},l(a.code)+" — "+l(a.name),9,Xe))),128))],512),[[_,o.value.master_competition_category_id]])]),e("div",Ye,[t[36]||(t[36]=e("label",{class:"mb-1"},"Type",-1)),m(e("select",{readonly:"","onUpdate:modelValue":t[8]||(t[8]=a=>o.value.type=a),class:"form-control form-control-sm",required:""},t[35]||(t[35]=[e("option",{value:"Putra"},"Putra",-1),e("option",{value:"Putri"},"Putri",-1)]),512),[[_,o.value.type]])]),e("div",Ze,[t[38]||(t[38]=e("label",{class:"mb-1"},"Format",-1)),m(e("select",{readonly:"","onUpdate:modelValue":t[9]||(t[9]=a=>o.value.format=a),class:"form-control form-control-sm",required:""},t[37]||(t[37]=[e("option",{value:"individu"},"Individu",-1),e("option",{value:"grup"},"Grup",-1)]),512),[[_,o.value.format]])])]),e("div",et,[e("div",tt,[t[39]||(t[39]=e("label",{class:"mb-1"},"Maksimal Umur",-1)),m(e("input",{"onUpdate:modelValue":t[10]||(t[10]=a=>o.value.max_age=a),type:"number",min:"0",class:"form-control form-control-sm",placeholder:"0 = tanpa batasan"},null,512),[[y,o.value.max_age,void 0,{number:!0}]])]),e("div",at,[t[40]||(t[40]=e("label",{class:"mb-1"},"Urutan Tampil",-1)),m(e("input",{"onUpdate:modelValue":t[11]||(t[11]=a=>o.value.order_number=a),type:"number",min:"1",class:"form-control form-control-sm",required:""},null,512),[[y,o.value.order_number,void 0,{number:!0}]])]),e("div",ot,[t[41]||(t[41]=e("label",{class:"mb-1"},"Deskripsi",-1)),m(e("textarea",{"onUpdate:modelValue":t[12]||(t[12]=a=>o.value.description=a),rows:"3",class:"form-control form-control-sm",placeholder:"Contoh: Tilawah golongan Anak-Anak Putra untuk event ini."},null,512),[[y,o.value.description]])]),e("div",st,[t[43]||(t[43]=e("label",{class:"mb-1"},"Status",-1)),m(e("select",{"onUpdate:modelValue":t[13]||(t[13]=a=>o.value.is_active=a),class:"form-control form-control-sm"},t[42]||(t[42]=[e("option",{value:!0},"Aktif",-1),e("option",{value:!1},"Nonaktif",-1)]),512),[[_,o.value.is_active]])]),e("div",lt,[t[45]||(t[45]=e("label",{class:"mb-1 text-sm text-muted"}," Info Template Master (opsional) ",-1)),e("p",nt,[c(" Master Branch ID: "+l(o.value.master_competition_branch_id||"-"),1),t[44]||(t[44]=e("br",null,null,-1)),c(" Group ID: "+l(o.value.master_competition_group_id||"-")+", Category ID: "+l(o.value.master_competition_category_id||"-"),1)])])])]),e("div",it,[e("button",{type:"submit",class:"btn btn-sm btn-primary",disabled:G.value},[G.value?(i(),n("i",dt)):(i(),n("i",ut)),t[46]||(t[46]=c(" Simpan "))],8,rt)])],32)])])])])])],64))}},bt=Q(mt,[["__scopeId","data-v-80919fe2"]]);export{bt as default};
