import{z as j,A as r,y as J,O as z,V as O,B as i,C as d,D as e,K as x,S as m,I as V,as as v,J as o,U as E,ay as P,H as M,F as C,aB as q,a as w,aC as H}from"./AuthUserStore-67h2FHdL.js";import{S as K}from"./sweetalert2.esm.all-9Qm2jZ7z.js";const Q={class:"content-header"},R={class:"container-fluid"},W={class:"d-flex justify-content-between align-items-center"},X={class:"d-flex gap-2"},Y=["disabled"],Z={key:0,class:"fas fa-spinner fa-spin mr-1"},ee={key:1,class:"fas fa-magic mr-1"},ae={class:"content"},te={class:"container-fluid"},se={class:"card"},ne={class:"card-header d-flex justify-content-between align-items-center"},le={key:0,class:"text-muted text-sm"},oe={class:"card-body table-responsive p-0"},re={class:"table table-bordered table-hover text-sm"},ie={key:0},de={key:1},ue=["onClick"],me={class:"card-footer clearfix"},ve={class:"d-flex justify-content-between align-items-center"},ce={class:"text-muted text-sm"},pe={class:"pagination pagination-sm m-0"},_e={class:"page-item disabled"},fe={class:"page-link"},ge={class:"modal fade",id:"stageModal",tabindex:"-1",role:"dialog"},be={class:"modal-dialog modal-lg",role:"document"},he={class:"modal-content"},ye={class:"modal-header py-2"},ke={class:"modal-title",id:"stageModalLabel"},xe={class:"modal-body pt-2"},we={class:"row"},Te={class:"col-md-6"},Se={class:"form-group mb-2"},Me={class:"form-group mb-2"},Ce={class:"form-group mb-2"},$e={class:"col-md-6"},De={class:"form-group mb-2"},Ue={class:"form-group mb-2"},Ae={class:"form-group mb-2"},Ve={class:"text-end mt-3"},Ee=["disabled"],Ge={key:0,class:"fas fa-spinner fa-spin me-1"},Ne={key:1,class:"fas fa-save me-1"},je={__name:"EventStageList",setup(Ie){const _=j(),c=r([]),l=r({current_page:1,per_page:10,total:0,from:0,to:0,last_page:1}),f=r(""),g=r(!1),b=r(!1),h=r(!1),n=r({id:null,event_id:null,stage_id:null,name:"",order_number:1,start_date:"",end_date:"",notes:"",is_active:!0}),G=r(null),u=r(null),T=J(()=>_.eventData||null),D=s=>s?/^\d{4}-\d{2}-\d{2}$/.test(s)?s:String(s).substring(0,10):"",y=s=>{if(!s)return"";const a=String(s).substring(0,10),[t,S,A]=a.split("-");return`${A} ${["Jan","Feb","Mar","Apr","Mei","Jun","Jul","Agu","Sep","Okt","Nov","Des"][parseInt(S)-1]} ${t}`},p=async(s=1)=>{if(!u.value){c.value=[];return}g.value=!0;try{const t=(await w.get(`/api/v1/events/${u.value}/stages`,{params:{page:s,search:f.value}})).data.data;c.value=t.data||[],l.value={current_page:t.current_page,per_page:t.per_page,total:t.total,from:t.from,to:t.to,last_page:t.last_page}}catch(a){a.response&&a.response.status===401?(console.warn("Unauthorized. Logging out..."),_.logout()):console.error("Gagal memuat data tahapan:",a)}finally{g.value=!1}},U=s=>{s<1||s>l.value.last_page||p(s)},N=()=>{b.value=!1,n.value={id:null,event_id:u.value,stage_id:null,name:"",order_number:(l.value.total||0)+1,start_date:"",end_date:"",notes:"",is_active:!0},$("#stageModal").modal("show")},I=s=>{b.value=!0,n.value={id:s.id,event_id:s.event_id,stage_id:s.stage_id,name:s.name,order_number:s.order_number,start_date:D(s.start_date),end_date:D(s.end_date),notes:s.notes,is_active:!!s.is_active},console.log("form.value"),console.log(n.value),$("#stageModal").modal("show")},B=async()=>{if(!u.value){alert("Event belum terdeteksi. Silakan kembali ke halaman utama dan pilih event.");return}h.value=!0;const s={event_id:u.value,stage_id:n.value.stage_id,name:n.value.name,order_number:n.value.order_number,start_date:n.value.start_date||null,end_date:n.value.end_date||null,notes:n.value.notes,is_active:n.value.is_active};try{b.value&&n.value.id?await w.put(`/api/v1/event-stages/${n.value.id}`,s):await w.post("/api/v1/event-stages",s),$("#stageModal").modal("hide"),p(l.value.current_page)}catch(a){console.error("Gagal menyimpan tahapan:",a),alert("Gagal menyimpan tahapan.")}finally{h.value=!1}},k=r(!1),F=()=>{if(!u.value){alert("Event belum terdeteksi. Silakan pilih event terlebih dahulu.");return}c.value.length>0&&!confirm(`Tahapan untuk event ini sudah ada. Generate ulang akan menambah tahapan baru berdasarkan template master.

Lanjutkan?`)||L()},L=async()=>{k.value=!0;try{await w.post(`/api/v1/events/${u.value}/stages/generate-default`),await p(1),K.fire({icon:"success",title:"Tahapan berhasil digenerate dari template master.",showConfirmButton:!1,timer:2e3})}catch(s){console.error("Gagal generate tahapan:",s),alert("Gagal generate tahapan.")}finally{k.value=!1}};return z(()=>f.value,H(()=>p(1),400)),O(()=>{G.value=_.eventData,u.value=_.eventData.id,p()}),(s,a)=>(d(),i(E,null,[e("section",Q,[e("div",R,[e("div",W,[a[10]||(a[10]=e("div",null,[e("h1",{class:"mb-1"},"Data Tahapan Peserta"),e("p",{class:"mb-0 text-muted text-sm"}," Mengatur Tahapan Event. ")],-1)),e("div",X,[e("button",{class:"btn btn-outline-secondary btn-sm mr-2",onClick:F,disabled:!u.value||k.value||g.value},[k.value?(d(),i("i",Z)):(d(),i("i",ee)),a[9]||(a[9]=x(" Generate dari Template "))],8,Y),e("button",{class:"btn btn-primary btn-sm",onClick:N}," + Tambah Tahapan ")])])])]),e("section",ae,[e("div",te,[e("div",se,[e("div",ne,[m(e("input",{"onUpdate:modelValue":a[0]||(a[0]=t=>f.value=t),type:"text",class:"form-control form-control-sm w-50",placeholder:"Cari nama tahapan..."},null,512),[[v,f.value]]),T.value?(d(),i("span",le,[a[11]||(a[11]=x(" Periode Event: ")),e("strong",null,o(y(T.value.start_date))+" s.d. "+o(y(T.value.end_date)),1)])):V("",!0)]),e("div",oe,[e("table",re,[a[15]||(a[15]=e("thead",{class:"thead-light"},[e("tr",null,[e("th",{style:{width:"40px"}},"No"),e("th",null,"Nama Tahapan"),e("th",{style:{width:"150px"}},"Tanggal Awal"),e("th",{style:{width:"150px"}},"Tanggal Akhir"),e("th",{style:{width:"90px"}},"Status"),e("th",{style:{width:"90px"}},"Aksi")])],-1)),e("tbody",null,[g.value?(d(),i("tr",ie,a[12]||(a[12]=[e("td",{colspan:"7",class:"text-center"},"Memuat data...",-1)]))):c.value.length===0?(d(),i("tr",de,a[13]||(a[13]=[e("td",{colspan:"7",class:"text-center"},"Tidak ada data tahapan.",-1)]))):V("",!0),(d(!0),i(E,null,P(c.value,(t,S)=>(d(),i("tr",{key:t.id},[e("td",null,o(S+1+(l.value.current_page-1)*l.value.per_page),1),e("td",null,[e("strong",null,o(t.name),1)]),e("td",null,o(y(t.start_date)||"-"),1),e("td",null,o(y(t.end_date)||"-"),1),e("td",null,[e("span",{class:M(["badge",t.is_active?"badge-success":"badge-secondary"])},o(t.is_active?"Aktif":"Nonaktif"),3)]),e("td",null,[e("button",{class:"btn btn-sm btn-warning",onClick:A=>I(t)},a[14]||(a[14]=[e("i",{class:"fas fa-edit"},null,-1)]),8,ue)])]))),128))])])]),e("div",me,[e("div",ve,[e("div",ce," Menampilkan "+o(l.value.from||0)+" - "+o(l.value.to||0)+" dari "+o(l.value.total||0)+" tahapan ",1),e("ul",pe,[e("li",{class:M(["page-item",{disabled:l.value.current_page===1}])},[e("a",{class:"page-link",href:"#",onClick:a[1]||(a[1]=C(t=>U(l.value.current_page-1),["prevent"]))}," « ")],2),e("li",_e,[e("span",fe," Halaman "+o(l.value.current_page)+" / "+o(l.value.last_page||1),1)]),e("li",{class:M(["page-item",{disabled:l.value.current_page===l.value.last_page}])},[e("a",{class:"page-link",href:"#",onClick:a[2]||(a[2]=C(t=>U(l.value.current_page+1),["prevent"]))}," » ")],2)])])])])]),e("div",ge,[e("div",be,[e("div",he,[e("div",ye,[e("h5",ke,[a[16]||(a[16]=e("i",{class:"fas fa-list-alt me-2"},null,-1)),x(" "+o(b.value?"Edit Tahapan":"Tambah Tahapan"),1)]),a[17]||(a[17]=e("button",{type:"button",class:"close","data-dismiss":"modal"},[e("span",null,"×")],-1))]),e("div",xe,[e("form",{onSubmit:C(B,["prevent"])},[e("div",we,[e("div",Te,[e("div",Se,[a[18]||(a[18]=e("label",{class:"mb-1"},"Nama Tahapan",-1)),m(e("input",{"onUpdate:modelValue":a[3]||(a[3]=t=>n.value.name=t),class:"form-control form-control-sm",required:""},null,512),[[v,n.value.name]])]),e("div",Me,[a[19]||(a[19]=e("label",{class:"mb-1"},"Urutan Tahapan",-1)),m(e("input",{"onUpdate:modelValue":a[4]||(a[4]=t=>n.value.order_number=t),type:"number",min:"1",class:"form-control form-control-sm",required:""},null,512),[[v,n.value.order_number,void 0,{number:!0}]])]),e("div",Ce,[a[21]||(a[21]=e("label",{class:"mb-1"},"Status",-1)),m(e("select",{"onUpdate:modelValue":a[5]||(a[5]=t=>n.value.is_active=t),class:"form-control form-control-sm"},a[20]||(a[20]=[e("option",{value:!0},"Aktif",-1),e("option",{value:!1},"Nonaktif",-1)]),512),[[q,n.value.is_active]])])]),e("div",$e,[e("div",De,[a[22]||(a[22]=e("label",{class:"mb-1"},"Tanggal Awal",-1)),m(e("input",{"onUpdate:modelValue":a[6]||(a[6]=t=>n.value.start_date=t),type:"date",class:"form-control form-control-sm"},null,512),[[v,n.value.start_date]])]),e("div",Ue,[a[23]||(a[23]=e("label",{class:"mb-1"},"Tanggal Akhir",-1)),m(e("input",{"onUpdate:modelValue":a[7]||(a[7]=t=>n.value.end_date=t),type:"date",class:"form-control form-control-sm"},null,512),[[v,n.value.end_date]])]),e("div",Ae,[a[24]||(a[24]=e("label",{class:"mb-1"},"Keterangan",-1)),m(e("textarea",{"onUpdate:modelValue":a[8]||(a[8]=t=>n.value.notes=t),rows:"3",class:"form-control form-control-sm",placeholder:"Opsional: catatan internal untuk tahapan ini..."},null,512),[[v,n.value.notes]])])])]),e("div",Ve,[e("button",{type:"submit",class:"btn btn-sm btn-primary",disabled:h.value},[h.value?(d(),i("i",Ge)):(d(),i("i",Ne)),a[25]||(a[25]=x(" Simpan "))],8,Ee)])],32)])])])])])],64))}};export{je as default};
