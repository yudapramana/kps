import{z as V,A as y,V as L,B as b,C as h,D as t,I as k,K as d,G as u,J as w,Q as $,R as M,P as F,U as H,ah as J,L as W,a as q}from"./AuthUserStore-67h2FHdL.js";import{_ as K,a as Q,u as Y,b as O,$ as X}from"./app-CZBZEz52.js";import"./style-BgrjMBBc.js";const Z={class:"content-header"},ee={class:"container-fluid"},te={class:"row mb-2"},se={class:"col-sm-6"},ae={class:"m-0"},ne={key:0,class:"badge bg-warning text-dark px-2 py-1",style:{"font-size":"0.7rem","vertical-align":"middle"}},re={key:0,class:"col-sm-6"},oe={class:"content"},ie={class:"container-fluid"},le={key:0,class:"row"},ce={class:"row"},de={class:"col-md-12 col-sm-12 col-lg-12"},ue={class:"card bg-light d-flex flex-fill"},me={class:"card-header text-muted border-bottom-0 pb-0 mb-0"},pe={class:"card-body pt-0"},fe={class:"row"},ge={class:"col-12"},ye={class:"lead"},be={class:"ml-5 mb-0 fa-ul text-muted"},he={class:"small"},_e={class:"small"},ve={class:"card-footer b-0 p-0"},ke={class:"btn-group",style:{width:"100% !important"}},we={key:0,href:"/oauth/google",class:"btn btn-sm btn-warning",style:{display:"block","font-size":"small"}},Se={__name:"UserDashboard",setup(xe){const j=W(),B=Q(),m=V(),p=Y(),g=O();g.setting.maintenance=["1",1,!0,"true","on"].includes(g.setting.maintenance);const S=y([]),_=y(new Map),C=y(!1),D=y(null);y(new Map);const x=a=>String(a).replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#39;"),I=a=>{const e=new Map,s=(n,r=null)=>{var o;for(const i of n)e.set(String(i.id),{...i,parentId:r}),(o=i.children)!=null&&o.length&&s(i.children,i.id)};return s(a),e},N=()=>S.value.map(e=>({id:String(e.id),text:x(e.unit_name),type:"workunit",children:!0})),P=a=>{const e=_.value.get(String(a));return e?(e.children||[]).map(n=>({id:String(n.id),text:x(n.unit_name),type:"workunit",children:!0})):[]},A=async a=>{const e=String(a);if(p.employeesCacheByUnit[e])return p.employeesCacheByUnit[e];const s=await q.get(`/api/work-units/${e}/employees`),n=Array.isArray(s.data)?s.data:s.data.data??[];return p.setEmployees(e,n),n},R=async(a,e="#",s=1)=>{var r;const n=async(o,i)=>{await new Promise(l=>{a.open_node(o,async()=>{var c;if(i>0){const f=((c=a.get_node(o))==null?void 0:c.children)||[];for(const v of f)await n(v,i-1)}l()},!1)})};if(!(s<0)){if(e==="#"){const o=((r=a.get_node("#"))==null?void 0:r.children)||[];for(const i of o)await n(i,s);return}await n(e,s)}},T=async(a,e)=>{if(!e)return;let s=_.value.get(String(e));if(!s)return;const n=[];for(;s;)n.unshift(String(s.id)),s=s.parentId?_.value.get(String(s.parentId)):null;await new Promise(r=>a.open_node("#",r,!1));for(const r of n)await new Promise(o=>a.open_node(r,o,!1))},U=async()=>{await J();const a=X("#tree-container");a.jstree(!0)&&a.jstree(!0).destroy(),a.off("click",".js-doc-link"),a.off(".jstree"),a.one("ready.jstree",async()=>{var n,r,o,i,l;const e=a.jstree(!0);D.value=e,C.value=!0,await R(e,"#",1);const s=((o=(r=(n=m.user)==null?void 0:n.employee)==null?void 0:r.work_unit)==null?void 0:o.id)??((l=(i=m.user)==null?void 0:i.employee)==null?void 0:l.id_work_unit);s&&await T(e,String(s))}),a.jstree({core:{check_callback:!0,themes:{stripes:!0},html_titles:!0,data:async(e,s)=>{try{if(e.id==="#"){s(N());return}if(e.type==="employee"){s([]);return}const n=e.id,r=P(n),o=c=>c>=80?"bg-success":c>=60?"bg-info":c>=40?"bg-warning":"bg-danger",l=(await A(n)).map(c=>{const f=Number(c.progress_dokumen??0),v=(isFinite(f)?f:0).toFixed(2),G=x(c.full_name||""),z=o(f);return{id:`emp-${n}-${c.id}`,type:"employee",children:!1,text:`
                <span class="w-100">
                  <span class="emp-label">${G} — ${f}%</span>
                  <div class="progress progress-xxs">
                    <div class="progress-bar ${z} progress-bar-striped" role="progressbar"
                        aria-valuenow="${v}" aria-valuemin="0" aria-valuemax="100"
                        style="width: ${Math.max(0,Math.min(100,Number(f)||0))}%">
                      <span class="sr-only">${v}% Complete</span>
                    </div>
                  </div>
                </span>
              `}});if(r.length===0&&l.length===0){s([{id:`info-empty-${n}`,text:"Belum ada data.",type:"info",children:!1,li_attr:{class:"text-muted"}}]);return}s([...r,...l])}catch{s([{id:`info-error-${e.id}-${Date.now()}`,text:"Gagal memuat data.",type:"info",children:!1,li_attr:{class:"text-danger"}}])}}},plugins:["types","state"],state:{key:"monitor-tree-v2"},types:{workunit:{icon:"far fa-folder"},employee:{icon:"far fa-user"},info:{icon:"far fa-circle"}}}),a.on("click",".js-doc-link",e=>{e.preventDefault(),e.stopPropagation();const s=e.currentTarget.getAttribute("data-user-id");s&&j.push(`/admin/users/${s}/documents`)}),a.on("select_node.jstree",(e,s)=>{}),D.value=a.jstree(!0),C.value=!0},E=async()=>{p.clearEmployeesCache(),await U()};return L(async()=>{p.hydrateEmployeesCache(),await p.getSelfWorkUnitMonitorList();const a=p.selfWorkUnitMonitorList;S.value=(a==null?void 0:a.data)||[],_.value=I(S.value),await U(),g.resetMaintenance(),g.getSetting()}),(a,e)=>{var n,r,o,i,l;const s=F("router-link");return h(),b(H,null,[t("div",Z,[t("div",ee,[t("div",te,[t("div",se,[t("h1",ae,[e[0]||(e[0]=d(" Beranda ")),u(g).setting.maintenance==!0?(h(),b("span",ne," Maintenance ")):k("",!0)])]),u(B).isMobile?k("",!0):(h(),b("div",re,e[1]||(e[1]=[t("ol",{class:"breadcrumb float-sm-right"},[t("li",{class:"breadcrumb-item"},[t("a",{href:"#"},"Home")]),t("li",{class:"breadcrumb-item active"},"Beranda")],-1)])))])])]),t("div",oe,[t("div",ie,[u(g).setting.maintenance==!0?(h(),b("div",le,e[2]||(e[2]=[t("div",{class:"col-12 mb-2"},[t("div",{class:"alert alert-warning alert-dismissible fade show",role:"alert"},[t("strong",null,"Pemberitahuan Pemeliharaan Sistem"),t("br"),d(" Yth. Bapak/Ibu Pengguna SIGARDA, "),t("br"),d(" Sehubungan dengan keterbatasan kapasitas penyimpanan pada server, kami informasikan bahwa proses pemeliharaan (maintenance) akan berlangsung selama 3 hari. "),t("br"),d("Selama periode tersebut, akan dilakukan proses verifikasi dan validasi (verval) agar dokumen yang telah tersimpan dapat dipindahkan ke Google Drive / Google Cloud Storage Bucket. Atas perhatian dan pengertiannya, kami ucapkan terima kasih. "),t("button",{type:"button",class:"close","data-dismiss":"alert","aria-label":"Close"},[t("span",{"aria-hidden":"true"},"×")])])],-1)]))):k("",!0),t("div",ce,[t("div",de,[t("div",ue,[t("div",me,w((r=(n=u(m).user)==null?void 0:n.employee)==null?void 0:r.job_title),1),t("div",pe,[t("div",fe,[t("div",ge,[t("h2",ye,[t("b",null,w(u(m).user.name),1)]),t("ul",be,[t("li",he,[e[3]||(e[3]=t("span",{class:"fa-li"},[t("i",{class:"far fa-id-card"})],-1)),d(" "+w(u(m).user.username),1)]),t("li",_e,[e[4]||(e[4]=t("span",{class:"fa-li"},[t("i",{class:"fas fa-lg fa-building"})],-1)),d(" "+w((l=(i=(o=u(m).user)==null?void 0:o.employee)==null?void 0:i.work_unit)==null?void 0:l.unit_name),1)])])])])]),t("div",ve,[t("div",ke,[$(s,{to:"/user/profile",class:"btn btn-sm btn-primary",style:{display:"block","font-size":"small"}},{default:M(()=>e[5]||(e[5]=[t("i",{class:"fas fa-user"},null,-1),d(" Lihat Profil ")])),_:1}),$(s,{to:"/user/upload",class:"btn btn-sm btn-success",style:{display:"block","font-size":"small"}},{default:M(()=>e[6]||(e[6]=[d(" Input Dokumen "),t("i",{class:"fas fa-arrow-circle-right"},null,-1)])),_:1}),u(m).user.role=="SUPERADMIN"?(h(),b("a",we,e[7]||(e[7]=[t("i",{class:"fab fa-google"},null,-1),d(" Connect Google ")]))):k("",!0)])])])])]),t("div",{class:"row"},[t("div",{class:"col-12"},[t("div",{class:"d-flex justify-content-between align-items-center mb-3"},[e[8]||(e[8]=t("h5",{class:"mb-0"},"Monitoring Pegawai",-1)),t("div",{class:"btn-group"},[t("button",{class:"btn btn-sm btn-primary",onClick:E}," Refresh ")])]),e[9]||(e[9]=t("div",{id:"tree-container"},null,-1))])])])])],64)}}},$e=K(Se,[["__scopeId","data-v-00dd1662"]]);export{$e as default};
