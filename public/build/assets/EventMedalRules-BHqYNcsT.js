import{B as G,F as m,G as M,J as q,P as d,Q as u,R as e,W as A,Z as v,ah as p,av as T,ap as _,a5 as S,aw as H,U as i,T as B,S as C}from"./pinia-BDOwh8JO.js";import{u as I,b as f,e as K}from"./app-Cc4vFrcH.js";import{S as r}from"./sweetalert2.esm.all-9Qm2jZ7z.js";const Y={class:"content-header"},L={class:"container-fluid"},z={class:"d-flex justify-content-between align-items-center"},J={class:"d-flex flex-column flex-sm-row gap-2"},Q=["disabled"],W={key:0,class:"fas fa-spinner fa-spin mr-1"},Z={key:1,class:"fas fa-magic mr-1"},O=["disabled"],X={key:0,class:"text-danger text-sm mt-2 mb-0"},ee={class:"content"},te={class:"container-fluid"},ae={class:"card"},le={class:"card-header"},se={class:"d-flex flex-wrap justify-content-between align-items-center w-100"},ne={class:"d-flex align-items-center"},oe={class:"card-body table-responsive p-0"},ie={class:"table table-bordered table-hover text-sm mb-0"},re={key:0},de={key:1},ue={class:"text-center"},me={class:"text-center"},ce={class:"text-center"},ve={class:"text-center"},pe={class:"btn-group btn-group-sm"},_e=["onClick"],fe=["onClick"],be={class:"card-footer clearfix py-2"},ge={class:"d-flex justify-content-between align-items-center"},he={class:"text-muted text-sm"},xe={class:"pagination pagination-sm m-0"},ye={class:"page-item disabled"},ke={class:"page-link"},we={class:"modal fade",id:"eventMedalRuleModal",tabindex:"-1"},Me={class:"modal-dialog modal-lg"},Be={class:"modal-content"},Ce={class:"modal-header py-2"},Ge={class:"modal-title"},Ae={class:"modal-body pt-2"},Te={class:"row"},Se={class:"col-md-6"},Ee={class:"form-group mb-2"},Ue={class:"form-group mb-2"},Ve={class:"col-md-3"},$e={class:"form-group mb-2"},Pe={class:"form-group mb-2"},Ne={class:"col-md-3"},Re={class:"form-group mb-2"},De={class:"text-right mt-3"},Fe=["disabled"],je={key:0,class:"fas fa-spinner fa-spin mr-1"},qe={key:1,class:"fas fa-save mr-1"},Le={__name:"EventMedalRules",setup(He){const E=I(),U=G(()=>E.eventData||null),o=G(()=>{var l;return((l=U.value)==null?void 0:l.id)||null}),k=m([]),b=m(""),g=m(10),w=m(!1),h=m(!1),x=m(!1),y=m(!1),n=m({current_page:1,per_page:10,total:0,from:0,to:0,last_page:1}),s=m({id:null,medal_code:"",medal_name:"",order_number:1,point:0,is_active:!0}),c=async(l=1)=>{if(o.value){w.value=!0;try{const a=(await f.get("/api/v1/event-medal-rules",{params:{event_id:o.value,page:l,per_page:g.value,search:b.value}})).data.data;k.value=a.data||[],n.value={current_page:a.current_page,per_page:a.per_page,total:a.total,from:a.from,to:a.to,last_page:a.last_page}}catch(t){console.error("Gagal memuat event_medal_rules:",t),r.fire("Gagal","Gagal memuat aturan medali event.","error")}finally{w.value=!1}}},V=()=>{if(!o.value){r.fire("Event belum dipilih","Silakan pilih event terlebih dahulu.","warning");return}h.value=!1,s.value={id:null,medal_code:"",medal_name:"",order_number:(n.value.total||0)+1,point:0,is_active:!0},$("#eventMedalRuleModal").modal("show")},P=l=>{h.value=!0,s.value={...l},$("#eventMedalRuleModal").modal("show")},N=async()=>{if(o.value){x.value=!0;try{const l={event_id:o.value,medal_code:s.value.medal_code,medal_name:s.value.medal_name,order_number:s.value.order_number,point:s.value.point,is_active:s.value.is_active};h.value&&s.value.id?(await f.put(`/api/v1/event-medal-rules/${s.value.id}`,l),r.fire("Berhasil","Aturan medali event diperbarui.","success")):(await f.post("/api/v1/event-medal-rules",l),r.fire("Berhasil","Aturan medali event ditambahkan.","success")),$("#eventMedalRuleModal").modal("hide"),c(n.value.current_page)}catch(l){console.error("Gagal menyimpan event_medal_rule:",l),r.fire("Gagal","Gagal menyimpan aturan medali event.","error")}finally{x.value=!1}}},R=async l=>{if((await r.fire({title:"Hapus Aturan Medali?",text:`Yakin ingin menghapus "${l.medal_name}" dari event ini?`,icon:"warning",showCancelButton:!0,confirmButtonText:"Ya, Hapus",cancelButtonText:"Batal",confirmButtonColor:"#d33",cancelButtonColor:"#3085d6"})).isConfirmed)try{await f.delete(`/api/v1/event-medal-rules/${l.id}`),r.fire("Terhapus","Aturan medali event berhasil dihapus.","success"),c(n.value.current_page)}catch(a){console.error("Gagal menghapus event_medal_rule:",a),r.fire("Gagal","Gagal menghapus aturan medali event.","error")}},D=async()=>{if(!(!o.value||!(await r.fire({title:"Generate dari Template?",text:"Aturan medali event akan disalin dari Master Aturan Medali.",icon:"question",showCancelButton:!0,confirmButtonText:"Ya, Generate",cancelButtonText:"Batal"})).isConfirmed)){y.value=!0;try{await f.post("/api/v1/event-medal-rules/generate-from-template",{event_id:o.value}),r.fire("Berhasil","Aturan medali event berhasil digenerate.","success"),c(1)}catch(t){console.error("Gagal generate event_medal_rules:",t),r.fire("Gagal","Gagal generate aturan medali event.","error")}finally{y.value=!1}}};return M(()=>b.value,K(()=>c(1),400)),M(()=>g.value,()=>c(1)),M(()=>o.value,l=>{l&&c(1)}),q(()=>{o.value?c():r.fire("Event belum dipilih","Silakan pilih event melalui Portal Event terlebih dahulu.","info")}),(l,t)=>(u(),d(S,null,[e("section",Y,[e("div",L,[e("div",z,[t[10]||(t[10]=e("div",null,[e("h1",{class:"mb-1"},"Aturan Medali Event"),e("p",{class:"mb-0 text-muted text-sm"}," Mengatur aturan medali khusus untuk event aktif (override dari template). ")],-1)),e("div",J,[e("button",{class:"btn btn-outline-secondary btn-sm mr-sm-2 mb-2 mb-sm-0",onClick:D,disabled:y.value||!o.value},[y.value?(u(),d("i",W)):(u(),d("i",Z)),t[9]||(t[9]=v(" Generate dari Template "))],8,Q),e("button",{class:"btn btn-primary btn-sm",onClick:V,disabled:!o.value}," + Tambah Aturan Medali ",8,O)])]),o.value?A("",!0):(u(),d("p",X,t[11]||(t[11]=[e("i",{class:"fas fa-exclamation-triangle mr-1"},null,-1),v(" Event belum dipilih. Silakan pilih event melalui Portal Event terlebih dahulu. ")])))])]),e("section",ee,[e("div",te,[e("div",ae,[e("div",le,[e("div",se,[e("div",ne,[t[13]||(t[13]=e("label",{class:"mb-0 mr-1 text-sm text-muted"},"Tampilkan",-1)),p(e("select",{"onUpdate:modelValue":t[0]||(t[0]=a=>g.value=a),class:"form-control form-control-sm w-auto mr-2"},t[12]||(t[12]=[e("option",{value:10},"10",-1),e("option",{value:25},"25",-1),e("option",{value:50},"50",-1)]),512),[[T,g.value,void 0,{number:!0}]]),t[14]||(t[14]=e("label",{class:"mb-0 text-sm text-muted"},"Entri",-1))]),p(e("input",{"onUpdate:modelValue":t[1]||(t[1]=a=>b.value=a),type:"text",class:"form-control form-control-sm w-auto",style:{"min-width":"220px"},placeholder:"Cari kode / nama medali..."},null,512),[[_,b.value]])])]),e("div",oe,[e("table",ie,[t[19]||(t[19]=e("thead",{class:"thead-light"},[e("tr",null,[e("th",{style:{width:"40px"}},"#"),e("th",{style:{width:"140px"}},"Kode"),e("th",null,"Nama Medali"),e("th",{style:{width:"90px"},class:"text-center"},"Urutan"),e("th",{style:{width:"90px"},class:"text-center"},"Poin"),e("th",{style:{width:"90px"},class:"text-center"},"Status"),e("th",{style:{width:"110px"},class:"text-center"},"Aksi")])],-1)),e("tbody",null,[w.value?(u(),d("tr",re,t[15]||(t[15]=[e("td",{colspan:"7",class:"text-center"}," Memuat aturan medali event... ",-1)]))):k.value.length===0?(u(),d("tr",de,t[16]||(t[16]=[e("td",{colspan:"7",class:"text-center"},[v(" Belum ada aturan medali untuk event ini. "),e("br"),e("small",{class:"text-muted"},[v(" Klik "),e("strong",null,"Generate dari Template"),v(" atau "),e("strong",null,"Tambah Aturan Medali"),v(". ")])],-1)]))):A("",!0),(u(!0),d(S,null,H(k.value,(a,F)=>(u(),d("tr",{key:a.id},[e("td",null,i(F+1+(n.value.current_page-1)*n.value.per_page),1),e("td",null,[e("code",null,i(a.medal_code),1)]),e("td",null,[e("strong",null,i(a.medal_name),1)]),e("td",ue,i(a.order_number),1),e("td",me,i(a.point),1),e("td",ce,[e("span",{class:B(["badge",a.is_active?"badge-success":"badge-secondary"])},i(a.is_active?"Aktif":"Nonaktif"),3)]),e("td",ve,[e("div",pe,[e("button",{class:"btn btn-warning",onClick:j=>P(a)},t[17]||(t[17]=[e("i",{class:"fas fa-edit"},null,-1)]),8,_e),e("button",{class:"btn btn-danger",onClick:j=>R(a)},t[18]||(t[18]=[e("i",{class:"fas fa-trash"},null,-1)]),8,fe)])])]))),128))])])]),e("div",be,[e("div",ge,[e("div",he," Menampilkan "+i(n.value.from||0)+" - "+i(n.value.to||0)+" dari "+i(n.value.total||0)+" aturan ",1),e("ul",xe,[e("li",{class:B(["page-item",{disabled:n.value.current_page===1}])},[e("a",{href:"#",class:"page-link",onClick:t[2]||(t[2]=C(a=>l.changePage(n.value.current_page-1),["prevent"]))},"«")],2),e("li",ye,[e("span",ke," Halaman "+i(n.value.current_page)+" / "+i(n.value.last_page||1),1)]),e("li",{class:B(["page-item",{disabled:n.value.current_page===n.value.last_page}])},[e("a",{href:"#",class:"page-link",onClick:t[3]||(t[3]=C(a=>l.changePage(n.value.current_page+1),["prevent"]))},"»")],2)])])])])]),e("div",we,[e("div",Me,[e("div",Be,[e("div",Ce,[e("h5",Ge,i(h.value?"Edit Aturan Medali Event":"Tambah Aturan Medali Event"),1),t[20]||(t[20]=e("button",{type:"button",class:"close","data-dismiss":"modal"},[e("span",null,"×")],-1))]),e("div",Ae,[e("form",{onSubmit:C(N,["prevent"])},[e("div",Te,[e("div",Se,[e("div",Ee,[t[21]||(t[21]=e("label",{class:"mb-1"},"Kode Medali",-1)),p(e("input",{"onUpdate:modelValue":t[4]||(t[4]=a=>s.value.medal_code=a),class:"form-control form-control-sm",required:""},null,512),[[_,s.value.medal_code]])]),e("div",Ue,[t[22]||(t[22]=e("label",{class:"mb-1"},"Nama Medali",-1)),p(e("input",{"onUpdate:modelValue":t[5]||(t[5]=a=>s.value.medal_name=a),class:"form-control form-control-sm",required:""},null,512),[[_,s.value.medal_name]])])]),e("div",Ve,[e("div",$e,[t[23]||(t[23]=e("label",{class:"mb-1"},"Urutan",-1)),p(e("input",{"onUpdate:modelValue":t[6]||(t[6]=a=>s.value.order_number=a),type:"number",min:"1",class:"form-control form-control-sm"},null,512),[[_,s.value.order_number,void 0,{number:!0}]])]),e("div",Pe,[t[24]||(t[24]=e("label",{class:"mb-1"},"Poin",-1)),p(e("input",{"onUpdate:modelValue":t[7]||(t[7]=a=>s.value.point=a),type:"number",min:"0",class:"form-control form-control-sm"},null,512),[[_,s.value.point,void 0,{number:!0}]])])]),e("div",Ne,[e("div",Re,[t[26]||(t[26]=e("label",{class:"mb-1"},"Status",-1)),p(e("select",{"onUpdate:modelValue":t[8]||(t[8]=a=>s.value.is_active=a),class:"form-control form-control-sm"},t[25]||(t[25]=[e("option",{value:!0},"Aktif",-1),e("option",{value:!1},"Nonaktif",-1)]),512),[[T,s.value.is_active]])])])]),e("div",De,[e("button",{type:"submit",class:"btn btn-sm btn-primary",disabled:x.value||!o.value},[x.value?(u(),d("i",je)):(u(),d("i",qe)),t[27]||(t[27]=v(" Simpan "))],8,Fe)])],32)])])])])])],64))}};export{Le as default};
