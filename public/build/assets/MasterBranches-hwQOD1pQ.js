import{z as L,A as o,O as G,V as P,B as i,C as d,D as a,S as m,aB as w,as as h,I as q,K as b,U as B,ay as N,J as r,H as C,F as M,a as v,aC as z}from"./AuthUserStore-67h2FHdL.js";import{S as u}from"./sweetalert2.esm.all-9Qm2jZ7z.js";const O={class:"content"},I={class:"container-fluid"},J={class:"card"},K={class:"card-header"},Q={class:"d-flex flex-wrap justify-content-between align-items-center w-100"},Y={class:"d-flex flex-wrap align-items-center"},R={class:"card-body table-responsive p-0"},W={class:"table table-bordered table-hover text-sm mb-0"},X={key:0},Z={key:1},aa={class:"text-muted"},ea={class:"text-center"},ta={class:"text-center"},sa={class:"text-center"},la={class:"btn-group btn-group-sm"},na=["onClick"],ra=["onClick"],oa={class:"card-footer clearfix py-2"},ia={class:"d-flex justify-content-between align-items-center"},da={class:"text-muted text-sm"},ua={class:"pagination pagination-sm m-0"},ma={class:"page-item disabled"},ca={class:"page-link"},ba={class:"modal fade",id:"masterBranchModal",tabindex:"-1",role:"dialog","aria-labelledby":"masterBranchModalLabel"},pa={class:"modal-dialog modal-lg",role:"document"},va={class:"modal-content"},ga={class:"modal-header py-2"},fa={class:"modal-title",id:"masterBranchModalLabel"},_a={class:"modal-body pt-2"},ha={class:"row"},xa={class:"col-md-6"},ya={class:"form-group mb-2"},ka=["value"],wa={class:"form-group mb-2"},Ba={class:"form-group mb-2"},Ca={class:"form-group mb-2"},Ma={class:"col-md-6"},Ua={class:"form-group mb-2"},Ga={class:"text-right mt-3"},Na=["disabled"],Sa={key:0,class:"fas fa-spinner fa-spin mr-1"},Ta={key:1,class:"fas fa-save mr-1"},Aa={__name:"MasterBranches",setup(Va){const S=L(),x=o([]),n=o({current_page:1,per_page:10,total:0,from:0,to:0,last_page:1}),g=o(""),f=o(10),y=o(!1),p=o(!1),_=o(!1),k=o([]),l=o({id:null,branch_id:null,branch_name:"",full_name:"",order_number:null,is_active:!0}),c=async(s=1)=>{y.value=!0;try{const t=(await v.get("/api/v1/master-branches",{params:{page:s,per_page:f.value,search:g.value}})).data.data;x.value=t.data||[],n.value={current_page:t.current_page,per_page:t.per_page,total:t.total,from:t.from,to:t.to,last_page:t.last_page}}catch(e){console.error("Gagal memuat master_branches:",e),e.response&&e.response.status===401?S.logout():u.fire("Gagal","Gagal memuat data master cabang.","error")}finally{y.value=!1}},T=async()=>{try{const e=(await v.get("/api/v1/branches",{params:{per_page:1e3}})).data.data;k.value=e.data||[]}catch(s){console.error("Gagal memuat options branches:",s),u.fire("Gagal","Gagal memuat daftar cabang.","error")}},U=s=>{s<1||s>n.value.last_page||c(s)},V=()=>{p.value=!1,l.value={id:null,branch_id:null,branch_name:"",full_name:"",order_number:(n.value.total||0)+1,is_active:!0},$("#masterBranchModal").modal("show")},D=s=>{p.value=!0,l.value={id:s.id,branch_id:s.branch_id,branch_name:s.branch_name,full_name:s.full_name,order_number:s.order_number,is_active:!!s.is_active},$("#masterBranchModal").modal("show")},A=()=>{const s=k.value.find(e=>e.id===l.value.branch_id);s&&!p.value&&(l.value.branch_name=s.name||"",l.value.full_name||(l.value.full_name=s.name||""))},F=async()=>{_.value=!0;const s={branch_id:l.value.branch_id,branch_name:l.value.branch_name,full_name:l.value.full_name,order_number:l.value.order_number,is_active:l.value.is_active};try{p.value&&l.value.id?(await v.put(`/api/v1/master-branches/${l.value.id}`,s),u.fire("Berhasil","Master cabang berhasil diperbarui.","success")):(await v.post("/api/v1/master-branches",s),u.fire("Berhasil","Master cabang berhasil ditambahkan.","success")),$("#masterBranchModal").modal("hide"),c(n.value.current_page)}catch(e){console.error("Gagal menyimpan master_branch:",e),u.fire("Gagal","Gagal menyimpan data master cabang.","error")}finally{_.value=!1}},E=async s=>{if((await u.fire({title:"Hapus Master Cabang?",text:`Yakin ingin menghapus master cabang "${s.full_name}"? Tindakan ini tidak bisa dibatalkan.`,icon:"warning",showCancelButton:!0,confirmButtonText:"Ya, Hapus",cancelButtonText:"Batal",confirmButtonColor:"#d33",cancelButtonColor:"#3085d6"})).isConfirmed)try{await v.delete(`/api/v1/master-branches/${s.id}`),u.fire("Terhapus","Master cabang berhasil dihapus.","success"),c(n.value.current_page)}catch(t){console.error("Gagal menghapus master_branch:",t),u.fire("Gagal","Gagal menghapus master cabang.","error")}};return G(()=>g.value,z(()=>c(1),400)),G(()=>f.value,()=>{c(1)}),P(()=>{c(),T()}),(s,e)=>(d(),i(B,null,[a("section",{class:"content-header"},[a("div",{class:"container-fluid"},[a("div",{class:"d-flex justify-content-between align-items-center"},[e[9]||(e[9]=a("div",null,[a("h1",{class:"mb-1"},"Master Cabang MTQ (Master Branches)"),a("p",{class:"mb-0 text-muted text-sm"}," Digunakan sebagai master cabang global yang akan dipakai sebagai template di berbagai event. ")],-1)),a("button",{class:"btn btn-primary btn-sm",onClick:V}," + Tambah Master Cabang ")])])]),a("section",O,[a("div",I,[a("div",J,[a("div",K,[a("div",Q,[a("div",Y,[e[11]||(e[11]=a("label",{class:"mb-0 mr-1 text-sm text-muted"},"Tampilkan",-1)),m(a("select",{"onUpdate:modelValue":e[0]||(e[0]=t=>f.value=t),class:"form-control form-control-sm w-auto mr-2"},e[10]||(e[10]=[a("option",{value:10},"10",-1),a("option",{value:25},"25",-1),a("option",{value:50},"50",-1),a("option",{value:100},"100",-1)]),512),[[w,f.value,void 0,{number:!0}]]),e[12]||(e[12]=a("label",{class:"mb-0 mr-1 text-sm text-muted"},"Entri",-1))]),m(a("input",{"onUpdate:modelValue":e[1]||(e[1]=t=>g.value=t),type:"text",class:"form-control form-control-sm w-auto",style:{"min-width":"220px"},placeholder:"Cari nama cabang / full name..."},null,512),[[h,g.value]])])]),a("div",R,[a("table",W,[e[18]||(e[18]=a("thead",{class:"thead-light"},[a("tr",null,[a("th",{style:{width:"40px"}},"#"),a("th",{style:{width:"160px"}},"Cabang"),a("th",null,"Branch Name"),a("th",null,"Full Name"),a("th",{style:{width:"80px"},class:"text-center"},"Urutan"),a("th",{style:{width:"90px"},class:"text-center"},"Status"),a("th",{style:{width:"110px"},class:"text-center"},"Aksi")])],-1)),a("tbody",null,[y.value?(d(),i("tr",X,e[13]||(e[13]=[a("td",{colspan:"7",class:"text-center"},"Memuat data master cabang...",-1)]))):x.value.length===0?(d(),i("tr",Z,e[14]||(e[14]=[a("td",{colspan:"7",class:"text-center"},[b(" Belum ada data master cabang. "),a("br"),a("small",{class:"text-muted"},[b(" Klik "),a("strong",null,"Tambah Master Cabang"),b(" untuk menambahkan. ")])],-1)]))):q("",!0),(d(!0),i(B,null,N(x.value,(t,H)=>(d(),i("tr",{key:t.id},[a("td",null,r(H+1+(n.value.current_page-1)*n.value.per_page),1),a("td",null,[a("div",null,[a("strong",null,r(t.branch_name),1),e[15]||(e[15]=a("br",null,null,-1)),a("small",aa," ID: "+r(t.branch_id),1)])]),a("td",null,r(t.branch_name),1),a("td",null,r(t.full_name),1),a("td",ea,r(t.order_number||"-"),1),a("td",ta,[a("span",{class:C(["badge",t.is_active?"badge-success":"badge-secondary"])},r(t.is_active?"Aktif":"Nonaktif"),3)]),a("td",sa,[a("div",la,[a("button",{class:"btn btn-warning",onClick:j=>D(t)},e[16]||(e[16]=[a("i",{class:"fas fa-edit"},null,-1)]),8,na),a("button",{class:"btn btn-danger",onClick:j=>E(t)},e[17]||(e[17]=[a("i",{class:"fas fa-trash"},null,-1)]),8,ra)])])]))),128))])])]),a("div",oa,[a("div",ia,[a("div",da," Menampilkan "+r(n.value.from||0)+" - "+r(n.value.to||0)+" dari "+r(n.value.total||0)+" master cabang ",1),a("ul",ua,[a("li",{class:C(["page-item",{disabled:n.value.current_page===1}])},[a("a",{href:"#",class:"page-link",onClick:e[2]||(e[2]=M(t=>U(n.value.current_page-1),["prevent"]))}," « ")],2),a("li",ma,[a("span",ca," Halaman "+r(n.value.current_page)+" / "+r(n.value.last_page||1),1)]),a("li",{class:C(["page-item",{disabled:n.value.current_page===n.value.last_page}])},[a("a",{href:"#",class:"page-link",onClick:e[3]||(e[3]=M(t=>U(n.value.current_page+1),["prevent"]))}," » ")],2)])])])])]),a("div",ba,[a("div",pa,[a("div",va,[a("div",ga,[a("h5",fa,[e[19]||(e[19]=a("i",{class:"fas fa-sitemap mr-1"},null,-1)),b(" "+r(p.value?"Edit Master Cabang":"Tambah Master Cabang"),1)]),e[20]||(e[20]=a("button",{type:"button",class:"close","data-dismiss":"modal"},[a("span",null,"×")],-1))]),a("div",_a,[a("form",{onSubmit:M(F,["prevent"])},[a("div",ha,[a("div",xa,[a("div",ya,[e[22]||(e[22]=a("label",{class:"mb-1"},"Cabang (dari tabel branches)",-1)),m(a("select",{"onUpdate:modelValue":e[4]||(e[4]=t=>l.value.branch_id=t),class:"form-control form-control-sm",required:"",onChange:A},[e[21]||(e[21]=a("option",{value:null,disabled:""},"Pilih Cabang...",-1)),(d(!0),i(B,null,N(k.value,t=>(d(),i("option",{key:t.id,value:t.id},r(t.name),9,ka))),128))],544),[[w,l.value.branch_id,void 0,{number:!0}]]),e[23]||(e[23]=a("small",{class:"text-muted"}," Pilih cabang dasar yang akan dijadikan master. ",-1))]),a("div",wa,[e[24]||(e[24]=a("label",{class:"mb-1"},"Branch Name",-1)),m(a("input",{"onUpdate:modelValue":e[5]||(e[5]=t=>l.value.branch_name=t),type:"text",class:"form-control form-control-sm",required:""},null,512),[[h,l.value.branch_name]]),e[25]||(e[25]=a("small",{class:"text-muted"}," Nama pendek/teknis cabang. Biasanya sama dengan nama cabang di atas. ",-1))]),a("div",Ba,[e[26]||(e[26]=a("label",{class:"mb-1"},"Urutan Tampil",-1)),m(a("input",{"onUpdate:modelValue":e[6]||(e[6]=t=>l.value.order_number=t),type:"number",min:"1",class:"form-control form-control-sm"},null,512),[[h,l.value.order_number,void 0,{number:!0}]]),e[27]||(e[27]=a("small",{class:"text-muted"}," Urutan master cabang saat ditampilkan (boleh dikosongkan). ",-1))]),a("div",Ca,[e[29]||(e[29]=a("label",{class:"mb-1"},"Status",-1)),m(a("select",{"onUpdate:modelValue":e[7]||(e[7]=t=>l.value.is_active=t),class:"form-control form-control-sm"},e[28]||(e[28]=[a("option",{value:!0},"Aktif",-1),a("option",{value:!1},"Nonaktif",-1)]),512),[[w,l.value.is_active]])])]),a("div",Ma,[a("div",Ua,[e[30]||(e[30]=a("label",{class:"mb-1"},"Full Name",-1)),m(a("input",{"onUpdate:modelValue":e[8]||(e[8]=t=>l.value.full_name=t),type:"text",class:"form-control form-control-sm",placeholder:"Contoh: Hafalan Al Qur'an 10 Juz",required:""},null,512),[[h,l.value.full_name]]),e[31]||(e[31]=a("small",{class:"text-muted"}," Nama lengkap cabang yang akan tampil di publik atau dokumen resmi. ",-1))]),e[32]||(e[32]=a("div",{class:"alert alert-info py-2 px-3 mt-3 text-sm"},[a("strong",null,"Catatan:"),b(" Data master cabang ini dapat digunakan sebagai template konfigurasi cabang pada berbagai event, tanpa perlu input ulang. ")],-1))])]),a("div",Ga,[a("button",{type:"submit",class:"btn btn-sm btn-primary",disabled:_.value},[_.value?(d(),i("i",Sa)):(d(),i("i",Ta)),e[33]||(e[33]=b(" Simpan "))],8,Na)])],32)])])])])])],64))}};export{Aa as default};
