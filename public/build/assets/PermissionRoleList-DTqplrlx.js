import{F as d,B as U,G as Y,J,P as l,Q as i,as as K,R as e,ah as C,ap as V,W as S,a5 as y,aw as R,Z as u,U as c,au as Q}from"./pinia-BDOwh8JO.js";import{u as Z,b,e as z}from"./app-D-g1j7c6.js";import{S as B}from"./sweetalert2.esm.all-9Qm2jZ7z.js";const X={class:"content"},ss={class:"container-fluid"},es={class:"card"},ts={class:"card-header"},as={class:"card-body table-responsive p-0"},os={class:"table table-bordered table-hover text-sm"},ns={key:0},ls={key:1},is={class:"text-center"},rs=["onClick"],ds={class:"modal fade",id:"rolePermissionModal",tabindex:"-1",role:"dialog"},us={class:"modal-dialog modal-lg",role:"document"},cs={class:"modal-content"},ms={class:"modal-header py-2 bg-primary text-white"},ps={key:0,class:"d-block"},vs={class:"text-white"},gs={class:"modal-body",style:{background:"#f4f6f9"}},fs={key:0,class:"text-center my-3"},hs={key:1},ys={class:"mb-2"},bs={key:0,class:"text-center text-muted py-4"},ks={class:"card-header py-2 bg-dark text-white d-flex align-items-center"},_s={class:"custom-control custom-checkbox mb-0"},xs=["id","checked","onChange"],ws=["for"],Ps={class:"ml-1",style:{opacity:".9"}},Cs={class:"card-body py-2"},Ss=["id","value"],Rs=["for"],Gs={class:"text-muted"},Ms={class:"text-muted text-sm mb-0"},As={class:"modal-footer py-2"},Ls=["disabled"],Ns={key:0,class:"fas fa-spinner fa-spin mr-1"},Es={key:1,class:"fas fa-save mr-1"},Bs={__name:"PermissionRoleList",setup(Ts){const G=Z(),k=d([]),_=d(!1),v=d(""),m=d(null),x=d(!1),g=d(!1),f=d(""),w=d([]),P=d([]),r=d([]),F=async()=>{_.value=!0;try{const a=await b.get("/api/v1/roles-simple");k.value=a.data||[]}catch(a){console.error("Gagal memuat roles:",a),a.response&&a.response.status===401&&G.logout()}finally{_.value=!1}},M=U(()=>{if(!v.value)return k.value;const a=v.value.toLowerCase();return k.value.filter(s=>s.name&&s.name.toLowerCase().includes(a)||s.slug&&s.slug.toLowerCase().includes(a))});Y(v,z(()=>{},250));const A=async()=>{try{const a=await b.get("/api/v1/permissions-simple");w.value=a.data||[]}catch(a){console.error("Gagal memuat permissions:",a)}},L={"manage.master":"MASTER DATA","manage.event":"EVENT","manage.pricing":"PRICING","manage.payment-verifications":"PAYMENT VERIFICATIONS"},N=["manage.master","manage.event","manage.pricing","manage.payment-verifications"],E=new Set(["manage.master","manage.event","manage.pricing","manage.payment-verifications"]),D=(a="")=>{const s=String(a||"");return s.startsWith("manage.payment-verifications")?"manage.payment-verifications":s.startsWith("manage.pricing")?"manage.pricing":s.startsWith("manage.event")?"manage.event":s.startsWith("manage.master")?"manage.master":"other"},O=(a,s)=>{const n=String(a.slug||""),t=String(s.slug||""),o=E.has(n),p=E.has(t);if(o!==p)return o?-1:1;const T=n.split(".").length,I=t.split(".").length;return T!==I?T-I:n.localeCompare(t)},h=U(()=>{const a=(f.value||"").toLowerCase().trim(),s={};N.forEach(t=>{s[t]={key:t,title:L[t]||t,permissions:[]}}),s.other={key:"other",title:"LAINNYA",permissions:[]};const n=t=>{if(!a)return!0;const o=(t.slug||"").toLowerCase(),p=(t.name||"").toLowerCase();return o.includes(a)||p.includes(a)};for(const t of w.value||[]){if(!n(t))continue;const o=D(t.slug);s[o]||(s[o]={key:o,title:L[o]||o,permissions:[]}),s[o].permissions.push(t)}return Object.values(s).forEach(t=>t.permissions.sort(O)),[...N.map(t=>s[t]).filter(t=>t&&t.permissions.length),...s.other.permissions.length?[s.other]:[]]}),W=async a=>{f.value="",m.value=a,x.value=!0,r.value=[],P.value=[],$("#rolePermissionModal").modal("show");try{w.value.length||await A();const s=await b.get("/api/v1/permission-roles",{params:{role_id:a.id,per_page:1e3}});P.value=s.data.data||[],r.value=P.value.map(n=>n.permission_id)}catch(s){console.error("Gagal memuat permission role:",s),s.response&&s.response.status===401&&G.logout()}finally{x.value=!1}},j=async()=>{var a,s;if(m.value){g.value=!0;try{await b.post(`/api/v1/roles/${m.value.id}/sync-permissions`,{permission_ids:r.value}),B.fire({icon:"success",title:"Hak akses berhasil disimpan.",showConfirmButton:!1,timer:1400}),$("#rolePermissionModal").modal("hide")}catch(n){console.error("Gagal sync permissions:",n),B.fire("Gagal",((s=(a=n.response)==null?void 0:a.data)==null?void 0:s.message)||"Gagal menyimpan hak akses.","error")}finally{g.value=!1}}},H=a=>{const s=h.value.find(n=>n.key===a);return!s||!s.permissions.length?!1:s.permissions.every(n=>r.value.includes(n.id))},q=(a,s)=>{const n=h.value.find(o=>o.key===a);if(!n)return;const t=n.permissions.map(o=>o.id);s?r.value=Array.from(new Set([...r.value,...t])):r.value=r.value.filter(o=>!t.includes(o))};return J(()=>{F(),A()}),(a,s)=>{var n;return i(),l(y,null,[s[17]||(s[17]=K('<section class="content-header"><div class="container-fluid"><div class="d-flex justify-content-between align-items-center"><div><h1 class="mb-1">Pengaturan Hak Akses Role</h1><p class="mb-0 text-muted text-sm"> Pilih role lalu atur menu / permission yang boleh diakses. </p></div></div></div></section>',1)),e("section",X,[e("div",ss,[e("div",es,[e("div",ts,[C(e("input",{"onUpdate:modelValue":s[0]||(s[0]=t=>v.value=t),type:"text",class:"form-control",placeholder:"Cari nama role atau slug..."},null,512),[[V,v.value]])]),e("div",as,[e("table",os,[s[6]||(s[6]=e("thead",{class:"thead-light"},[e("tr",null,[e("th",{style:{width:"40px"}},"#"),e("th",null,"Nama Role"),e("th",null,"Slug"),e("th",{style:{width:"80px"}},"Aksi")])],-1)),e("tbody",null,[_.value?(i(),l("tr",ns,s[3]||(s[3]=[e("td",{colspan:"4",class:"text-center"},"Memuat data role...",-1)]))):M.value.length===0?(i(),l("tr",ls,s[4]||(s[4]=[e("td",{colspan:"4",class:"text-center"},"Tidak ada role ditemukan.",-1)]))):S("",!0),(i(!0),l(y,null,R(M.value,(t,o)=>(i(),l("tr",{key:t.id},[e("td",null,c(o+1),1),e("td",null,c(t.name),1),e("td",null,[e("code",null,c(t.slug),1)]),e("td",is,[e("button",{class:"btn btn-sm btn-outline-success",title:"Atur Permission",onClick:p=>W(t)},s[5]||(s[5]=[e("i",{class:"fas fa-sliders-h"},null,-1)]),8,rs)])]))),128))])])])])]),e("div",ds,[e("div",us,[e("div",cs,[e("div",ms,[e("div",null,[s[10]||(s[10]=e("h5",{class:"modal-title mb-0"},[e("i",{class:"fas fa-user-shield mr-1"}),u(" Pengaturan Hak Akses ")],-1)),m.value?(i(),l("small",ps,[s[7]||(s[7]=u(" Role: ")),e("strong",null,c(m.value.name),1),s[8]||(s[8]=u(" (")),e("code",vs,c(m.value.slug),1),s[9]||(s[9]=u(") "))])):S("",!0)]),s[11]||(s[11]=e("button",{type:"button",class:"close","data-dismiss":"modal"},[e("span",{class:"text-white"},"Ã—")],-1))]),e("div",gs,[x.value?(i(),l("div",fs,s[12]||(s[12]=[e("i",{class:"fas fa-spinner fa-spin mr-1"},null,-1),u(" Memuat permission... ")]))):(i(),l("div",hs,[e("div",ys,[C(e("input",{"onUpdate:modelValue":s[1]||(s[1]=t=>f.value=t),type:"text",class:"form-control form-control-sm",placeholder:"Cari permission... (contoh: manage.event.judges)"},null,512),[[V,f.value]])]),h.value.length===0?(i(),l("div",bs," Tidak ada permission sesuai pencarian. ")):S("",!0),(i(!0),l(y,null,R(h.value,t=>(i(),l("div",{key:t.key,class:"card mb-3 border-0 shadow-sm"},[e("div",ks,[e("div",_s,[e("input",{type:"checkbox",class:"custom-control-input",id:"group-"+t.key,checked:H(t.key),onChange:o=>q(t.key,o.target.checked)},null,40,xs),e("label",{class:"custom-control-label font-weight-bold",for:"group-"+t.key},[u(c(t.title)+" ",1),e("small",Ps,"("+c(t.key)+")",1)],8,ws)])]),e("div",Cs,[(i(!0),l(y,null,R(t.permissions,o=>(i(),l("div",{key:o.id,class:"custom-control custom-checkbox mb-1"},[C(e("input",{type:"checkbox",class:"custom-control-input",id:"perm-"+o.id,value:o.id,"onUpdate:modelValue":s[2]||(s[2]=p=>r.value=p)},null,8,Ss),[[Q,r.value]]),e("label",{class:"custom-control-label",for:"perm-"+o.id},[u(c(o.name)+" ",1),e("small",Gs,"("+c(o.slug)+")",1)],8,Rs)]))),128))])]))),128)),e("p",Ms,[s[13]||(s[13]=u(" Centang permission yang boleh diakses oleh role ")),e("strong",null,c((n=m.value)==null?void 0:n.name),1),s[14]||(s[14]=u(". "))])]))]),e("div",As,[s[16]||(s[16]=e("button",{type:"button",class:"btn btn-secondary btn-sm","data-dismiss":"modal"}," Batal ",-1)),e("button",{type:"button",class:"btn btn-success btn-sm",disabled:g.value,onClick:j},[g.value?(i(),l("i",Ns)):(i(),l("i",Es)),s[15]||(s[15]=u(" Simpan Pengaturan "))],8,Ls)])])])])])],64)}}};export{Bs as default};
