import{A as u,O as K,V as A,B as i,C as d,ax as z,D as e,S as m,aB as w,as as k,K as F,U as f,ay as C,J as l,H as b,F as U,a as v,I as P,aC as I}from"./AuthUserStore-67h2FHdL.js";import{S as p}from"./sweetalert2.esm.all-9Qm2jZ7z.js";const J={class:"content"},W={class:"container-fluid"},Q={class:"card"},R={class:"card-header"},X={class:"d-flex flex-wrap justify-content-between align-items-center w-100"},Z={class:"d-flex align-items-center"},ee={class:"card-body table-responsive p-0"},te={class:"table table-bordered table-hover text-sm mb-0"},ae={key:0},se={key:1},le={class:"text-center align-middle"},ne=["onClick"],oe={class:"text-center"},ie={class:"text-center"},de={class:"text-center"},re={key:0},ue={colspan:"8",class:"bg-light"},me={class:"d-flex justify-content-between align-items-center mb-2"},pe={class:"text-sm"},ce={class:"text-muted"},_e=["onClick"],fe={class:"table table-sm table-bordered mb-0"},ve={key:0},be={class:"text-center"},ge={class:"text-center"},he={class:"text-center"},xe={class:"text-center"},ye={class:"text-center"},we={class:"btn-group btn-group-sm"},ke=["onClick"],Ce=["onClick"],Me={class:"card-footer clearfix py-2"},Ge={class:"d-flex justify-content-between align-items-center"},Be={class:"text-muted text-sm"},Te={class:"pagination pagination-sm m-0"},Fe={class:"page-item disabled"},Ue={class:"page-link"},Ve={class:"modal fade",id:"masterFieldComponentModal",tabindex:"-1",role:"dialog","aria-labelledby":"masterFieldComponentModalLabel"},$e={class:"modal-dialog modal-lg",role:"document"},Se={class:"modal-content"},De={class:"modal-header py-2"},Ke={class:"modal-title",id:"masterFieldComponentModalLabel"},Pe={class:"modal-body pt-2"},Ee={class:"row"},He={class:"col-md-6"},Le={class:"form-group mb-2"},Ne=["value"],je={class:"form-group mb-2"},Ye=["value"],Oe={class:"form-group mb-2"},qe={class:"col-md-6"},Ae={class:"form-group mb-2"},ze={class:"form-group mb-2"},Ie={class:"form-group mb-2"},Je={class:"text-right mt-3"},We=["disabled"],Qe={key:0,class:"fas fa-spinner fa-spin mr-1"},Re={key:1,class:"fas fa-save mr-1"},tt={__name:"MasterFieldComponents",setup(Xe){const M=u([]),V=u([]),S=u([]),g=u(""),h=u(10),G=u(!1),x=u(!1),y=u(!1),c=u([]),o=u({current_page:1,per_page:10,total:0,from:0,to:0,last_page:1}),n=u({id:null,master_group_id:"",field_id:"",default_weight:null,default_max_score:null,default_order:null,is_default:!1}),B=s=>c.value.includes(s),E=s=>{B(s)?c.value=c.value.filter(t=>t!==s):c.value.push(s)},H=async()=>{try{const[s,t]=await Promise.all([v.get("/api/v1/master-groups",{params:{simple:1}}),v.get("/api/v1/list-fields",{params:{simple:1}})]);V.value=s.data.data||[],S.value=t.data.data||[]}catch(s){console.error("Gagal memuat options master groups / fields:",s),p.fire("Gagal","Gagal memuat master group atau list field.","error")}},_=async(s=1)=>{G.value=!0;try{const a=(await v.get("/api/v1/master-groups",{params:{page:s,per_page:h.value,search:g.value,with_fields:1}})).data.data;M.value=a.data||[],o.value={current_page:a.current_page,per_page:a.per_page,total:a.total,from:a.from,to:a.to,last_page:a.last_page}}catch(t){console.error("Gagal memuat master groups:",t),p.fire("Gagal","Gagal memuat data master groups.","error")}finally{G.value=!1}},D=s=>{s<1||s>o.value.last_page||_(s)},L=(s=null)=>{if(x.value=!1,n.value={id:null,master_group_id:s?s.id:"",field_id:"",default_weight:null,default_max_score:null,default_order:1,is_default:!1},s&&(s.field_components||s.fieldComponents)){const t=s.field_components||s.fieldComponents;n.value.default_order=((t==null?void 0:t.length)||0)+1}$("#masterFieldComponentModal").modal("show")},N=(s,t=null)=>{x.value=!0,n.value={id:s.id,master_group_id:s.master_group_id||(t?t.id:""),field_id:s.field_id,default_weight:s.default_weight,default_max_score:s.default_max_score,default_order:s.default_order,is_default:!!s.is_default},$("#masterFieldComponentModal").modal("show")},j=async()=>{y.value=!0;const s={master_group_id:n.value.master_group_id,field_id:n.value.field_id,default_weight:n.value.default_weight,default_max_score:n.value.default_max_score,default_order:n.value.default_order,is_default:n.value.is_default};try{x.value&&n.value.id?(await v.put(`/api/v1/master-field-components/${n.value.id}`,s),p.fire("Berhasil","Master field component berhasil diperbarui.","success")):(await v.post("/api/v1/master-field-components",s),p.fire("Berhasil","Master field component berhasil ditambahkan.","success")),$("#masterFieldComponentModal").modal("hide"),_(o.value.current_page)}catch(t){console.error("Gagal menyimpan master_field_component:",t);let a="Gagal menyimpan data master field component.";t.response&&t.response.status===422&&t.response.data.message&&(a=t.response.data.message),p.fire("Gagal",a,"error")}finally{y.value=!1}},Y=async(s,t=null)=>{if((await p.fire({title:"Hapus Komponen?",text:`Yakin ingin menghapus komponen "${s.field_name}" dari master group ini?`,icon:"warning",showCancelButton:!0,confirmButtonText:"Ya, Hapus",cancelButtonText:"Batal",confirmButtonColor:"#d33",cancelButtonColor:"#3085d6"})).isConfirmed)try{await v.delete(`/api/v1/master-field-components/${s.id}`),p.fire("Terhapus","Master field component berhasil dihapus.","success"),_(o.value.current_page)}catch(T){console.error("Gagal menghapus master_field_component:",T),p.fire("Gagal","Gagal menghapus data master field component.","error")}};return K(()=>g.value,I(()=>{c.value=[],_(1)},400)),K(()=>h.value,()=>{c.value=[],_(1)}),A(()=>{H(),_()}),(s,t)=>(d(),i(f,null,[t[35]||(t[35]=z('<section class="content-header"><div class="container-fluid"><div class="d-flex justify-content-between align-items-center"><div><h1 class="mb-1">Master Komponen Penilaian per Master Group</h1><p class="mb-0 text-muted text-sm"> Mengatur komponen penilaian (Lagu, Suara, Tajwid, dll.) beserta bobot &amp; nilai maksimum untuk setiap Master Group (Cabang + Golongan). </p></div></div></div></section>',1)),e("section",J,[e("div",W,[e("div",Q,[e("div",R,[e("div",X,[e("div",Z,[t[11]||(t[11]=e("label",{class:"mb-0 mr-1 text-sm text-muted"},"Tampilkan",-1)),m(e("select",{"onUpdate:modelValue":t[0]||(t[0]=a=>h.value=a),class:"form-control form-control-sm w-auto mr-2"},t[10]||(t[10]=[e("option",{value:10},"10",-1),e("option",{value:25},"25",-1),e("option",{value:50},"50",-1),e("option",{value:100},"100",-1)]),512),[[w,h.value,void 0,{number:!0}]]),t[12]||(t[12]=e("label",{class:"mb-0 text-sm text-muted"},"Master Group / halaman",-1))]),m(e("input",{"onUpdate:modelValue":t[1]||(t[1]=a=>g.value=a),type:"text",class:"form-control form-control-sm w-auto",style:{"min-width":"220px"},placeholder:"Cari nama master group..."},null,512),[[k,g.value]])])]),e("div",ee,[e("table",te,[t[21]||(t[21]=e("thead",{class:"thead-light"},[e("tr",null,[e("th",{style:{width:"40px"}}),e("th",{style:{width:"40px"}},"#"),e("th",null,"Master Group"),e("th",null,"Cabang"),e("th",null,"Golongan"),e("th",{style:{width:"80px"},class:"text-center"},"Maks Usia"),e("th",{style:{width:"80px"},class:"text-center"},"Tim?"),e("th",{style:{width:"80px"},class:"text-center"},"Urutan"),e("th",{style:{width:"80px"},class:"text-center"},"Bidang")])],-1)),e("tbody",null,[G.value?(d(),i("tr",ae,t[13]||(t[13]=[e("td",{colspan:"9",class:"text-center"},"Memuat data master group...",-1)]))):M.value.length===0?(d(),i("tr",se,t[14]||(t[14]=[e("td",{colspan:"9",class:"text-center"},[F(" Belum ada master group. "),e("br"),e("small",{class:"text-muted"}," Silakan buat Master Group terlebih dahulu. ")],-1)]))):(d(!0),i(f,{key:2},C(M.value,(a,T)=>(d(),i(f,{key:a.id},[e("tr",null,[e("td",le,[e("button",{class:"btn btn-xs btn-outline-secondary",onClick:r=>E(a.id)},[e("i",{class:b(["fas",B(a.id)?"fa-chevron-up":"fa-chevron-down"])},null,2)],8,ne)]),e("td",null,l(T+1+(o.value.current_page-1)*o.value.per_page),1),e("td",null,[e("strong",null,l(a.full_name),1)]),e("td",null,l(a.branch_name),1),e("td",null,l(a.group_name),1),e("td",oe,l(a.max_age??"-"),1),e("td",ie,[e("span",{class:b(["badge",a.is_team?"badge-success":"badge-secondary"])},l(a.is_team?"Tim":"Individu"),3)]),e("td",de,l(a.order_number??"-"),1),e("td",null,l((a.field_components||a.fieldComponents||[]).length),1)]),B(a.id)?(d(),i("tr",re,[t[20]||(t[20]=e("td",null,null,-1)),e("td",ue,[e("div",me,[e("div",pe,[t[15]||(t[15]=e("strong",null,"Komponen Penilaian:",-1)),e("span",ce,l((a.field_components||a.fieldComponents||[]).length)+" komponen ",1)]),e("button",{class:"btn btn-xs btn-primary",onClick:r=>L(a)},' + Tambah Komponen untuk "'+l(a.full_name)+'" ',9,_e)]),e("table",fe,[t[19]||(t[19]=e("thead",{class:"thead-light"},[e("tr",null,[e("th",{style:{width:"40px"}},"#"),e("th",null,"Komponen"),e("th",{style:{width:"80px"},class:"text-center"},"Bobot %"),e("th",{style:{width:"110px"},class:"text-center"},"Max Nilai / Hakim"),e("th",{style:{width:"80px"},class:"text-center"},"Urutan"),e("th",{style:{width:"80px"},class:"text-center"},"Default?"),e("th",{style:{width:"110px"},class:"text-center"},"Aksi")])],-1)),e("tbody",null,[(a.field_components||a.fieldComponents||[]).length===0?(d(),i("tr",ve,t[16]||(t[16]=[e("td",{colspan:"7",class:"text-center text-muted"}," Belum ada komponen penilaian untuk master group ini. ",-1)]))):P("",!0),(d(!0),i(f,null,C(a.field_components||a.fieldComponents||[],(r,O)=>(d(),i("tr",{key:r.id},[e("td",null,l(O+1),1),e("td",null,l(r.field_name),1),e("td",be,l(r.default_weight??"-"),1),e("td",ge,l(r.default_max_score??"-"),1),e("td",he,l(r.default_order??"-"),1),e("td",xe,[e("span",{class:b(["badge",r.is_default?"badge-success":"badge-secondary"])},l(r.is_default?"Ya":"Tidak"),3)]),e("td",ye,[e("div",we,[e("button",{class:"btn btn-warning",onClick:q=>N(r,a)},t[17]||(t[17]=[e("i",{class:"fas fa-edit"},null,-1)]),8,ke),e("button",{class:"btn btn-danger",onClick:q=>Y(r,a)},t[18]||(t[18]=[e("i",{class:"fas fa-trash"},null,-1)]),8,Ce)])])]))),128))])])])])):P("",!0)],64))),128))])])]),e("div",Me,[e("div",Ge,[e("div",Be," Menampilkan "+l(o.value.from||0)+" - "+l(o.value.to||0)+" dari "+l(o.value.total||0)+" master group ",1),e("ul",Te,[e("li",{class:b(["page-item",{disabled:o.value.current_page===1}])},[e("a",{href:"#",class:"page-link",onClick:t[2]||(t[2]=U(a=>D(o.value.current_page-1),["prevent"]))}," « ")],2),e("li",Fe,[e("span",Ue," Halaman "+l(o.value.current_page)+" / "+l(o.value.last_page||1),1)]),e("li",{class:b(["page-item",{disabled:o.value.current_page===o.value.last_page}])},[e("a",{href:"#",class:"page-link",onClick:t[3]||(t[3]=U(a=>D(o.value.current_page+1),["prevent"]))}," » ")],2)])])])])]),e("div",Ve,[e("div",$e,[e("div",Se,[e("div",De,[e("h5",Ke,[t[22]||(t[22]=e("i",{class:"fas fa-sliders-h mr-1"},null,-1)),F(" "+l(x.value?"Edit Komponen Penilaian":"Tambah Komponen Penilaian"),1)]),t[23]||(t[23]=e("button",{type:"button",class:"close","data-dismiss":"modal"},[e("span",null,"×")],-1))]),e("div",Pe,[e("form",{onSubmit:U(j,["prevent"])},[e("div",Ee,[e("div",He,[e("div",Le,[t[25]||(t[25]=e("label",{class:"mb-1"},"Master Group",-1)),m(e("select",{"onUpdate:modelValue":t[4]||(t[4]=a=>n.value.master_group_id=a),class:"form-control form-control-sm",required:""},[t[24]||(t[24]=e("option",{value:"",disabled:""},"-- pilih master group --",-1)),(d(!0),i(f,null,C(V.value,a=>(d(),i("option",{key:a.id,value:a.id},l(a.full_name||a.branch_name+" - "+a.group_name),9,Ne))),128))],512),[[w,n.value.master_group_id]])]),e("div",je,[t[27]||(t[27]=e("label",{class:"mb-1"},"Komponen Penilaian",-1)),m(e("select",{"onUpdate:modelValue":t[5]||(t[5]=a=>n.value.field_id=a),class:"form-control form-control-sm",required:""},[t[26]||(t[26]=e("option",{value:"",disabled:""},"-- pilih komponen --",-1)),(d(!0),i(f,null,C(S.value,a=>(d(),i("option",{key:a.id,value:a.id},l(a.name),9,Ye))),128))],512),[[w,n.value.field_id]]),t[28]||(t[28]=e("small",{class:"text-muted"}," Data diambil dari master List Fields. ",-1))]),e("div",Oe,[t[29]||(t[29]=e("label",{class:"mb-1"},"Urutan Tampil (Default Order)",-1)),m(e("input",{"onUpdate:modelValue":t[6]||(t[6]=a=>n.value.default_order=a),type:"number",min:"1",class:"form-control form-control-sm"},null,512),[[k,n.value.default_order,void 0,{number:!0}]])])]),e("div",qe,[e("div",Ae,[t[30]||(t[30]=e("label",{class:"mb-1"},"Bobot (%)",-1)),m(e("input",{"onUpdate:modelValue":t[7]||(t[7]=a=>n.value.default_weight=a),type:"number",min:"0",max:"100",class:"form-control form-control-sm"},null,512),[[k,n.value.default_weight,void 0,{number:!0}]])]),e("div",ze,[t[31]||(t[31]=e("label",{class:"mb-1"},"Max Nilai per Hakim",-1)),m(e("input",{"onUpdate:modelValue":t[8]||(t[8]=a=>n.value.default_max_score=a),type:"number",min:"0",class:"form-control form-control-sm"},null,512),[[k,n.value.default_max_score,void 0,{number:!0}]])]),e("div",Ie,[t[33]||(t[33]=e("label",{class:"mb-1"},"Digunakan sebagai Template Default?",-1)),m(e("select",{"onUpdate:modelValue":t[9]||(t[9]=a=>n.value.is_default=a),class:"form-control form-control-sm"},t[32]||(t[32]=[e("option",{value:!1},"Tidak",-1),e("option",{value:!0},"Ya",-1)]),512),[[w,n.value.is_default]])])])]),e("div",Je,[e("button",{type:"submit",class:"btn btn-sm btn-primary",disabled:y.value},[y.value?(d(),i("i",Qe)):(d(),i("i",Re)),t[34]||(t[34]=F(" Simpan "))],8,We)])],32)])])])])])],64))}};export{tt as default};
