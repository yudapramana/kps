import{_ as R,u as A,$ as v,a as E,b as T}from"./app-qojnDOIY.js";import"./style-DE--g_Jd.js";import{u as H}from"./MasterDataStore-etzB0CoQ.js";import{F as c,J as P,P as V,Q as F,as as W,R as o,a5 as J,H as h}from"./pinia-BDOwh8JO.js";const L={__name:"WorkUnitMonitor",setup(q){const b=A(),k=E(),u=c([]),p=c(new Map),w=c(!1),_=c(null);c(new Map);const m=t=>String(t).replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#39;"),x=t=>{const e=new Map,a=s=>{var r;for(const l of s)e.set(String(l.id),l),(r=l.children)!=null&&r.length&&a(l.children)};return a(t),e},$=()=>u.value.map(e=>({id:String(e.id),text:m(e.unit_name),type:"workunit",children:!0})),M=t=>{const e=p.value.get(String(t));return e?(e.children||[]).map(s=>({id:String(s.id),text:m(s.unit_name),type:"workunit",children:!0})):[]},S=async t=>{const e=String(t);if(i.employeesCacheByUnit[e])return i.employeesCacheByUnit[e];const a=await T.get(`/api/work-units/${e}/employees`),s=Array.isArray(a.data)?a.data:a.data.data??[];return i.setEmployees(e,s),s},f=async()=>{await h();const t=v("#tree-container");t.jstree(!0)&&t.jstree(!0).destroy(),t.off("click",".js-doc-link"),t.off(".jstree").jstree({core:{check_callback:!0,themes:{stripes:!0},html_titles:!0,data:async(e,a)=>{var s;try{if(e.id==="#"){a($());return}if(e.type==="employee"){a([]);return}const r=e.id,l=M(r),C=n=>n>=80?"bg-success":n>=60?"bg-info":n>=40?"bg-warning":"bg-danger",N=await S(r),D=["SUPERADMIN","ADMIN"].includes((s=b.user)==null?void 0:s.role),g=N.map(n=>{const d=Number(n.progress_dokumen??0),y=d.toFixed(2),B=m(n.full_name),I=C(d);return{id:`emp-${r}-${n.id}`,type:"employee",children:!1,text:`
                  <span class="w-100">
                    <span class="emp-label">${B} â€” ${d}%</span>
                    ${D?`<a href="#"
                            class="badge badge-sm badge-info ml-2 js-doc-link"
                            data-user-id="${n.id}">
                            <i class="far fa-folder"></i> dokumen
                          </a>`:`<span class="badge badge-sm badge-secondary ml-2" title="Hanya untuk admin">
                            <i class="far fa-folder"></i> dokumen
                          </span>`}
                    <div class="progress progress-xxs">
                      <div class="progress-bar ${I} progress-bar-striped" role="progressbar"
                          aria-valuenow="${y}" aria-valuemin="0" aria-valuemax="100"
                          style="width: ${Math.max(0,Math.min(100,d))}%">
                        <span class="sr-only">${y}% Complete</span>
                      </div>
                    </div>
                  </span>
                `}});if(l.length===0&&g.length===0){a([{id:`info-empty-${r}`,text:"Belum ada data.",type:"info",children:!1,li_attr:{class:"text-muted"}}]);return}a([...l,...g])}catch{a([{id:`info-error-${e.id}-${Date.now()}`,text:"Gagal memuat data.",type:"info",children:!1,li_attr:{class:"text-danger"}}])}}},plugins:["types","state"],state:{key:"monitor-tree-v1"},types:{workunit:{icon:"far fa-folder"},employee:{icon:"far fa-user"},info:{icon:"far fa-circle"}}}),_.value=t.jstree(!0),w.value=!0,t.on("click",".js-doc-link",e=>{e.preventDefault(),e.stopPropagation();const a=e.currentTarget.getAttribute("data-user-id");a&&k.push(`/admin/users/${a}/documents`)}),t.on("select_node.jstree",(e,a)=>{})},j=async()=>{i.clearEmployeesCache(),await f()},U=async()=>{await h();const e=v("#tree-container").jstree(!0);if(e){try{e.clear_state()}catch{}try{e.deselect_all(!0),e.close_all("#",0)}catch{}try{e.redraw(!0)}catch{}}},i=H();return P(async()=>{i.hydrateEmployeesCache(),await i.getWorkUnitMonitorList();const t=i.workUnitMonitorList;console.log("resMaster"),console.log(t),u.value=t.data||[],p.value=x(u.value),await f()}),(t,e)=>(F(),V(J,null,[e[2]||(e[2]=W('<div class="content-header" data-v-52343237><div class="container-fluid" data-v-52343237><div class="row mb-2" data-v-52343237><div class="col-sm-6" data-v-52343237><h1 class="m-0" data-v-52343237>Monitor Satuan Kerja</h1></div><div class="col-sm-6" data-v-52343237><ol class="breadcrumb float-sm-right" data-v-52343237><li class="breadcrumb-item" data-v-52343237><a href="#" data-v-52343237>Home</a></li><li class="breadcrumb-item active" data-v-52343237>Daftar Satker</li></ol></div></div></div></div>',1)),o("div",{class:"content"},[o("div",{class:"container-fluid"},[o("div",{class:"d-flex justify-content-between align-items-center mb-3"},[e[0]||(e[0]=o("h5",{class:"mb-0"},"Monitoring Pegawai",-1)),o("div",{class:"btn-group"},[o("button",{class:"btn btn-sm btn-primary",onClick:j}," Refresh "),o("button",{class:"btn btn-sm btn-outline-secondary",onClick:U}," Reset View ")])]),e[1]||(e[1]=o("div",{id:"tree-container"},null,-1))])])],64))}},z=R(L,[["__scopeId","data-v-52343237"]]);export{z as default};
