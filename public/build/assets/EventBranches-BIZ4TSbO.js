import{z as O,y as D,A as m,O as x,V as Q,B as i,C as u,D as e,I as G,K as c,S as b,aB as C,as as w,U as S,ay as L,J as d,H as T,F as M,a as p,L as R,aC as W}from"./AuthUserStore-67h2FHdL.js";import{S as o}from"./sweetalert2.esm.all-9Qm2jZ7z.js";const X={class:"content-header"},Z={class:"container-fluid"},ee={class:"d-flex justify-content-between align-items-center"},ae={class:"d-flex flex-column flex-sm-row gap-2"},te=["disabled"],se={key:0,class:"fas fa-spinner fa-spin mr-1"},ne={key:1,class:"fas fa-magic mr-1"},le=["disabled"],oe={key:0,class:"text-danger text-sm mt-2 mb-0"},re={class:"content"},ie={class:"container-fluid"},ue={class:"card"},de={class:"card-header"},me={class:"d-flex flex-wrap justify-content-between align-items-center w-100"},ce={class:"d-flex align-items-center"},ve={class:"d-flex align-items-center gap-2"},be={class:"card-body table-responsive p-0"},pe={class:"table table-bordered table-hover text-sm mb-0"},ge={key:0},fe={key:1},he={class:"text-center"},_e={class:"text-center"},ke={class:"text-center"},ye={class:"btn-group btn-group-sm"},xe=["onClick"],Ce=["onClick"],we=["onClick"],Be={class:"card-footer clearfix py-2"},Ee={class:"d-flex justify-content-between align-items-center"},Ge={class:"text-muted text-sm"},Se={class:"pagination pagination-sm m-0"},Te={class:"page-item disabled"},Me={class:"page-link"},Ue={class:"modal fade",id:"eventBranchModal",tabindex:"-1",role:"dialog","aria-labelledby":"eventBranchModalLabel"},Ne={class:"modal-dialog modal-lg",role:"document"},Ve={class:"modal-content"},$e={class:"modal-header py-2"},De={class:"modal-title",id:"eventBranchModalLabel"},Le={class:"modal-body pt-2"},Ae={class:"row"},Fe={class:"col-md-6"},Pe={class:"form-group mb-2"},He=["value"],Ie={key:0},je={class:"form-group mb-2"},qe={class:"col-md-6"},Je={class:"form-group mb-2"},Ke={class:"form-group mb-2"},Ye={class:"form-group mb-2"},ze={class:"text-right mt-3"},Oe=["disabled"],Qe={key:0,class:"fas fa-spinner fa-spin mr-1"},Re={key:1,class:"fas fa-save mr-1"},ea={__name:"EventBranches",setup(We){const A=O(),F=R(),P=s=>{F.push({name:"admin.event.groups",query:{branch_id:s.branch_id}})},H=D(()=>A.eventData||null),r=D(()=>{var s;return((s=H.value)==null?void 0:s.id)||null}),B=m([]),U=m([]),g=m("active"),f=m(""),h=m(25),E=m(!1),_=m(!1),k=m(!1),y=m(!1),l=m({current_page:1,per_page:10,total:0,from:0,to:0,last_page:1}),n=m({id:null,branch_id:"",branch_name:"",full_name:"",status:"active",order_number:null}),I=async()=>{try{const s=await p.get("/api/v1/branches",{params:{simple:1}});U.value=s.data.data||[]}catch(s){console.error("Gagal memuat branches:",s),o.fire("Gagal","Gagal memuat daftar cabang (branches).","error")}},v=async(s=1)=>{if(r.value){E.value=!0;try{const t=(await p.get("/api/v1/event-branches",{params:{event_id:r.value,page:s,per_page:h.value,search:f.value,status:g.value,from_crud:1}})).data.data;B.value=t.data||[],l.value={current_page:t.current_page,per_page:t.per_page,total:t.total,from:t.from,to:t.to,last_page:t.last_page}}catch(a){console.error("Gagal memuat event_branches:",a),o.fire("Gagal","Gagal memuat data event branches.","error")}finally{E.value=!1}}},N=s=>{s<1||s>l.value.last_page||v(s)},j=()=>{if(!r.value){o.fire("Event belum dipilih","Silakan pilih event melalui Portal Event sebelum mengelola cabang.","warning");return}_.value=!1,n.value={id:null,branch_id:"",branch_name:"",full_name:"",status:"active",order_number:(l.value.total||0)+1},$("#eventBranchModal").modal("show")},q=s=>{_.value=!0,n.value={id:s.id,branch_id:s.branch_id,branch_name:s.branch_name,full_name:s.full_name,status:s.status,order_number:s.order_number},$("#eventBranchModal").modal("show")},J=async()=>{if(!r.value){o.fire("Event belum dipilih","Silakan pilih event melalui Portal Event sebelum mengelola cabang.","warning");return}k.value=!0;const s={event_id:r.value,branch_id:n.value.branch_id,branch_name:n.value.branch_name,full_name:n.value.full_name,status:n.value.status,order_number:n.value.order_number};try{_.value&&n.value.id?(await p.put(`/api/v1/event-branches/${n.value.id}`,s),o.fire("Berhasil","Cabang event berhasil diperbarui.","success")):(await p.post("/api/v1/event-branches",s),o.fire("Berhasil","Cabang event berhasil ditambahkan.","success")),$("#eventBranchModal").modal("hide"),v(l.value.current_page)}catch(a){console.error("Gagal menyimpan event_branch:",a);let t="Gagal menyimpan data cabang event.";a.response&&a.response.status===422&&a.response.data.message&&(t=a.response.data.message),o.fire("Gagal",t,"error")}finally{k.value=!1}},K=async s=>{if((await o.fire({title:"Hapus Cabang Event?",text:`Yakin ingin menghapus cabang "${s.branch_name}" dari event ini?`,icon:"warning",showCancelButton:!0,confirmButtonText:"Ya, Hapus",cancelButtonText:"Batal",confirmButtonColor:"#d33",cancelButtonColor:"#3085d6"})).isConfirmed)try{await p.delete(`/api/v1/event-branches/${s.id}`),o.fire("Terhapus","Cabang event berhasil dihapus.","success"),v(l.value.current_page)}catch(t){console.error("Gagal menghapus event_branch:",t),o.fire("Gagal","Gagal menghapus cabang event.","error")}},Y=async()=>{if(!r.value){o.fire("Event belum dipilih","Silakan pilih event melalui Portal Event sebelum generate dari template.","warning");return}if((await o.fire({title:"Generate dari Template?",text:"Cabang event akan dibuat berdasarkan Master Branches. Cabang yang sudah ada tidak akan diduplikasi.",icon:"question",showCancelButton:!0,confirmButtonText:"Ya, Generate",cancelButtonText:"Batal",confirmButtonColor:"#28a745",cancelButtonColor:"#6c757d"})).isConfirmed){y.value=!0;try{await p.post("/api/v1/event-branches/generate-from-template",{event_id:r.value}),o.fire("Berhasil","Cabang event berhasil digenerate dari template.","success"),v(1)}catch(a){console.error("Gagal generate dari template:",a);let t="Gagal generate cabang dari template.";a.response&&a.response.data&&a.response.data.message&&(t=a.response.data.message),o.fire("Gagal",t,"error")}finally{y.value=!1}}};return x(()=>g.value,()=>{v(1)}),x(()=>f.value,W(()=>v(1),400)),x(()=>h.value,()=>{v(1)}),x(()=>r.value,s=>{s&&v(1)}),Q(()=>{I(),r.value?v():o.fire("Event belum dipilih","Silakan pilih event melalui Portal Event terlebih dahulu.","info")}),(s,a)=>(u(),i(S,null,[e("section",X,[e("div",Z,[e("div",ee,[a[11]||(a[11]=e("div",null,[e("h1",{class:"mb-1"},"Cabang Lomba per Event (Event Branches)"),e("p",{class:"mb-0 text-muted text-sm"}," Mengatur cabang lomba yang diaktifkan pada event terpilih. Data ini dapat digenerate dari Master Branches lalu disesuaikan. ")],-1)),e("div",ae,[e("button",{class:"btn btn-outline-secondary btn-sm mr-sm-2 mb-2 mb-sm-0",onClick:Y,disabled:y.value||!r.value},[y.value?(u(),i("i",se)):(u(),i("i",ne)),a[10]||(a[10]=c(" Generate dari Template "))],8,te),e("button",{class:"btn btn-primary btn-sm",onClick:j,disabled:!r.value}," + Tambah Cabang ",8,le)])]),r.value?G("",!0):(u(),i("p",oe,a[12]||(a[12]=[e("i",{class:"fas fa-exclamation-triangle mr-1"},null,-1),c(" Event belum dipilih. Silakan pilih event melalui Portal Event terlebih dahulu. ")])))])]),e("section",re,[e("div",ie,[e("div",ue,[e("div",de,[e("div",me,[e("div",ce,[a[15]||(a[15]=e("label",{class:"mb-0 mr-1 text-sm text-muted"},"Tampilkan",-1)),b(e("select",{"onUpdate:modelValue":a[0]||(a[0]=t=>h.value=t),class:"form-control form-control-sm w-auto mr-2"},a[13]||(a[13]=[e("option",{value:10},"10",-1),e("option",{value:25},"25",-1),e("option",{value:50},"50",-1),e("option",{value:100},"100",-1)]),512),[[C,h.value,void 0,{number:!0}]]),a[16]||(a[16]=e("label",{class:"mb-0 text-sm text-muted mr-2"},"|",-1)),b(e("select",{"onUpdate:modelValue":a[1]||(a[1]=t=>g.value=t),class:"form-control form-control-sm w-auto"},a[14]||(a[14]=[e("option",{value:"active"},"Aktif",-1),e("option",{value:"inactive"},"Nonaktif",-1),e("option",{value:"all"},"Semua",-1)]),512),[[C,g.value]])]),e("div",ve,[b(e("input",{"onUpdate:modelValue":a[2]||(a[2]=t=>f.value=t),type:"text",class:"form-control form-control-sm w-auto",style:{"min-width":"220px"},placeholder:"Cari nama cabang..."},null,512),[[w,f.value]])])])]),e("div",be,[e("table",pe,[a[22]||(a[22]=e("thead",{class:"thead-light"},[e("tr",null,[e("th",{style:{width:"40px"}},"#"),e("th",null,"Nama Cabang"),e("th",null,"Nama Lengkap"),e("th",{style:{width:"90px"},class:"text-center"},"Status"),e("th",{style:{width:"90px"},class:"text-center"},"Urutan"),e("th",{style:{width:"110px"},class:"text-center"},"Aksi")])],-1)),e("tbody",null,[E.value?(u(),i("tr",ge,a[17]||(a[17]=[e("td",{colspan:"6",class:"text-center"},"Memuat data event branches...",-1)]))):B.value.length===0?(u(),i("tr",fe,a[18]||(a[18]=[e("td",{colspan:"6",class:"text-center"},[c(" Belum ada cabang terdaftar untuk event ini. "),e("br"),e("small",{class:"text-muted"},[c(" Klik "),e("strong",null,"Generate dari Template"),c(" atau "),e("strong",null,"Tambah Cabang Event"),c(". ")])],-1)]))):G("",!0),(u(!0),i(S,null,L(B.value,(t,z)=>(u(),i("tr",{key:t.id},[e("td",null,d(z+1+(l.value.current_page-1)*l.value.per_page),1),e("td",null,[e("strong",null,d(t.branch_name),1)]),e("td",null,d(t.full_name),1),e("td",he,[e("span",{class:T(["badge",t.status==="active"?"badge-success":"badge-secondary"])},d(t.status==="active"?"Aktif":"Nonaktif"),3)]),e("td",_e,d(t.order_number??"-"),1),e("td",ke,[e("div",ye,[e("button",{class:"btn btn-info",title:"Kelola Golongan untuk Cabang ini",onClick:V=>P(t)},a[19]||(a[19]=[e("i",{class:"fas fa-users"},null,-1)]),8,xe),e("button",{class:"btn btn-warning",onClick:V=>q(t)},a[20]||(a[20]=[e("i",{class:"fas fa-edit"},null,-1)]),8,Ce),e("button",{class:"btn btn-danger",onClick:V=>K(t)},a[21]||(a[21]=[e("i",{class:"fas fa-trash"},null,-1)]),8,we)])])]))),128))])])]),e("div",Be,[e("div",Ee,[e("div",Ge," Menampilkan "+d(l.value.from||0)+" - "+d(l.value.to||0)+" dari "+d(l.value.total||0)+" cabang event ",1),e("ul",Se,[e("li",{class:T(["page-item",{disabled:l.value.current_page===1}])},[e("a",{href:"#",class:"page-link",onClick:a[3]||(a[3]=M(t=>N(l.value.current_page-1),["prevent"]))}," « ")],2),e("li",Te,[e("span",Me," Halaman "+d(l.value.current_page)+" / "+d(l.value.last_page||1),1)]),e("li",{class:T(["page-item",{disabled:l.value.current_page===l.value.last_page}])},[e("a",{href:"#",class:"page-link",onClick:a[4]||(a[4]=M(t=>N(l.value.current_page+1),["prevent"]))}," » ")],2)])])])])]),e("div",Ue,[e("div",Ne,[e("div",Ve,[e("div",$e,[e("h5",De,[a[23]||(a[23]=e("i",{class:"fas fa-code-branch mr-1"},null,-1)),c(" "+d(_.value?"Edit Cabang Event":"Tambah Cabang Event"),1)]),a[24]||(a[24]=e("button",{type:"button",class:"close","data-dismiss":"modal"},[e("span",null,"×")],-1))]),e("div",Le,[e("form",{onSubmit:M(J,["prevent"])},[e("div",Ae,[e("div",Fe,[e("div",Pe,[a[26]||(a[26]=e("label",{class:"mb-1"},"Cabang Lomba",-1)),b(e("select",{"onUpdate:modelValue":a[5]||(a[5]=t=>n.value.branch_id=t),class:"form-control form-control-sm",required:""},[a[25]||(a[25]=e("option",{value:"",disabled:""},"-- pilih cabang --",-1)),(u(!0),i(S,null,L(U.value,t=>(u(),i("option",{key:t.id,value:t.id},[c(d(t.name)+" ",1),t.code?(u(),i("span",Ie," ("+d(t.code)+")",1)):G("",!0)],8,He))),128))],512),[[C,n.value.branch_id]]),a[27]||(a[27]=e("small",{class:"text-muted"},[c(" Data diambil dari master "),e("strong",null,"Branches"),c(". ")],-1))]),e("div",je,[a[28]||(a[28]=e("label",{class:"mb-1"},"Nama Cabang (Denormalisasi)",-1)),b(e("input",{"onUpdate:modelValue":a[6]||(a[6]=t=>n.value.branch_name=t),type:"text",class:"form-control form-control-sm",placeholder:"Jika kosong, akan diisi otomatis dari master branch"},null,512),[[w,n.value.branch_name]])])]),e("div",qe,[e("div",Je,[a[29]||(a[29]=e("label",{class:"mb-1"},"Nama Lengkap (Full Name)",-1)),b(e("input",{"onUpdate:modelValue":a[7]||(a[7]=t=>n.value.full_name=t),type:"text",class:"form-control form-control-sm",placeholder:"Contoh: Cabang Tilawah Al Qur'an Dewasa"},null,512),[[w,n.value.full_name]]),a[30]||(a[30]=e("small",{class:"text-muted"}," Jika dikosongkan, dapat disamakan dengan Nama Cabang. ",-1))]),e("div",Ke,[a[32]||(a[32]=e("label",{class:"mb-1"},"Status",-1)),b(e("select",{"onUpdate:modelValue":a[8]||(a[8]=t=>n.value.status=t),class:"form-control form-control-sm"},a[31]||(a[31]=[e("option",{value:"active"},"Aktif",-1),e("option",{value:"inactive"},"Nonaktif",-1)]),512),[[C,n.value.status]])]),e("div",Ye,[a[33]||(a[33]=e("label",{class:"mb-1"},"Urutan Tampil",-1)),b(e("input",{"onUpdate:modelValue":a[9]||(a[9]=t=>n.value.order_number=t),type:"number",min:"1",class:"form-control form-control-sm"},null,512),[[w,n.value.order_number,void 0,{number:!0}]])])])]),e("div",ze,[e("button",{type:"submit",class:"btn btn-sm btn-primary",disabled:k.value||!r.value},[k.value?(u(),i("i",Qe)):(u(),i("i",Re)),a[34]||(a[34]=c(" Simpan "))],8,Oe)])],32)])])])])])],64))}};export{ea as default};
