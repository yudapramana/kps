import{z as ne,y as S,A as p,O as D,V as ae,B as s,C as o,D as e,I as M,K as v,S as k,aB as Y,as as U,U as f,ay as w,J as l,H as I,F as N,a as C,aC as le}from"./AuthUserStore-67h2FHdL.js";import{S as u}from"./sweetalert2.esm.all-9Qm2jZ7z.js";import{_ as se}from"./app-CZBZEz52.js";const oe={class:"content-header"},ie={class:"container-fluid"},de={class:"d-flex justify-content-between align-items-center"},re={class:"d-flex flex-column flex-sm-row gap-2"},me=["disabled"],ue={key:0,class:"fas fa-spinner fa-spin mr-1"},ce={key:1,class:"fas fa-magic mr-1"},pe=["disabled"],ve={key:0,class:"text-danger text-sm mt-2 mb-0"},_e={class:"content"},ge={class:"container-fluid"},be={class:"card"},he={class:"card-header"},fe={class:"d-flex flex-wrap justify-content-between align-items-center w-100"},xe={class:"d-flex align-items-center"},ye={class:"card-body table-responsive p-0"},ke={class:"table table-bordered table-hover table-striped text-sm mb-0"},we={key:0},Ce={key:1},Ge={class:"text-center align-middle"},Be={class:"align-middle"},Fe={class:"text-center align-middle"},Me={class:"text-center align-middle"},Ee=["onClick"],Te={class:"text-center align-middle"},Ke={class:"text-center align-middle"},Pe={class:"align-middle"},Se={class:"d-flex flex-wrap"},Ue={key:0,class:"text-muted text-xs"},$e={class:"card-footer clearfix py-2"},Le={class:"d-flex justify-content-between align-items-center"},Ve={class:"text-muted text-sm"},De={class:"pagination pagination-sm m-0"},Ie={class:"page-item disabled"},Ne={class:"page-link"},je={id:"print-area",class:"d-none"},Ae={class:"text-center text-sm mb-3"},He={class:"mb-1"},ze={class:"text-muted"},Ye={class:"table table-bordered table-sm text-sm mb-0"},qe={key:0},Je={class:"text-center"},Oe={class:"text-center"},We={class:"text-center"},Qe={class:"text-center"},Re={class:"modal fade",id:"eventFieldComponentModal",tabindex:"-1",role:"dialog","aria-labelledby":"eventFieldComponentModalLabel"},Xe={class:"modal-dialog modal-lg",role:"document"},Ze={class:"modal-content"},et={class:"modal-header py-2"},tt={key:0,class:"text-muted"},nt={class:"modal-body pt-2"},at={key:0,class:"text-center text-muted"},lt={key:1},st={class:"d-flex justify-content-between align-items-center mb-2"},ot={class:"text-sm"},it={class:"text-muted"},dt={class:"table-responsive mb-0"},rt={class:"table table-sm table-bordered mb-0"},mt={key:0},ut={class:"text-center align-middle"},ct={class:"align-middle"},pt={class:"text-center align-middle"},vt={class:"text-center align-middle"},_t={class:"text-center align-middle"},gt={class:"text-center align-middle"},bt={class:"btn-group btn-group-sm"},ht=["onClick"],ft=["onClick"],xt={class:"modal fade",id:"eventFieldComponentFormModal",tabindex:"-1",role:"dialog","aria-labelledby":"eventFieldComponentFormModalLabel"},yt={class:"modal-dialog modal-lg",role:"document"},kt={class:"modal-content"},wt={class:"modal-header py-2"},Ct={class:"modal-title mb-0",id:"eventFieldComponentFormModalLabel"},Gt={class:"modal-body pt-2"},Bt={key:0,class:"text-center text-muted"},Ft={key:1},Mt={class:"row"},Et={class:"col-md-6"},Tt={class:"form-group mb-2"},Kt=["value"],Pt={class:"form-group mb-2"},St=["value"],Ut={class:"form-group mb-2"},$t={class:"col-md-6"},Lt={class:"form-group mb-2"},Vt={class:"form-group mb-2"},Dt={class:"text-right mt-3"},It=["disabled"],Nt={key:0,class:"fas fa-spinner fa-spin mr-1"},jt={key:1,class:"fas fa-save mr-1"},At={__name:"EventFieldComponents",setup(Ht){const j=ne(),G=S(()=>j.eventData||null),c=S(()=>{var n;return((n=G.value)==null?void 0:n.id)||null}),x=p([]),A=p([]),E=p(""),T=p(10),L=p(!1),B=p(!1),K=p(!1),P=p(!1),m=p({current_page:1,per_page:10,total:0,from:0,to:0,last_page:1}),d=p(null),r=p({id:null,event_group_id:"",field_id:"",weight:null,max_score:null,order_number:null}),F=n=>n.field_components||n.fieldComponents||[],q=n=>F(n).length,V=S(()=>d.value?d.value.field_components||d.value.fieldComponents||[]:[]),H=async()=>{if(c.value)try{const n=await C.get("/api/v1/list-fields",{params:{simple:1}});A.value=n.data.data||[]}catch(n){console.error("Gagal memuat List Fields:",n),u.fire("Gagal","Gagal memuat List Fields.","error")}},b=async(n=1)=>{if(c.value){L.value=!0;try{const i=(await C.get("/api/v1/event-groups",{params:{event_id:c.value,page:n,per_page:T.value,search:E.value,with_fields:1}})).data.data;if(x.value=i.data||[],m.value={current_page:i.current_page,per_page:i.per_page,total:i.total,from:i.from,to:i.to,last_page:i.last_page},d.value){const _=x.value.find(y=>y.id===d.value.id);_&&(d.value=_)}}catch(t){console.error("Gagal memuat event groups:",t),t.response&&t.response.status===401?j.logout():u.fire("Gagal","Gagal memuat data Golongan Event.","error")}finally{L.value=!1}}},z=n=>{n<1||n>m.value.last_page||b(n)},J=n=>{if(!c.value){u.fire("Event belum dipilih","Silakan pilih event melalui Portal Event sebelum mengelola komponen penilaian.","warning");return}d.value=n,$("#eventFieldComponentModal").modal("show")},O=()=>{if(!d.value)return;B.value=!1;const n=d.value.field_components||d.value.fieldComponents||[];r.value={id:null,event_group_id:d.value.id,field_id:"",weight:null,max_score:null,order_number:(n.length||0)+1},$("#eventFieldComponentFormModal").modal("show")},W=n=>{d.value&&(B.value=!0,r.value={id:n.id,event_group_id:d.value.id,field_id:n.field_id,weight:n.weight,max_score:n.max_score,order_number:n.order_number},$("#eventFieldComponentFormModal").modal("show"))},Q=async()=>{if(!c.value||!d.value){u.fire("Event belum dipilih","Silakan pilih event melalui Portal Event sebelum mengelola komponen penilaian.","warning");return}K.value=!0;const n={event_group_id:r.value.event_group_id,field_id:r.value.field_id,weight:r.value.weight,max_score:r.value.max_score,order_number:r.value.order_number};try{B.value&&r.value.id?(await C.put(`/api/v1/event-field-components/${r.value.id}`,n),u.fire("Berhasil","Komponen penilaian event berhasil diperbarui.","success")):(await C.post("/api/v1/event-field-components",n),u.fire("Berhasil","Komponen penilaian event berhasil ditambahkan.","success")),$("#eventFieldComponentFormModal").modal("hide"),await b(m.value.current_page)}catch(t){console.error("Gagal menyimpan event_field_component:",t);let i="Gagal menyimpan data komponen penilaian event.";t.response&&t.response.status===422&&t.response.data.message&&(i=t.response.data.message),u.fire("Gagal",i,"error")}finally{K.value=!1}},R=async n=>{if((await u.fire({title:"Hapus Komponen?",text:`Yakin ingin menghapus komponen "${n.field_name}" dari golongan event ini?`,icon:"warning",showCancelButton:!0,confirmButtonText:"Ya, Hapus",cancelButtonText:"Batal",confirmButtonColor:"#d33",cancelButtonColor:"#3085d6"})).isConfirmed)try{await C.delete(`/api/v1/event-field-components/${n.id}`),u.fire("Terhapus","Komponen penilaian event berhasil dihapus.","success"),await b(m.value.current_page)}catch(i){console.error("Gagal menghapus event_field_component:",i),u.fire("Gagal","Gagal menghapus komponen penilaian event.","error")}},X=async()=>{if(!c.value){u.fire("Event belum dipilih","Silakan pilih event melalui Portal Event sebelum generate dari template.","warning");return}if((await u.fire({title:"Generate dari Template Master?",text:"Komponen penilaian event akan dibuat berdasarkan Master Field Components. Data yang sudah ada tidak akan diduplikasi.",icon:"question",showCancelButton:!0,confirmButtonText:"Ya, Generate",cancelButtonText:"Batal",confirmButtonColor:"#28a745",cancelButtonColor:"#6c757d"})).isConfirmed){P.value=!0;try{const i=(await C.post("/api/v1/event-field-components/generate-from-template",{event_id:c.value})).data.message||"Komponen penilaian event berhasil digenerate dari template.";u.fire("Berhasil",i,"success"),d.value=null,await b(1)}catch(t){console.error("Gagal generate dari template:",t);let i="Gagal generate komponen dari template.";t.response&&t.response.data&&t.response.data.message&&(i=t.response.data.message),u.fire("Gagal",i,"error")}finally{P.value=!1}}},Z=S(()=>[...x.value].sort((n,t)=>{const i=n.order_number??9999,_=t.order_number??9999;return i-_})),ee=n=>[...F(n)].sort((t,i)=>{const _=t.order_number??9999,y=i.order_number??9999;return _-y}),te=()=>{var i;const n=(i=document.getElementById("print-area"))==null?void 0:i.innerHTML;if(!n)return;const t=window.open("","","height=800,width=1000");t.document.write(`
    <html>
      <head>
        <title>Print Komponen Penilaian</title>
        <style>
          body {
            font-family: Arial, sans-serif;
            padding: 20px;
          }
          h3, h5 {
            margin-bottom: 6px;
          }
          table {
            width: 100%;
            border-collapse: collapse;
            margin-bottom: 12px;
          }
          th, td {
            border: 1px solid #000;
            padding: 4px 6px;
          }
          th {
            background: #f0f0f0;
          }
          .text-center {
            text-align: center;
          }
          .text-sm {
            font-size: 12px;
          }
          .text-muted {
            color: #666;
          }
          @page {
            size: A4;
            margin: 15mm;
          }
        </style>
      </head>
      <body>
        ${n}
      </body>
    </html>
  `),t.document.close(),t.focus(),t.print(),t.close()};return D(()=>E.value,le(()=>{b(1)},400)),D(()=>T.value,()=>{b(1)}),D(()=>c.value,n=>{n&&(H(),b(1))}),ae(()=>{c.value?(H(),b()):u.fire("Event belum dipilih","Silakan pilih event melalui Portal Event terlebih dahulu.","info")}),(n,t)=>{var i,_,y;return o(),s(f,null,[e("section",oe,[e("div",ie,[e("div",de,[t[10]||(t[10]=e("div",null,[e("h1",{class:"mb-1"},"Komponen Penilaian per Golongan Event"),e("p",{class:"mb-0 text-muted text-sm"}," Mengatur komponen penilaian (Lagu, Suara, Tajwid, dll.) beserta bobot & nilai maksimum untuk setiap Golongan Event (Cabang + Golongan yang sudah diaktifkan di event). ")],-1)),e("div",re,[e("button",{class:"btn btn-outline-secondary btn-sm mr-sm-2 mb-2 mb-sm-0",onClick:X,disabled:P.value||!c.value},[P.value?(o(),s("i",ue)):(o(),s("i",ce)),t[8]||(t[8]=v(" Generate dari Template "))],8,me),e("button",{class:"btn btn-outline-primary btn-sm",onClick:te,disabled:!x.value.length},t[9]||(t[9]=[e("i",{class:"fas fa-print mr-1"},null,-1),v(" Print ")]),8,pe)])]),c.value?M("",!0):(o(),s("p",ve,t[11]||(t[11]=[e("i",{class:"fas fa-exclamation-triangle mr-1"},null,-1),v(" Event belum dipilih. Silakan pilih event melalui Portal Event terlebih dahulu. ")])))])]),e("section",_e,[e("div",ge,[e("div",be,[e("div",he,[e("div",fe,[e("div",xe,[t[13]||(t[13]=e("label",{class:"mb-0 mr-1 text-sm text-muted"},"Tampilkan",-1)),k(e("select",{"onUpdate:modelValue":t[0]||(t[0]=a=>T.value=a),class:"form-control form-control-sm w-auto mr-2"},t[12]||(t[12]=[e("option",{value:10},"10",-1),e("option",{value:25},"25",-1),e("option",{value:50},"50",-1),e("option",{value:100},"100",-1)]),512),[[Y,T.value,void 0,{number:!0}]]),t[14]||(t[14]=e("label",{class:"mb-0 text-sm text-muted"},"Golongan / halaman",-1))]),k(e("input",{"onUpdate:modelValue":t[1]||(t[1]=a=>E.value=a),type:"text",class:"form-control form-control-sm w-auto",style:{"min-width":"220px"},placeholder:"Cari nama golongan / cabang..."},null,512),[[U,E.value]])])]),e("div",ye,[e("table",ke,[t[17]||(t[17]=e("thead",{class:"thead-light"},[e("tr",null,[e("th",{class:"text-center align-middle",style:{width:"50px"}},"#"),e("th",{class:"align-middle"},"Golongan Event"),e("th",{class:"text-center align-middle",style:{width:"120px"}},"Maks Usia"),e("th",{class:"align-middle"},"Jumlah Bidang"),e("th",{class:"text-center align-middle",style:{width:"80px"}},"Tipe"),e("th",{class:"text-center align-middle",style:{width:"80px"}},"Urutan"),e("th",{class:"align-middle",style:{width:"320px"}},"Komponen")])],-1)),e("tbody",null,[L.value?(o(),s("tr",we,t[15]||(t[15]=[e("td",{colspan:"6",class:"text-center"},"Memuat data golongan event...",-1)]))):x.value.length===0?(o(),s("tr",Ce,t[16]||(t[16]=[e("td",{colspan:"6",class:"text-center"},[v(" Belum ada Event Group untuk event ini. "),e("br"),e("small",{class:"text-muted"}," Silakan generate Event Groups terlebih dahulu. ")],-1)]))):(o(!0),s(f,{key:2},w(x.value,(a,g)=>(o(),s("tr",{key:a.id},[e("td",Ge,l(g+1+(m.value.current_page-1)*m.value.per_page),1),e("td",Be,[e("strong",null,l(a.full_name),1)]),e("td",Fe,l(a.max_age??"-"),1),e("td",Me,[e("button",{class:"btn btn-xs btn-outline-primary",onClick:h=>J(a)},l(q(a))+" Bidang ",9,Ee)]),e("td",Te,[e("span",{class:I(["badge",a.is_team?"badge-success":"badge-secondary"])},l(a.is_team?"Tim":"Individu"),3)]),e("td",Ke,l(a.order_number??"-"),1),e("td",Pe,[e("div",Se,[(o(!0),s(f,null,w(F(a),h=>(o(),s("span",{key:h.id,class:"badge badge-info mr-1 mb-1"},l(h.field_name),1))),128)),F(a).length===0?(o(),s("span",Ue," Belum ada komponen ")):M("",!0)])])]))),128))])])]),e("div",$e,[e("div",Le,[e("div",Ve," Menampilkan "+l(m.value.from||0)+" - "+l(m.value.to||0)+" dari "+l(m.value.total||0)+" golongan event ",1),e("ul",De,[e("li",{class:I(["page-item",{disabled:m.value.current_page===1}])},[e("a",{href:"#",class:"page-link",onClick:t[2]||(t[2]=N(a=>z(m.value.current_page-1),["prevent"]))}," « ")],2),e("li",Ie,[e("span",Ne," Halaman "+l(m.value.current_page)+" / "+l(m.value.last_page||1),1)]),e("li",{class:I(["page-item",{disabled:m.value.current_page===m.value.last_page}])},[e("a",{href:"#",class:"page-link",onClick:t[3]||(t[3]=N(a=>z(m.value.current_page+1),["prevent"]))}," » ")],2)])])])])]),e("div",je,[t[21]||(t[21]=e("h3",{class:"text-center mb-1"}," Komponen Penilaian Golongan Event ",-1)),e("p",Ae,[v(l((i=G.value)==null?void 0:i.event_name)+" "+l((_=G.value)!=null&&_.event_year?"("+G.value.event_year+")":"")+" ",1),t[18]||(t[18]=e("br",null,null,-1)),v(" "+l(((y=G.value)==null?void 0:y.event_location)||""),1)]),(o(!0),s(f,null,w(Z.value,a=>(o(),s("div",{key:"print-"+a.id,class:"mb-4"},[e("h5",He,[v(l(a.full_name)+" ",1),e("small",ze," • "+l(a.is_team?"Tim":"Individu"),1)]),e("table",Ye,[t[20]||(t[20]=e("thead",null,[e("tr",null,[e("th",{style:{width:"40px"}},"#"),e("th",null,"Komponen"),e("th",{style:{width:"90px"},class:"text-center"},"Bobot (%)"),e("th",{style:{width:"100px"},class:"text-center"},"Max Nilai"),e("th",{style:{width:"80px"},class:"text-center"},"Urutan")])],-1)),e("tbody",null,[F(a).length===0?(o(),s("tr",qe,t[19]||(t[19]=[e("td",{colspan:"5",class:"text-center text-muted"}," Tidak ada komponen ",-1)]))):M("",!0),(o(!0),s(f,null,w(ee(a),(g,h)=>(o(),s("tr",{key:"pfc-"+g.id},[e("td",Je,l(h+1),1),e("td",null,l(g.field_name),1),e("td",Oe,l(g.weight??"-"),1),e("td",We,l(g.max_score??"-"),1),e("td",Qe,l(g.order_number??"-"),1)]))),128))])])]))),128))]),e("div",Re,[e("div",Xe,[e("div",Ze,[e("div",et,[e("div",null,[t[23]||(t[23]=e("h5",{class:"modal-title mb-0",id:"eventFieldComponentModalLabel"},[e("i",{class:"fas fa-sliders-h mr-1"}),v(" Kelola Komponen Penilaian ")],-1)),d.value?(o(),s("small",tt,[t[22]||(t[22]=v(" Golongan Event: ")),e("strong",null,l(d.value.full_name),1)])):M("",!0)]),t[24]||(t[24]=e("button",{type:"button",class:"close","data-dismiss":"modal"},[e("span",null,"×")],-1))]),e("div",nt,[d.value?(o(),s("div",lt,[e("div",st,[e("div",ot,[t[25]||(t[25]=e("strong",null,"Daftar Komponen:",-1)),e("span",it,l(V.value.length)+" komponen ",1)]),e("button",{class:"btn btn-xs btn-primary",onClick:O}," + Tambah Komponen ")]),e("div",dt,[e("table",rt,[t[29]||(t[29]=e("thead",{class:"thead-light"},[e("tr",null,[e("th",{style:{width:"40px"},class:"text-center align-middle"},"#"),e("th",{class:"align-middle"},"Komponen"),e("th",{style:{width:"80px"},class:"text-center align-middle"},"Bobot %"),e("th",{style:{width:"110px"},class:"text-center align-middle"},"Max Nilai"),e("th",{style:{width:"80px"},class:"text-center align-middle"},"Urutan"),e("th",{style:{width:"110px"},class:"text-center align-middle"},"Aksi")])],-1)),e("tbody",null,[V.value.length===0?(o(),s("tr",mt,t[26]||(t[26]=[e("td",{colspan:"6",class:"text-center text-muted"}," Belum ada komponen penilaian untuk golongan event ini. ",-1)]))):M("",!0),(o(!0),s(f,null,w(V.value,(a,g)=>(o(),s("tr",{key:a.id},[e("td",ut,l(g+1),1),e("td",ct,l(a.field_name),1),e("td",pt,l(a.weight??"-"),1),e("td",vt,l(a.max_score??"-"),1),e("td",_t,l(a.order_number??"-"),1),e("td",gt,[e("div",bt,[e("button",{class:"btn btn-warning",onClick:h=>W(a)},t[27]||(t[27]=[e("i",{class:"fas fa-edit"},null,-1)]),8,ht),e("button",{class:"btn btn-danger",onClick:h=>R(a)},t[28]||(t[28]=[e("i",{class:"fas fa-trash"},null,-1)]),8,ft)])])]))),128))])])])])):(o(),s("div",at," Tidak ada golongan event yang dipilih. "))])])])]),e("div",xt,[e("div",yt,[e("div",kt,[e("div",wt,[e("h5",Ct,[t[30]||(t[30]=e("i",{class:"fas fa-sliders-h mr-1"},null,-1)),v(" "+l(B.value?"Edit Komponen Penilaian":"Tambah Komponen Penilaian"),1)]),t[31]||(t[31]=e("button",{type:"button",class:"close","data-dismiss":"modal"},[e("span",null,"×")],-1))]),e("div",Gt,[d.value?(o(),s("div",Ft,[e("form",{onSubmit:N(Q,["prevent"])},[e("div",Mt,[e("div",Et,[e("div",Tt,[t[32]||(t[32]=e("label",{class:"mb-1"},"Golongan Event",-1)),e("input",{type:"text",class:"form-control form-control-sm",value:d.value.full_name,disabled:""},null,8,Kt)]),e("div",Pt,[t[34]||(t[34]=e("label",{class:"mb-1"},"Komponen Penilaian",-1)),k(e("select",{"onUpdate:modelValue":t[4]||(t[4]=a=>r.value.field_id=a),class:"form-control form-control-sm",required:""},[t[33]||(t[33]=e("option",{value:"",disabled:""},"-- pilih komponen --",-1)),(o(!0),s(f,null,w(A.value,a=>(o(),s("option",{key:a.id,value:a.id},l(a.name),9,St))),128))],512),[[Y,r.value.field_id]]),t[35]||(t[35]=e("small",{class:"text-muted"}," Data diambil dari master List Fields. ",-1))]),e("div",Ut,[t[36]||(t[36]=e("label",{class:"mb-1"},"Urutan Tampil",-1)),k(e("input",{"onUpdate:modelValue":t[5]||(t[5]=a=>r.value.order_number=a),type:"number",min:"1",class:"form-control form-control-sm"},null,512),[[U,r.value.order_number,void 0,{number:!0}]])])]),e("div",$t,[e("div",Lt,[t[37]||(t[37]=e("label",{class:"mb-1"},"Bobot (%)",-1)),k(e("input",{"onUpdate:modelValue":t[6]||(t[6]=a=>r.value.weight=a),type:"number",min:"0",max:"100",class:"form-control form-control-sm"},null,512),[[U,r.value.weight,void 0,{number:!0}]])]),e("div",Vt,[t[38]||(t[38]=e("label",{class:"mb-1"},"Max Nilai",-1)),k(e("input",{"onUpdate:modelValue":t[7]||(t[7]=a=>r.value.max_score=a),type:"number",min:"0",class:"form-control form-control-sm"},null,512),[[U,r.value.max_score,void 0,{number:!0}]])])])]),e("div",Dt,[e("button",{type:"submit",class:"btn btn-sm btn-primary",disabled:K.value||!c.value},[K.value?(o(),s("i",Nt)):(o(),s("i",jt)),v(" "+l(B.value?"Update Komponen":"Simpan Komponen"),1)],8,It)])],32)])):(o(),s("div",Bt," Tidak ada golongan event yang dipilih. "))])])])])])],64)}}},Jt=se(At,[["__scopeId","data-v-5724363d"]]);export{Jt as default};
