import{z as W,A as v,y as U,O as T,V as X,B as l,C as n,D as e,I as E,K as r,S as c,aB as D,U as G,ay as N,as as g,J as d,H as A,F as q,a as w,aC as Z}from"./AuthUserStore-67h2FHdL.js";import{S as ee}from"./sweetalert2.esm.all-9Qm2jZ7z.js";const ae={class:"content-header"},te={class:"container-fluid"},se={class:"d-flex justify-content-between align-items-center"},le={class:"btn-group"},ne=["disabled"],oe={key:0,class:"fas fa-spinner fa-spin mr-1"},re={key:1,class:"fas fa-users-cog mr-1"},ie=["disabled"],ue={class:"content"},de={class:"container-fluid"},me={class:"card"},ve={class:"card-header"},pe={class:"d-flex flex-wrap justify-content-between align-items-center gap-2"},ce={class:"d-flex align-items-center flex-wrap gap-2"},fe={class:"d-flex align-items-center mr-3"},be={class:"d-flex align-items-center"},_e=["value"],ge={style:{"min-width":"260px"}},ke={class:"card-body table-responsive p-0"},ye={class:"table table-bordered table-hover text-sm"},xe={key:0},we={key:1},he={key:0,class:"badge badge-info"},Ue={key:1,class:"text-muted"},Ee={key:0},Ge={key:1,class:"text-muted"},Me={class:"text-center"},Ve={class:"btn-group btn-group-sm"},Ce=["onClick"],Se=["onClick"],$e={class:"card-footer clearfix"},Te={class:"d-flex justify-content-between align-items-center"},De={class:"text-muted"},Ne={class:"pagination pagination-sm m-0"},qe={class:"page-item disabled"},Le={class:"page-link"},Be={class:"modal fade",id:"eventUserModal",tabindex:"-1",role:"dialog"},Pe={class:"modal-dialog modal-lg",role:"document"},Re={class:"modal-content"},Fe={class:"modal-header py-2"},Ke={class:"modal-title",id:"eventUserModalLabel"},Ae={class:"modal-body pt-2"},je={class:"row"},Oe={class:"col-md-6"},He={class:"form-group mb-2"},ze={class:"form-group mb-2"},Ie={class:"form-group mb-2"},Je={class:"form-group mb-2"},Ye={class:"mb-1"},Qe={key:0,class:"text-muted"},We=["required"],Xe={class:"col-md-6"},Ze={class:"form-group mb-2"},ea=["value"],aa={class:"form-group mb-2"},ta=["value"],sa={class:"form-group mb-2"},la={class:"text-end mt-3"},na=["disabled"],oa={key:0,class:"fas fa-spinner fa-spin mr-1"},ra={key:1,class:"fas fa-save mr-1"},ia={class:"modal fade",id:"generateUserModal",tabindex:"-1",role:"dialog"},ua={class:"modal-dialog",role:"document"},da={class:"modal-content"},ma={class:"modal-body"},va={key:0,class:"text-sm mb-2"},pa={class:"text-xs text-muted mb-3"},ca={key:0},fa={key:1},ba={class:"form-group mb-2"},_a=["value"],ga={class:"form-group mb-2"},ka={class:"form-group mb-2"},ya={class:"text-right mt-3"},xa=["disabled"],wa=["disabled"],ha={key:0,class:"fas fa-spinner fa-spin mr-1"},Ua={key:1,class:"fas fa-play mr-1"},Ca={__name:"EventUserList",setup(Ea){const L=W(),B=v([]),h=v(10),M=v(""),u=v({current_page:1,per_page:h.value,total:0,from:0,to:0,last_page:1}),V=v(""),P=v(!1),C=v(!1),x=v(!1),o=v({}),S=v([]),i=v(null),p=v(null),k=v(!1),m=v({role_id:null,default_password:"",email_domain:""}),R=U(()=>i.value?i.value.event_name||i.value.nama_event||i.value.name||`Event #${i.value.id}`:"");U(()=>i.value&&(i.value.app_name||i.value.nama_aplikasi)||"");const y=U(()=>i.value&&(i.value.event_level||i.value.tingkat_event)||null),j=U(()=>{const s=y.value;switch(s){case"national":case"nasional":return"Nasional";case"province":case"provinsi":return"Provinsi";case"regency":case"kabupaten_kota":return"Kabupaten/Kota";case"district":case"kecamatan":return"Kecamatan";default:return s||"-"}}),F=U(()=>{const s=y.value;return s?s==="province"||s==="provinsi"||s==="regency"||s==="kabupaten_kota":!1}),K=()=>{const s=L.eventData;s&&typeof s=="object"?(i.value=s,p.value=s.id??null):(i.value=null,p.value=null)},O=()=>{if(!p.value||!i.value){alert("Event belum terdeteksi. Tidak dapat generate user.");return}if(!F.value){alert("Generate user hanya bisa untuk event tingkat provinsi/province atau kabupaten_kota/regency.");return}m.value={role_id:null,default_password:"",email_domain:""},$("#generateUserModal").modal("show")},H=async()=>{try{const s=await w.get("/api/v1/roles");S.value=s.data}catch(s){console.error("Gagal memuat roles:",s)}},f=async(s=1)=>{var a;P.value=!0;try{const t=await w.get("/api/v1/users",{params:{page:s,per_page:h.value,search:V.value,event_id:p.value,role_id:M.value||void 0}});B.value=t.data.data||[],u.value={current_page:t.data.current_page,per_page:t.data.per_page,total:t.data.total,from:t.data.from,to:t.data.to,last_page:t.data.last_page}}catch(t){((a=t.response)==null?void 0:a.status)===401?L.logout():console.error("Gagal memuat data user:",t)}finally{P.value=!1}},z=async()=>{var t,b;if(!p.value||!i.value)return;if(!m.value.role_id){alert("Silakan pilih role terlebih dahulu untuk user hasil generate.");return}const s=y.value;let a="Generate user otomatis untuk event ini?";if(s==="province"||s==="provinsi"?a=`Generate user untuk SEMUA kabupaten/kota pada provinsi ini?
Nama & username user akan dibentuk dari: KODE_EVENT + nama kab/kota.
Password & domain email mengikuti pengaturan di form.`:(s==="regency"||s==="kabupaten_kota")&&(a=`Generate user untuk SEMUA kecamatan pada kabupaten/kota ini?
Nama & username user akan dibentuk dari: KODE_EVENT + nama kecamatan.
Password & domain email mengikuti pengaturan di form.`),!!confirm(a)){k.value=!0;try{const _={role_id:m.value.role_id};m.value.default_password&&(_.default_password=m.value.default_password),m.value.email_domain&&(_.email_domain=m.value.email_domain);const Ga=await w.post(`/api/v1/events/${p.value}/generate-users`,_);$("#generateUserModal").modal("hide"),ee.fire({icon:"success",title:"Generate User Berhasil",showConfirmButton:!1,timer:2e3}),await f(u.value.current_page)}catch(_){console.error("Gagal generate user:",_),alert(((b=(t=_.response)==null?void 0:t.data)==null?void 0:b.message)||"Gagal generate user otomatis.")}finally{k.value=!1}}},I=()=>{!p.value&&!confirm("Event belum terdeteksi. Tambah user sebagai global (tanpa event)?")||(x.value=!1,o.value={id:null,name:"",email:"",username:"",password:"",role_id:null,avatar:"",event_id:p.value},$("#eventUserModal").modal("show"))},J=s=>{x.value=!0,o.value={id:s.id,name:s.name,email:s.email,username:s.username,password:"",role_id:s.role_id||(s.role?s.role.id:null),avatar:s.avatar||"",event_id:s.event_id},$("#eventUserModal").modal("show")},Y=async()=>{var a,t;C.value=!0;const s={name:o.value.name,email:o.value.email,username:o.value.username,role_id:o.value.role_id,avatar:o.value.avatar,event_id:p.value??o.value.event_id??null};o.value.password&&(s.password=o.value.password);try{x.value&&o.value.id?await w.put(`/api/v1/users/${o.value.id}`,s):await w.post("/api/v1/users",s),$("#eventUserModal").modal("hide"),await f(u.value.current_page)}catch(b){console.error("Gagal menyimpan user:",b),alert(((t=(a=b.response)==null?void 0:a.data)==null?void 0:t.message)||"Gagal menyimpan data user.")}finally{C.value=!1}},Q=async s=>{var a,t;if(confirm(`Yakin ingin menghapus user "${s.name}"?`))try{await w.delete(`/api/v1/users/${s.id}`),await f(u.value.current_page)}catch(b){console.error("Gagal menghapus user:",b),alert(((t=(a=b.response)==null?void 0:a.data)==null?void 0:t.message)||"Gagal menghapus user.")}};return T(h,()=>{f(1)}),T(M,()=>{f(1)}),T(V,Z(()=>{f(1)},400)),T(()=>{var s;return(s=L.eventData)==null?void 0:s.id},(s,a)=>{s&&s!==a&&(K(),f(1))}),X(()=>{K(),H(),p.value!==null&&f()}),(s,a)=>(n(),l(G,null,[e("section",ae,[e("div",te,[e("div",se,[a[16]||(a[16]=e("div",null,[e("h1",{class:"mb-1"},"Daftar User Event")],-1)),e("div",le,[p.value&&F.value?(n(),l("button",{key:0,class:"btn btn-success btn-sm",disabled:k.value,onClick:O},[k.value?(n(),l("i",oe)):(n(),l("i",re)),a[14]||(a[14]=r(" Generate User "))],8,ne)):E("",!0),e("button",{class:"btn btn-primary btn-sm",onClick:I,disabled:!p.value},a[15]||(a[15]=[e("i",{class:"fas fa-user-plus mr-1"},null,-1),r(" Tambah User ")]),8,ie)])])])]),e("section",ue,[e("div",de,[e("div",me,[e("div",ve,[e("div",pe,[e("div",ce,[e("div",fe,[a[18]||(a[18]=e("label",{class:"mb-0 text-sm text-muted mr-2"},"Tampilkan",-1)),c(e("select",{"onUpdate:modelValue":a[0]||(a[0]=t=>h.value=t),class:"form-control form-control-sm w-auto"},a[17]||(a[17]=[e("option",{value:10},"10",-1),e("option",{value:25},"25",-1),e("option",{value:50},"50",-1),e("option",{value:100},"100",-1)]),512),[[D,h.value,void 0,{number:!0}]]),a[19]||(a[19]=e("span",{class:"ml-2 text-sm text-muted"},"entri",-1))]),e("div",be,[a[21]||(a[21]=e("label",{class:"mb-0 text-sm text-muted mr-2"},"Role",-1)),c(e("select",{"onUpdate:modelValue":a[1]||(a[1]=t=>M.value=t),class:"form-control form-control-sm w-auto"},[a[20]||(a[20]=e("option",{value:""},"Semua",-1)),(n(!0),l(G,null,N(S.value,t=>(n(),l("option",{key:t.id,value:t.id},d(t.name),9,_e))),128))],512),[[D,M.value]])])]),e("div",ge,[c(e("input",{"onUpdate:modelValue":a[2]||(a[2]=t=>V.value=t),type:"text",class:"form-control form-control-sm",placeholder:"Cari nama, email, atau username..."},null,512),[[g,V.value]])])])]),e("div",ke,[e("table",ye,[a[26]||(a[26]=e("thead",{class:"thead-light"},[e("tr",null,[e("th",{style:{width:"40px"}},"#"),e("th",null,"Nama"),e("th",null,"Username"),e("th",null,"Role"),e("th",null,"Event"),e("th",{style:{width:"80px"}},"Aksi")])],-1)),e("tbody",null,[P.value?(n(),l("tr",xe,a[22]||(a[22]=[e("td",{colspan:"7",class:"text-center"},"Memuat data...",-1)]))):B.value.length===0?(n(),l("tr",we,a[23]||(a[23]=[e("td",{colspan:"7",class:"text-center"},"Tidak ada user ditemukan.",-1)]))):E("",!0),(n(!0),l(G,null,N(B.value,(t,b)=>(n(),l("tr",{key:t.id},[e("td",null,d(b+1+(u.value.current_page-1)*u.value.per_page),1),e("td",null,[e("strong",null,d(t.name),1)]),e("td",null,d(t.username),1),e("td",null,[t.role?(n(),l("span",he,d(t.role.name),1)):(n(),l("span",Ue,"-"))]),e("td",null,[t.event?(n(),l("span",Ee,d(t.event.event_name||t.event.nama_event||t.event.name||"Event #"+t.event.id),1)):(n(),l("span",Ge,"Global"))]),e("td",Me,[e("div",Ve,[e("button",{class:"btn btn-outline-warning",title:"Edit",onClick:_=>J(t)},a[24]||(a[24]=[e("i",{class:"fas fa-edit"},null,-1)]),8,Ce),e("button",{class:"btn btn-outline-danger",title:"Hapus",onClick:_=>Q(t)},a[25]||(a[25]=[e("i",{class:"fas fa-trash-alt"},null,-1)]),8,Se)])])]))),128))])])]),e("div",$e,[e("div",Te,[e("div",De," Menampilkan "+d(u.value.from||0)+" - "+d(u.value.to||0)+" dari "+d(u.value.total||0)+" user ",1),e("ul",Ne,[e("li",{class:A(["page-item",{disabled:u.value.current_page===1}])},[e("a",{class:"page-link",href:"#",onClick:a[3]||(a[3]=q(t=>f(u.value.current_page-1),["prevent"]))}," « ")],2),e("li",qe,[e("span",Le," Halaman "+d(u.value.current_page)+" / "+d(u.value.last_page||1),1)]),e("li",{class:A(["page-item",{disabled:u.value.current_page===u.value.last_page}])},[e("a",{class:"page-link",href:"#",onClick:a[4]||(a[4]=q(t=>f(u.value.current_page+1),["prevent"]))}," » ")],2)])])])])]),e("div",Be,[e("div",Pe,[e("div",Re,[e("div",Fe,[e("h5",Ke,[a[27]||(a[27]=e("i",{class:"fas fa-user-edit mr-2"},null,-1)),r(" "+d(x.value?"Edit User Event":"Tambah User Event"),1)]),a[28]||(a[28]=e("button",{type:"button",class:"close","data-dismiss":"modal"},[e("span",null,"×")],-1))]),e("div",Ae,[e("form",{onSubmit:q(Y,["prevent"])},[e("div",je,[e("div",Oe,[e("div",He,[a[29]||(a[29]=e("label",{class:"mb-1"},"Nama Lengkap",-1)),c(e("input",{"onUpdate:modelValue":a[5]||(a[5]=t=>o.value.name=t),type:"text",class:"form-control form-control-sm",required:""},null,512),[[g,o.value.name]])]),e("div",ze,[a[30]||(a[30]=e("label",{class:"mb-1"},"Email",-1)),c(e("input",{"onUpdate:modelValue":a[6]||(a[6]=t=>o.value.email=t),type:"email",class:"form-control form-control-sm",required:""},null,512),[[g,o.value.email]])]),e("div",Ie,[a[31]||(a[31]=e("label",{class:"mb-1"},"Username",-1)),c(e("input",{"onUpdate:modelValue":a[7]||(a[7]=t=>o.value.username=t),type:"text",class:"form-control form-control-sm",required:""},null,512),[[g,o.value.username]])]),e("div",Je,[e("label",Ye,[a[32]||(a[32]=r(" Password ")),x.value?(n(),l("small",Qe,"(kosongkan jika tidak diubah)")):E("",!0)]),c(e("input",{"onUpdate:modelValue":a[8]||(a[8]=t=>o.value.password=t),type:"password",class:"form-control form-control-sm",required:!x.value},null,8,We),[[g,o.value.password]])])]),e("div",Xe,[e("div",Ze,[a[34]||(a[34]=e("label",{class:"mb-1"},"Role",-1)),c(e("select",{"onUpdate:modelValue":a[9]||(a[9]=t=>o.value.role_id=t),class:"form-control form-control-sm",required:""},[a[33]||(a[33]=e("option",{value:null},"-- Pilih Role --",-1)),(n(!0),l(G,null,N(S.value,t=>(n(),l("option",{key:t.id,value:t.id},d(t.name),9,ea))),128))],512),[[D,o.value.role_id]])]),e("div",aa,[a[35]||(a[35]=e("label",{class:"mb-1"},"Event (otomatis dari context)",-1)),e("input",{type:"text",class:"form-control form-control-sm",value:i.value?R.value:"Global / Tidak terikat event",readonly:""},null,8,ta)]),e("div",sa,[a[36]||(a[36]=e("label",{class:"mb-1"},"Avatar (URL opsional)",-1)),c(e("input",{"onUpdate:modelValue":a[10]||(a[10]=t=>o.value.avatar=t),type:"text",class:"form-control form-control-sm",placeholder:"https://..."},null,512),[[g,o.value.avatar]])])])]),e("div",la,[e("button",{type:"submit",class:"btn btn-sm btn-primary",disabled:C.value},[C.value?(n(),l("i",oa)):(n(),l("i",ra)),a[37]||(a[37]=r(" Simpan "))],8,na)])],32)])])])]),e("div",ia,[e("div",ua,[e("div",da,[a[50]||(a[50]=e("div",{class:"modal-header py-2"},[e("h5",{class:"modal-title"},[e("i",{class:"fas fa-users-cog mr-2"}),r(" Generate User Otomatis ")]),e("button",{type:"button",class:"close","data-dismiss":"modal"},[e("span",null,"×")])],-1)),e("div",ma,[i.value?(n(),l("p",va,[a[38]||(a[38]=r(" Event: ")),e("strong",null,d(R.value),1),a[39]||(a[39]=e("br",null,null,-1)),a[40]||(a[40]=r(" Tingkat: ")),e("strong",null,d(j.value),1)])):E("",!0),e("p",pa,[a[43]||(a[43]=r(" Sistem akan membuat user untuk ")),y.value==="province"||y.value==="provinsi"?(n(),l("span",ca,a[41]||(a[41]=[r(" setiap "),e("strong",null,"kabupaten/kota",-1),r(" pada provinsi ini. ")]))):y.value==="regency"||y.value==="kabupaten_kota"?(n(),l("span",fa,a[42]||(a[42]=[r(" setiap "),e("strong",null,"kecamatan",-1),r(" pada kabupaten/kota ini. ")]))):E("",!0)]),e("form",{onSubmit:q(z,["prevent"])},[e("div",ba,[a[45]||(a[45]=e("label",{class:"mb-1"},"Role untuk User Hasil Generate",-1)),c(e("select",{"onUpdate:modelValue":a[11]||(a[11]=t=>m.value.role_id=t),class:"form-control form-control-sm",required:""},[a[44]||(a[44]=e("option",{value:null},"-- Pilih Role --",-1)),(n(!0),l(G,null,N(S.value,t=>(n(),l("option",{key:t.id,value:t.id},d(t.name),9,_a))),128))],512),[[D,m.value.role_id]])]),e("div",ga,[a[46]||(a[46]=e("label",{class:"mb-1"},[r(" Default Password "),e("small",{class:"text-muted"},[r(" (opsional, default: "),e("strong",null,"event_key"),r(") ")])],-1)),c(e("input",{"onUpdate:modelValue":a[12]||(a[12]=t=>m.value.default_password=t),type:"text",class:"form-control form-control-sm",placeholder:"Kosongkan untuk pakai event_key"},null,512),[[g,m.value.default_password]])]),e("div",ka,[a[47]||(a[47]=e("label",{class:"mb-1"},[r(" Email Domain "),e("small",{class:"text-muted"},[r(" (opsional, default: "),e("code",null,"mtq.local"),r(") ")])],-1)),c(e("input",{"onUpdate:modelValue":a[13]||(a[13]=t=>m.value.email_domain=t),type:"text",class:"form-control form-control-sm",placeholder:"misal: mtq.sumbar, mtq.kemenag.go.id"},null,512),[[g,m.value.email_domain]])]),a[49]||(a[49]=e("div",{class:"alert alert-warning text-xs py-2 mb-2"},[e("i",{class:"fas fa-exclamation-triangle mr-1"}),r(" User yang sudah ada dengan kombinasi "),e("strong",null,"event_id + username"),r(" tidak akan dibuat ulang (akan di-skip). ")],-1)),e("div",ya,[e("button",{type:"button",class:"btn btn-sm btn-secondary mr-2","data-dismiss":"modal",disabled:k.value}," Batal ",8,xa),e("button",{type:"submit",class:"btn btn-sm btn-success",disabled:k.value||!m.value.role_id},[k.value?(n(),l("i",ha)):(n(),l("i",Ua)),a[48]||(a[48]=r(" Generate "))],8,wa)])],32)])])])])])],64))}};export{Ca as default};
