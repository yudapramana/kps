import{z as ne,y as B,A as v,O as C,V as ie,B as m,C as p,D as t,I as T,K as r,S as k,as as D,J as w,aB as A,U as G,ay as R,a as b,ah as F,L as oe,aC as le}from"./AuthUserStore-67h2FHdL.js";import{S as d}from"./sweetalert2.esm.all-9Qm2jZ7z.js";import{_ as re,$ as g}from"./app-CZBZEz52.js";import"./style-BgrjMBBc.js";const de={class:"content-header"},ue={class:"container-fluid"},ce={class:"d-flex justify-content-between align-items-center"},me={class:"btn-group"},pe=["disabled"],fe=["disabled"],ve=["disabled"],ge={key:0,class:"text-danger text-sm mt-2 mb-0"},_e={class:"content"},be={class:"container-fluid"},he={class:"card"},ye={class:"card-header"},ke={class:"d-flex flex-wrap justify-content-between align-items-center w-100"},we={class:"d-flex flex-wrap align-items-center"},xe={class:"modal fade",id:"competitionModal",tabindex:"-1",role:"dialog","aria-hidden":"true"},Se={class:"modal-dialog modal-lg",role:"document"},$e={class:"modal-content"},Te={class:"modal-header"},Ee={class:"modal-title"},je={class:"modal-body"},Be={key:0,class:"alert alert-info text-sm mb-3"},Ce={class:"form-row"},De={class:"form-group col-md-6"},Ge=["value"],Me={class:"form-group col-md-6"},Ve=["value"],Ie={key:0,class:"text-muted d-block mt-1"},Ke={class:"form-group col-md-12"},Ue={class:"form-group col-md-6"},Ne={class:"modal-footer"},Pe=["disabled"],Ae={key:0,class:"fas fa-spinner fa-spin mr-1"},Re={__name:"EventCompetitionsTree",setup(Fe){const H=oe(),J=ne(),M=B(()=>J.eventData||null),o=B(()=>{var a;return((a=M.value)==null?void 0:a.id)||null}),V=v([]),h=v([]),E=v([]),x=v(""),S=v(!1),$=v(!1),i=v(I());function I(){return{id:null,event_group_id:"",round_id:"",full_name:"",scheduled_at:""}}const _=a=>String(a??"").replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#39;"),L=a=>{const e=String(a||"");return e==="draft"?"badge-secondary":e==="ongoing"?"badge-info":e==="finished"?"badge-success":e==="cancelled"?"badge-danger":"badge-light"},O=a=>{if(!a)return"-";const e=new Date(a);if(Number.isNaN(e.getTime()))return a;const n=String(e.getDate()).padStart(2,"0"),s=String(e.getMonth()+1).padStart(2,"0"),c=e.getFullYear(),u=String(e.getHours()).padStart(2,"0"),f=String(e.getMinutes()).padStart(2,"0");return`${n}-${s}-${c} ${u}:${f}`},j=B(()=>{const a=String(i.value.event_group_id||"");return(h.value||[]).find(e=>String(e.id)===a)||null});C(()=>i.value.event_group_id,a=>{const e=(h.value||[]).find(n=>String(n.id)===String(a));i.value.full_name=(e==null?void 0:e.full_name)||""});const K=async()=>{if(!o.value)return;const{data:a}=await b.get(`/api/v1/events/${o.value}/competitions/meta`);V.value=a.rounds||[],h.value=a.event_groups||[]},U=async()=>{if(!o.value)return;const{data:a}=await b.get(`/api/v1/events/${o.value}/competitions/tree`,{params:{search:x.value||""}});E.value=a.rounds||[]},N=async()=>{await F();const a=g("#tree-container");a.jstree(!0)&&a.jstree(!0).destroy(),a.off(".jstree"),a.off("activate_node.jstree"),a.off("select_node.jstree"),a.off("click",".js-edit-competition"),a.off("click",".js-del-competition"),a.jstree({core:{check_callback:!0,themes:{stripes:!0},html_titles:!0,data:(e,n)=>{var s;if(e.id==="#"){const c=(E.value||[]).map(u=>{var f;return{id:`round-${u.id}`,type:"round",children:!0,data:{roundId:u.id},text:`
              <span class="tree-round">
                <strong>${_(u.name)}</strong>
                <span class="badge badge-light border ml-2">${((f=u.competitions)==null?void 0:f.length)||0} kompetisi</span>
              </span>
            `}});n(c);return}if(e.type==="round"){const c=String(((s=e.data)==null?void 0:s.roundId)||""),u=(E.value||[]).find(l=>String(l.id)===String(c)),f=(u==null?void 0:u.competitions)||[];if(!f.length){n([{id:`info-empty-${c}`,type:"info",children:!1,text:'<span class="text-muted">Belum ada kompetisi di babak ini.</span>'}]);return}n(f.map(l=>{var P;const Z=l.is_team?'<span class="badge badge-dark ml-2">TEAM</span>':"",ee=L(l.status),te=_(O(l.scheduled_at)),ae=_(l.venue||"-"),se=_(((P=l.event_group)==null?void 0:P.full_name)||"-");return{id:`comp-${l.id}`,type:"competition",children:!1,data:{competitionId:l.id},text:`
                <span class="tree-comp">
                  <span class="tree-comp-title">
                    <strong>${_(l.full_name)}</strong>
                    ${Z}
                    <span class="badge ${ee} ml-2">${_(l.status)}</span>
                  </span>

                  <span class="tree-comp-sub text-muted">
                    <span class="mr-2"><i class="far fa-clock mr-1"></i>${te}</span>
                    <span class="mr-2"><i class="fas fa-map-marker-alt mr-1"></i>${ae}</span>
                    <span class="mr-2"><i class="fas fa-layer-group mr-1"></i>${se}</span>
                  </span>

                  <span class="tree-actions ml-2">
                    <a href="#" class="badge badge-info js-edit-competition" data-id="${l.id}">
                      <i class="fas fa-edit mr-1"></i>Edit
                    </a>
                    <a href="#" class="badge badge-danger js-del-competition ml-1" data-id="${l.id}">
                      <i class="fas fa-trash mr-1"></i>Hapus
                    </a>
                  </span>
                </span>
              `}}));return}n([])}},plugins:["types","state","search"],state:{key:"event-competitions-tree-v2",filter:e=>{var n;return(n=e==null?void 0:e.core)!=null&&n.selected&&(e.core.selected=[]),e}},types:{round:{icon:"far fa-folder"},competition:{icon:"far fa-flag"},info:{icon:"far fa-circle"}}}),a.on("activate_node.jstree",(e,n)=>{if(!n||!n.node)return;const s=n.node;if(s.type==="round"){g("#tree-container").jstree(!0).toggle_node(s);return}if(s.type==="competition"){const c=String(s.id).replace("comp-","");H.push({name:"admin.event.scoring.input-specific",params:{id:c}})}}),a.on("click",".js-edit-competition",async e=>{e.preventDefault(),e.stopPropagation();const n=e.currentTarget.getAttribute("data-id");return n&&await Q(n),!1}),a.on("click",".js-del-competition",async e=>{e.preventDefault(),e.stopPropagation();const n=e.currentTarget.getAttribute("data-id");return n&&await X(n),!1})},y=async()=>{await U(),await N()},Y=async()=>{await F();const a=g("#tree-container").jstree(!0);if(a){try{a.clear_state()}catch{}try{a.deselect_all(!0),a.close_all("#",0),a.redraw(!0)}catch{}}},q=le(a=>{const e=g("#tree-container").jstree(!0);e&&e.search(a)},300);C(()=>x.value,a=>{y(),q(a)});const z=async()=>{if(!o.value){d.fire("Event belum dipilih","Silakan pilih event melalui Portal Event terlebih dahulu.","info");return}S.value=!1,i.value=I(),g("#competitionModal").modal("show")},Q=async a=>{try{const{data:e}=await b.get(`/api/v1/event-competitions/${a}`);S.value=!0,i.value={id:e.id,event_group_id:e.event_group_id,round_id:e.round_id,full_name:"",scheduled_at:e.scheduled_at?String(e.scheduled_at).slice(0,16):""};const n=(h.value||[]).find(s=>String(s.id)===String(i.value.event_group_id));i.value.full_name=(n==null?void 0:n.full_name)||e.full_name||"",g("#competitionModal").modal("show")}catch(e){console.error(e),d.fire("Gagal","Gagal memuat data kompetisi.","error")}},W=async()=>{var e,n;if(!o.value)return;const a=j.value;if(i.value.full_name=(a==null?void 0:a.full_name)||i.value.full_name||"",!i.value.round_id||!i.value.event_group_id){d.fire("Validasi","Round dan Event Group wajib diisi.","warning");return}$.value=!0;try{const s={event_id:o.value,round_id:i.value.round_id,event_group_id:i.value.event_group_id,full_name:i.value.full_name,scheduled_at:i.value.scheduled_at?i.value.scheduled_at.replace("T"," "):null};S.value&&i.value.id?(await b.put(`/api/v1/event-competitions/${i.value.id}`,s),d.fire("Berhasil","Kompetisi berhasil diperbarui.","success")):(await b.post(`/api/v1/events/${o.value}/competitions`,s),d.fire("Berhasil","Kompetisi berhasil ditambahkan.","success")),g("#competitionModal").modal("hide"),await y()}catch(s){console.error(s),d.fire("Gagal",((n=(e=s==null?void 0:s.response)==null?void 0:e.data)==null?void 0:n.message)||"Terjadi kesalahan saat menyimpan.","error")}finally{$.value=!1}},X=async a=>{if((await d.fire({title:"Hapus kompetisi?",text:"Data yang dihapus tidak dapat dikembalikan.",icon:"warning",showCancelButton:!0,confirmButtonText:"Ya, hapus",cancelButtonText:"Batal",confirmButtonColor:"#d33"})).isConfirmed)try{await b.delete(`/api/v1/event-competitions/${a}`),d.fire("Terhapus","Kompetisi berhasil dihapus.","success"),await y()}catch(n){console.error(n),d.fire("Gagal","Gagal menghapus kompetisi.","error")}};return ie(async()=>{if(!o.value){d.fire("Event belum dipilih","Silakan pilih event melalui Portal Event terlebih dahulu.","info");return}try{await K(),await U(),await N()}catch(a){console.error(a),d.fire("Gagal","Gagal memuat data kompetisi.","error")}}),C(()=>o.value,async a=>{a&&(await K(),await y())}),(a,e)=>{var n;return p(),m(G,null,[t("section",de,[t("div",ue,[t("div",ce,[e[7]||(e[7]=t("div",null,[t("h1",{class:"mb-1"},"Kompetisi Event"),t("p",{class:"mb-0 text-muted text-sm"}," Mengelola daftar kompetisi per babak (Round) dalam event aktif. ")],-1)),t("div",me,[t("button",{class:"btn btn-sm btn-primary",disabled:!o.value,onClick:z},e[5]||(e[5]=[t("i",{class:"fas fa-plus mr-1"},null,-1),r(" Tambah Kompetisi ")]),8,pe),t("button",{class:"btn btn-sm btn-outline-secondary",disabled:!o.value,onClick:y},e[6]||(e[6]=[t("i",{class:"fas fa-sync mr-1"},null,-1),r(" Refresh ")]),8,fe),t("button",{class:"btn btn-sm btn-outline-secondary",disabled:!o.value,onClick:Y}," Reset View ",8,ve)])]),o.value?T("",!0):(p(),m("p",ge,e[8]||(e[8]=[t("i",{class:"fas fa-exclamation-triangle mr-1"},null,-1),r(" Event belum dipilih. Silakan pilih event melalui Portal Event terlebih dahulu. ")])))])]),t("section",_e,[t("div",be,[t("div",he,[t("div",ye,[t("div",ke,[t("div",we,[e[9]||(e[9]=t("label",{class:"mb-0 mr-2 text-sm text-muted"},"Cari",-1)),k(t("input",{"onUpdate:modelValue":e[0]||(e[0]=s=>x.value=s),type:"text",class:"form-control form-control-sm w-auto",style:{"min-width":"260px"},placeholder:"Cari nama kompetisi / venue..."},null,512),[[D,x.value]])]),e[10]||(e[10]=t("div",{class:"text-muted text-sm mt-2 mt-sm-0"},[r(" Tampilan tree dikelompokkan per "),t("strong",null,"Babak")],-1))])]),e[11]||(e[11]=t("div",{class:"card-body"},[t("div",{id:"tree-container"})],-1))])]),t("div",xe,[t("div",Se,[t("div",$e,[t("div",Te,[t("h5",Ee,w(S.value?"Edit Kompetisi":"Tambah Kompetisi"),1),e[12]||(e[12]=t("button",{type:"button",class:"close","data-dismiss":"modal","aria-label":"Close"},[t("span",{"aria-hidden":"true"},"Ã—")],-1))]),t("div",je,[o.value?(p(),m("div",Be,[e[13]||(e[13]=r(" Event: ")),t("strong",null,w((n=M.value)==null?void 0:n.event_name),1)])):T("",!0),t("div",Ce,[t("div",De,[e[15]||(e[15]=t("label",{class:"mb-1"},[r("Babak (Round) "),t("span",{class:"text-danger"},"*")],-1)),k(t("select",{"onUpdate:modelValue":e[1]||(e[1]=s=>i.value.round_id=s),class:"form-control form-control-sm"},[e[14]||(e[14]=t("option",{value:"",disabled:""},"-- Pilih Babak --",-1)),(p(!0),m(G,null,R(V.value,s=>(p(),m("option",{key:s.id,value:s.id},w(s.name),9,Ge))),128))],512),[[A,i.value.round_id]])]),t("div",Me,[e[19]||(e[19]=t("label",{class:"mb-1"},[r("Golongan Event (Event Group) "),t("span",{class:"text-danger"},"*")],-1)),k(t("select",{"onUpdate:modelValue":e[2]||(e[2]=s=>i.value.event_group_id=s),class:"form-control form-control-sm"},[e[16]||(e[16]=t("option",{value:"",disabled:""},"-- Pilih Golongan --",-1)),(p(!0),m(G,null,R(h.value,s=>(p(),m("option",{key:s.id,value:s.id},w(s.full_name||s.name),9,Ve))),128))],512),[[A,i.value.event_group_id]]),j.value?(p(),m("small",Ie,[e[17]||(e[17]=r(" Tipe: ")),t("strong",null,w(j.value.is_team?"TEAM":"INDIVIDU"),1),e[18]||(e[18]=r(" (diambil dari Event Group) "))])):T("",!0)]),t("div",Ke,[e[20]||(e[20]=t("label",{class:"mb-1"},[r("Nama Kompetisi (otomatis) "),t("span",{class:"text-danger"},"*")],-1)),k(t("input",{"onUpdate:modelValue":e[3]||(e[3]=s=>i.value.full_name=s),type:"text",class:"form-control form-control-sm",readonly:""},null,512),[[D,i.value.full_name]]),e[21]||(e[21]=t("small",{class:"text-muted"},[r(" Otomatis mengikuti "),t("strong",null,"Event Group"),r(". ")],-1))]),t("div",Ue,[e[22]||(e[22]=t("label",{class:"mb-1"},"Jadwal (scheduled_at)",-1)),k(t("input",{"onUpdate:modelValue":e[4]||(e[4]=s=>i.value.scheduled_at=s),type:"datetime-local",class:"form-control form-control-sm"},null,512),[[D,i.value.scheduled_at]])])]),e[23]||(e[23]=t("small",{class:"text-muted"}," * Kombinasi unik: event + group + round (akan ditolak jika duplikat). ",-1))]),t("div",Ne,[e[25]||(e[25]=t("button",{class:"btn btn-sm btn-secondary","data-dismiss":"modal"},"Batal",-1)),t("button",{class:"btn btn-sm btn-primary",disabled:$.value,onClick:W},[$.value?(p(),m("i",Ae)):T("",!0),e[24]||(e[24]=r(" Simpan "))],8,Pe)])])])])])],64)}}},Ye=re(Re,[["__scopeId","data-v-287f8c50"]]);export{Ye as default};
