import{z as ie,y as de,A as m,O as N,V as re,B as i,C as d,D as e,I as K,K as M,S as r,aB as j,as as x,U as D,ay as I,J as o,H as A,F as z,ax as ue,aA as me,G as ce,a as U,aC as ve}from"./AuthUserStore-67h2FHdL.js";import{S as f}from"./sweetalert2.esm.all-9Qm2jZ7z.js";import{b as pe}from"./EventParticipantHelpers-CO5Top6O.js";import{_ as ge}from"./app-CZBZEz52.js";const _e={class:"content-header"},fe={class:"container-fluid"},be={class:"d-flex justify-content-between align-items-center"},ke=["disabled"],he={key:0,class:"text-danger text-sm mt-2"},xe={class:"content"},je={class:"container-fluid"},ye={class:"card"},Se={class:"card-header py-2"},Ne={class:"d-flex flex-wrap align-items-center justify-content-between"},De={class:"d-flex flex-wrap align-items-center gap-2"},we={class:"card-body table-responsive p-0"},Ee={class:"table table-bordered table-hover text-sm mb-0"},Me={key:0},Ie={key:1},Ae={class:"text-center"},Ue={class:"text-xs text-muted"},Ce={class:"text-center"},Ve={class:"text-center"},He={class:"btn-group btn-group-sm"},Ke=["onClick"],Be=["onClick"],Te={class:"card-footer clearfix py-2"},$e={class:"d-flex justify-content-between align-items-center"},Pe={class:"text-muted text-sm"},Fe={class:"pagination pagination-sm m-0"},Le={class:"page-item disabled"},ze={class:"page-link"},Oe={class:"modal fade",id:"judgeModal",tabindex:"-1",role:"dialog"},Ge={class:"modal-dialog modal-lg modal-dialog-centered modal-dialog-scrollable",role:"document"},Je={class:"modal-content"},Re={class:"modal-header py-2"},Ye={class:"modal-title text-sm font-weight-bold"},qe={class:"modal-body pt-2"},Qe={class:"mb-3"},We={class:"row"},Xe={class:"col-md-4"},Ze={class:"form-group mb-1"},et={class:"input-group input-group-sm"},tt={class:"input-group-append"},at={class:"input-group-text"},st={key:0,class:"fas fa-spinner fa-spin"},lt={key:1,class:"fas fa-id-card"},ot={key:0,class:"invalid-feedback d-block"},nt={class:"col-md-4"},it={class:"form-group mb-1"},dt={class:"col-md-4"},rt={class:"form-group mb-1"},ut={class:"row mt-2"},mt={class:"col-md-3"},ct={class:"form-group mb-1"},vt={class:"col-md-3"},pt={class:"form-group mb-1"},gt={class:"col-md-3"},_t={class:"form-group mb-1"},ft=["value"],bt={class:"col-md-3"},kt={class:"form-group mb-1"},ht=["value"],xt={class:"row mt-2"},jt={class:"col-md-3"},yt={class:"form-group mb-1"},St={class:"col-md-3 d-flex align-items-end"},Nt={class:"form-group mb-1"},Dt={class:"custom-control custom-switch"},wt={class:"mb-2"},Et={class:"row"},Mt={class:"col-md-3"},It={class:"form-group mb-1"},At=["value"],Ut={class:"col-md-3"},Ct={class:"form-group mb-1"},Vt={class:"col-md-4"},Ht={class:"form-group mb-1"},Kt={class:"modal-footer py-2"},Bt=["disabled"],Tt={key:0,class:"fas fa-spinner fa-spin mr-1"},$t={key:1,class:"fas fa-save mr-1"},Pt={__name:"EventJudges",setup(Ft){const O=ie(),b=de(()=>{var s;return((s=O.eventData)==null?void 0:s.id)||null}),v=m([]),w=m(""),C=m(!1),k=m(!1),E=m(!1),p=m(""),V=m(!1),H=m(null),y=m(25),G=["Tilawah","Tahfidz","Tafsir","Fahmil","Syarhil","Khat","Qiraat","Hadits"],J=["Nasional","Provinsi","Kabupaten","Kecamatan","Internal","Non Sertifikasi"],R=s=>s?/^\d{16}$/.test(s)?"":"NIK harus 16 digit angka":"NIK wajib diisi",n=m({current_page:1,per_page:10,total:0,from:0,to:0,last_page:1}),B=s=>{s<1||s>n.value.last_page||S(s)},Y=s=>s+1+(n.value.current_page-1)*n.value.per_page,T=()=>({user:{id:null,name:"",email:"",username:""},master_judge:{id:null,nik:"",date_of_birth:"",gender:"",specialization:"",certification_level:"",full_name:"",education:"SMA",bank_name:"",bank_account_number:"",bank_account_name:"",is_active:!0},event_judge:{id:null,is_active:!0}}),l=m(T()),S=async(s=1)=>{if(b.value){C.value=!0;try{const a=(await U.get(`/api/v1/events/${b.value}/judges`,{params:{page:s,per_page:y.value,search:w.value}})).data;v.value=a.data||[],n.value={current_page:a.current_page,per_page:a.per_page,total:a.total,from:a.from,to:a.to,last_page:a.last_page}}catch{f.fire("Error","Gagal memuat data hakim","error")}finally{C.value=!1}}},q=()=>{k.value=!1,l.value=T(),$("#judgeModal").modal("show")},Q=s=>{k.value=!0,F.value=s.master_judge.nik,l.value={user:{...s.user},master_judge:{...s.master_judge},event_judge:{...s}},$("#judgeModal").modal("show")},W=async()=>{var s,t;if(H.value==="already_registered"){f.fire("Tidak dapat disimpan","Hakim sudah terdaftar","warning");return}if(p.value){f.fire("Validasi gagal",p.value,"warning");return}E.value=!0;try{const c=(await U.post("/api/v1/save-event-judges",{event_id:b.value,...l.value})).data.data;if(k.value||n.value.current_page===1&&(v.value.unshift(c),v.value.length>y.value&&v.value.pop(),n.value.total++,n.value.to++),k.value){const g=P(c.id);g!==-1&&v.value.splice(g,1,c)}f.fire("Berhasil","Data hakim disimpan","success"),$("#judgeModal").modal("hide")}catch(a){f.fire("Gagal",((t=(s=a.response)==null?void 0:s.data)==null?void 0:t.message)||"Gagal menyimpan","error")}finally{E.value=!1}},P=s=>v.value.findIndex(t=>t.id===s),X=async s=>{if(!(await f.fire({title:"Hapus Hakim?",text:s.master_judge.full_name,showCancelButton:!0,confirmButtonColor:"#d33"})).isConfirmed)return;await U.delete(`/api/v1/event-judges/${s.id}`);const a=P(s.id);a!==-1&&(v.value.splice(a,1),n.value.total--,n.value.to--),f.fire("Dihapus","Hakim berhasil dihapus","success")},Z=s=>{const t=String(s||"").replace(/\D/g,"");if(t.length!==16)return null;const a=t.slice(6,8),c=t.slice(8,10),g=t.slice(10,12);let _=parseInt(a,10);const h=parseInt(c,10),u=parseInt(g,10);if(Number.isNaN(_)||Number.isNaN(h)||Number.isNaN(u))return null;let L="MALE";if(_>40&&(_-=40,L="FEMALE"),_<1||_>31||h<1||h>12)return null;const ae=new Date().getFullYear()%100,se=u<=ae?2e3+u:1900+u,le=String(se).padStart(4,"0"),oe=String(h).padStart(2,"0"),ne=String(_).padStart(2,"0");return{date:`${le}-${oe}-${ne}`,gender:L}},ee=s=>{const t=(s||"").replace(/\D/g,"");if(t.length!==16)return null;const a=Z(t);return a?{dateOfBirth:a.date,gender:a.gender}:null},F=m(null),te=async()=>{var c,g,_,h;const s=(l.value.master_judge.nik||"").replace(/\D/g,"");if(l.value.master_judge.nik=s,p.value="",k.value&&l.value.master_judge.id&&l.value.master_judge.nik===F.value)return;const t=R(s);if(t){p.value=t;return}l.value.user.username=s;const a=ee(s);a&&((c=l.value.master_judge).date_of_birth||(c.date_of_birth=a.dateOfBirth),(g=l.value.master_judge).gender||(g.gender=a.gender)),V.value=!0,H.value=null;try{const u=await U.get("/api/v1/check-nik-judge",{params:{nik:s,event_id:b.value,master_judge_id:l.value.master_judge.id||null}});H.value=u.data.status,u.data.status==="exists"&&(l.value.master_judge={...l.value.master_judge,...u.data.data.master_judge},l.value.user={...l.value.user,...u.data.data.user},f.fire("Info","Data hakim ditemukan. Data dimuat otomatis.","info")),u.data.status==="already_registered"&&(p.value="Dewan hakim sudah terdaftar pada event ini")}catch(u){p.value=((h=(_=u.response)==null?void 0:_.data)==null?void 0:h.message)||"Gagal validasi NIK"}finally{V.value=!1}};return N(()=>w.value,ve(()=>S(1),400)),N(()=>y.value,()=>S(1)),N(()=>b.value,s=>s&&S(1)),N(()=>l.value.master_judge.is_active,s=>{l.value.event_judge.is_active=s}),N(()=>l.value.user.name,s=>{s&&(l.value.master_judge.full_name=s)}),re(S),(s,t)=>(d(),i(D,null,[e("section",_e,[e("div",fe,[e("div",be,[t[17]||(t[17]=e("div",null,[e("h1",{class:"mb-1"},"Manajemen Dewan Hakim Event"),e("p",{class:"mb-0 text-muted text-sm"}," Kelola data User, Master Hakim, dan Penugasan Hakim pada Event ")],-1)),e("button",{class:"btn btn-primary btn-sm",disabled:!b.value,onClick:q},t[16]||(t[16]=[e("i",{class:"fas fa-user-plus mr-1"},null,-1),M(" Tambah Hakim ")]),8,ke)])]),b.value?K("",!0):(d(),i("p",he,t[18]||(t[18]=[e("i",{class:"fas fa-exclamation-triangle mr-1"},null,-1),M(" Event belum dipilih. ")])))]),e("section",xe,[e("div",je,[e("div",ye,[e("div",Se,[e("div",Ne,[e("div",De,[t[20]||(t[20]=e("span",{class:"text-xs text-muted"},"Tampil",-1)),r(e("select",{"onUpdate:modelValue":t[0]||(t[0]=a=>y.value=a),class:"form-control form-control-sm w-auto"},t[19]||(t[19]=[e("option",{value:10},"10",-1),e("option",{value:25},"25",-1),e("option",{value:50},"50",-1),e("option",{value:100},"100",-1)]),512),[[j,y.value,void 0,{number:!0}]]),t[21]||(t[21]=e("span",{class:"text-xs text-muted"},"entri",-1))]),r(e("input",{"onUpdate:modelValue":t[1]||(t[1]=a=>w.value=a),type:"text",class:"form-control form-control-sm mt-2 mt-md-0",style:{width:"220px"},placeholder:"Cari nama / NIK / username"},null,512),[[x,w.value]])])]),e("div",we,[e("table",Ee,[t[26]||(t[26]=e("thead",{class:"thead-light"},[e("tr",null,[e("th",{width:"40"},"#"),e("th",null,"Hakim"),e("th",null,"NIK"),e("th",null,"Spesialisasi"),e("th",null,"Sertifikasi"),e("th",null,"Kode"),e("th",{style:{width:"90px"},class:"text-center"},"Status"),e("th",{style:{width:"120px"},class:"text-center"},"Aksi")])],-1)),e("tbody",null,[C.value?(d(),i("tr",Me,t[22]||(t[22]=[e("td",{colspan:"7",class:"text-center text-muted"}," Memuat data hakim... ",-1)]))):v.value.length===0?(d(),i("tr",Ie,t[23]||(t[23]=[e("td",{colspan:"7",class:"text-center text-muted"}," Belum ada hakim pada event ini ",-1)]))):K("",!0),(d(!0),i(D,null,I(v.value,(a,c)=>(d(),i("tr",{key:a.id},[e("td",Ae,o(Y(c)),1),e("td",null,[e("strong",null,o(a.master_judge.full_name),1),e("div",Ue,o(a.user.username)+" • "+o(a.user.email),1)]),e("td",null,o(a.master_judge.nik||"-"),1),e("td",null,o(a.master_judge.specialization||"-"),1),e("td",null,o(a.master_judge.certification_level||"-"),1),e("td",null,o(a.judge_code||"-"),1),e("td",Ce,[e("span",{class:A(["badge",a.is_active?"badge-success":"badge-secondary"])},o(a.is_active?"Aktif":"Nonaktif"),3)]),e("td",Ve,[e("div",He,[e("button",{class:"btn btn-outline-warning btn-xs",onClick:g=>Q(a),title:"Edit"},t[24]||(t[24]=[e("i",{class:"fas fa-edit"},null,-1)]),8,Ke),e("button",{class:"btn btn-outline-danger btn-xs",onClick:g=>X(a),title:"Hapus"},t[25]||(t[25]=[e("i",{class:"fas fa-trash"},null,-1)]),8,Be)])])]))),128))])]),e("div",Te,[e("div",$e,[e("div",Pe," Menampilkan "+o(n.value.from||0)+" - "+o(n.value.to||0)+" dari "+o(n.value.total||0)+" data ",1),e("ul",Fe,[e("li",{class:A(["page-item",{disabled:n.value.current_page===1}])},[e("a",{href:"#",class:"page-link",onClick:t[2]||(t[2]=z(a=>B(n.value.current_page-1),["prevent"]))},"«")],2),e("li",Le,[e("span",ze," Halaman "+o(n.value.current_page)+" / "+o(n.value.last_page||1),1)]),e("li",{class:A(["page-item",{disabled:n.value.current_page===n.value.last_page}])},[e("a",{href:"#",class:"page-link",onClick:t[3]||(t[3]=z(a=>B(n.value.current_page+1),["prevent"]))},"»")],2)])])])])])]),e("div",Oe,[e("div",Ge,[e("div",Je,[e("div",Re,[e("h5",Ye,o(k.value?"Edit Hakim Event":"Tambah Hakim Event"),1),t[27]||(t[27]=e("button",{class:"close","data-dismiss":"modal"},[e("span",null,"×")],-1))]),e("div",qe,[e("form",null,[e("div",Qe,[t[42]||(t[42]=e("h6",{class:"mb-1 font-weight-bold text-muted"}," IDENTITAS & AKUN HAKIM anjing ",-1)),t[43]||(t[43]=e("hr",{class:"mt-1 mb-3"},null,-1)),e("div",We,[e("div",Xe,[e("div",Ze,[t[28]||(t[28]=e("label",{class:"mb-1"},[M(" NIK "),e("span",{class:"text-danger"},"*")],-1)),e("div",et,[r(e("input",{"onUpdate:modelValue":t[4]||(t[4]=a=>l.value.master_judge.nik=a),class:A(["form-control form-control-sm",{"is-invalid":p.value}]),placeholder:"16 digit NIK",onBlur:te},null,34),[[x,l.value.master_judge.nik]]),e("div",tt,[e("span",at,[V.value?(d(),i("i",st)):(d(),i("i",lt))])])]),p.value?(d(),i("div",ot,o(p.value),1)):K("",!0),t[29]||(t[29]=e("small",{class:"text-muted text-xs"}," Wajib 16 digit, akan dicek otomatis ",-1))])]),e("div",nt,[e("div",it,[t[30]||(t[30]=e("label",{class:"mb-1"},"Nama Lengkap",-1)),r(e("input",{"onUpdate:modelValue":t[5]||(t[5]=a=>l.value.user.name=a),class:"form-control form-control-sm",required:""},null,512),[[x,l.value.user.name]])])]),e("div",dt,[e("div",rt,[t[31]||(t[31]=e("label",{class:"mb-1"},"Email",-1)),r(e("input",{"onUpdate:modelValue":t[6]||(t[6]=a=>l.value.user.email=a),type:"email",class:"form-control form-control-sm",required:""},null,512),[[x,l.value.user.email]])])])]),e("div",ut,[e("div",mt,[e("div",ct,[t[32]||(t[32]=e("label",{class:"mb-1"},"Tanggal Lahir",-1)),r(e("input",{"onUpdate:modelValue":t[7]||(t[7]=a=>l.value.master_judge.date_of_birth=a),type:"date",class:"form-control form-control-sm",readonly:""},null,512),[[x,l.value.master_judge.date_of_birth]])])]),e("div",vt,[e("div",pt,[t[34]||(t[34]=e("label",{class:"mb-1"},"Jenis Kelamin",-1)),r(e("select",{"onUpdate:modelValue":t[8]||(t[8]=a=>l.value.master_judge.gender=a),class:"form-control form-control-sm",readonly:""},t[33]||(t[33]=[e("option",{value:"MALE"},"Laki-laki",-1),e("option",{value:"FEMALE"},"Perempuan",-1)]),512),[[j,l.value.master_judge.gender]])])]),e("div",gt,[e("div",_t,[t[36]||(t[36]=e("label",{class:"mb-1"},"Spesialisasi",-1)),r(e("select",{"onUpdate:modelValue":t[9]||(t[9]=a=>l.value.master_judge.specialization=a),class:"form-control form-control-sm"},[t[35]||(t[35]=e("option",{value:""},"- Pilih Spesialisasi -",-1)),(d(),i(D,null,I(G,a=>e("option",{key:a,value:a},o(a),9,ft)),64))],512),[[j,l.value.master_judge.specialization]])])]),e("div",bt,[e("div",kt,[t[38]||(t[38]=e("label",{class:"mb-1"},"Sertifikasi",-1)),r(e("select",{"onUpdate:modelValue":t[10]||(t[10]=a=>l.value.master_judge.certification_level=a),class:"form-control form-control-sm"},[t[37]||(t[37]=e("option",{value:""},"- Pilih Sertifikasi -",-1)),(d(),i(D,null,I(J,a=>e("option",{key:a,value:a},o(a),9,ht)),64))],512),[[j,l.value.master_judge.certification_level]])])])]),e("div",xt,[e("div",jt,[e("div",yt,[t[40]||(t[40]=e("label",{class:"mb-1"},"Pendidikan",-1)),r(e("select",{"onUpdate:modelValue":t[11]||(t[11]=a=>l.value.master_judge.education=a),class:"form-control form-control-sm"},t[39]||(t[39]=[ue('<option value="SD" data-v-ca254575>SD</option><option value="SMP" data-v-ca254575>SMP</option><option value="SMA" data-v-ca254575>SMA</option><option value="D1" data-v-ca254575>D1</option><option value="D2" data-v-ca254575>D2</option><option value="D3" data-v-ca254575>D3</option><option value="D4" data-v-ca254575>D4</option><option value="S1" data-v-ca254575>S1</option><option value="S2" data-v-ca254575>S2</option><option value="S3" data-v-ca254575>S3</option>',10)]),512),[[j,l.value.master_judge.education]])])]),e("div",St,[e("div",Nt,[e("div",Dt,[r(e("input",{type:"checkbox",class:"custom-control-input",id:"judgeActive","onUpdate:modelValue":t[12]||(t[12]=a=>l.value.master_judge.is_active=a)},null,512),[[me,l.value.master_judge.is_active]]),t[41]||(t[41]=e("label",{class:"custom-control-label",for:"judgeActive"}," Hakim Aktif ",-1))])])])])]),e("div",wt,[t[47]||(t[47]=e("h6",{class:"mb-1 font-weight-bold text-muted"}," DATA REKENING (OPSIONAL) ",-1)),t[48]||(t[48]=e("hr",{class:"mt-1 mb-3"},null,-1)),e("div",Et,[e("div",Mt,[e("div",It,[t[44]||(t[44]=e("label",{class:"mb-1"},"Nama Bank",-1)),r(e("select",{"onUpdate:modelValue":t[13]||(t[13]=a=>l.value.master_judge.bank_name=a),class:"form-control form-control-sm"},[(d(!0),i(D,null,I(ce(pe),a=>(d(),i("option",{key:a,value:a},o(a),9,At))),128))],512),[[j,l.value.master_judge.bank_name]])])]),e("div",Ut,[e("div",Ct,[t[45]||(t[45]=e("label",{class:"mb-1"},"No. Rekening",-1)),r(e("input",{"onUpdate:modelValue":t[14]||(t[14]=a=>l.value.master_judge.bank_account_number=a),class:"form-control form-control-sm"},null,512),[[x,l.value.master_judge.bank_account_number]])])]),e("div",Vt,[e("div",Ht,[t[46]||(t[46]=e("label",{class:"mb-1"},"Nama Pemilik Rekening",-1)),r(e("input",{"onUpdate:modelValue":t[15]||(t[15]=a=>l.value.master_judge.bank_account_name=a),class:"form-control form-control-sm"},null,512),[[x,l.value.master_judge.bank_account_name]])])])])])])]),e("div",Kt,[t[49]||(t[49]=e("button",{class:"btn btn-sm btn-secondary","data-dismiss":"modal"}," Batal ",-1)),e("button",{class:"btn btn-sm btn-primary",type:"button",disabled:E.value,onClick:W},[E.value?(d(),i("i",Tt)):(d(),i("i",$t)),M(" "+o(k.value?"Update":"Simpan"),1)],8,Bt)])])])])])],64))}},Rt=ge(Pt,[["__scopeId","data-v-ca254575"]]);export{Rt as default};
