import{A as h,z as Q,y as S,O as U,V as W,B as s,C as a,D as t,I as C,K as u,J as i,H as B,S as X,aB as Z,U as c,ay as p,F as T,a as F}from"./AuthUserStore-67h2FHdL.js";import{S as y}from"./sweetalert2.esm.all-9Qm2jZ7z.js";import{_ as tt}from"./app-CZBZEz52.js";const et={class:"content-header"},nt={class:"container-fluid"},st={class:"d-flex justify-content-between align-items-center"},at={key:0,class:"text-muted text-sm mt-1"},lt={class:"badge badge-light border"},it={class:"d-flex align-items-center gap-2"},ot=["disabled"],rt=["disabled"],ut={class:"content"},dt={class:"container-fluid"},ct={class:"card"},vt={class:"card-body py-2"},mt={class:"form-row align-items-end"},pt={class:"form-group col-md-8 mb-0"},gt=["disabled"],_t=["label"],ht=["value"],ft={key:0,class:"text-muted"},bt={class:"form-group col-md-4 mb-0"},kt=["disabled"],yt={class:"card mt-3"},xt={class:"card-body p-0 table-responsive"},wt={key:0,class:"px-3"},Ct={class:"nav nav-pills nav-sm"},Pt={class:"nav-item"},Rt={class:"nav-item"},St={class:"nav-item"},Bt={class:"table table-bordered table-sm mb-0"},Nt={class:"thead-light"},Ft={key:0},Mt={key:1},It={key:0},Lt=["colspan"],Tt={key:1},At=["colspan"],Dt={key:2},Gt=["colspan"],$t={class:"text-center font-weight-bold"},Kt={class:"font-weight-bold"},Vt={class:"text-xs text-muted mb-0 pl-3"},Et={class:"text-center"},Ut={class:"text-center font-weight-bold"},jt={class:"text-center font-weight-bold"},Jt={class:"font-weight-bold"},zt={class:"text-muted text-xs"},Ht={class:"text-center font-weight-bold"},Ot={class:"card-footer text-muted text-sm"},Yt={key:0,class:"alert alert-warning py-2 mt-2 text-sm"},qt={key:1,class:"card mt-2"},Qt={key:2,class:"card mt-3"},Wt={class:"card-header py-2"},Xt={key:0,class:"card-body text-center text-muted py-4"},Zt={key:1,class:"card-body p-0 table-responsive"},te={class:"table table-bordered table-sm mb-0"},ee={class:"thead-light"},ne=["colspan"],se={class:"text-center font-weight-bold"},ae={class:"font-weight-bold"},le={key:0},ie={class:"font-weight-bold"},oe={key:1},re={class:"font-weight-bold"},ue={class:"mb-0 pl-3 text-sm text-muted"},de={key:0},ce={key:1,class:"text-muted"},ve={class:"text-center font-weight-bold bg-light"},me={class:"text-center font-weight-bold"},pe={__name:"EventCompetitionRankingV2",setup(ge){const x=h(!1),j=Q(),A=S(()=>{var l;return(l=j.eventData)==null?void 0:l.id}),D=h([]),f=h(""),v=h(null),k=h([]),P=h(!1),N=h(!1),d=h("all"),m=h(null),M=h(!1),J=()=>{var e;if(d.value==="all")return null;const l=k.value.find(n=>{var r,g;return(((g=(r=n.event_category)==null?void 0:r.full_name)==null?void 0:g.toLowerCase())||"").includes(d.value)});return((e=l==null?void 0:l.event_category)==null?void 0:e.id)||null},G=S(()=>{var e,n,o;return!v.value||!k.value.length?!1:(((o=(n=(e=v.value)==null?void 0:e.round)==null?void 0:n.name)==null?void 0:o.toLowerCase())||"").includes("final")}),$=S(()=>{var l,e;return(e=(l=v.value)==null?void 0:l.event_group)==null?void 0:e.judge_assignment_mode}),b=S(()=>{var l,e;return!!((e=(l=v.value)==null?void 0:l.event_group)!=null&&e.is_team)}),z=l=>{if(!l)return"";const e=l.toLowerCase();return e.includes("putra")?"putra":e.includes("putri")?"putri":""},I=S(()=>d.value==="all"?k.value:k.value.filter(l=>{var n;const e=((n=l.event_category)==null?void 0:n.full_name)||"";return z(e)===d.value})),L=l=>{var n,o;if(!((o=(n=m.value)==null?void 0:n.rows)!=null&&o.length))return[];const e=new Set;return m.value.rows.forEach(r=>{var _;const g=(_=r.scores)==null?void 0:_[l];g&&Object.keys(g).forEach(w=>e.add(Number(w)))}),m.value.judges.filter(r=>e.has(r.id))},R=l=>{const e=Number(l);return Number.isFinite(e)?e.toFixed(2):"-"},K=async()=>{if(A.value){P.value=!0;try{const{data:l}=await F.get(`/api/v1/events/${A.value}/competitions/tree`);D.value=l.rounds||[]}catch{y.fire("Gagal","Gagal memuat daftar kompetisi","error")}finally{P.value=!1}}},H=async()=>{if(f.value){N.value=!0;try{const{data:l}=await F.get(`/api/v1/event-competitions/${f.value}/ranking-v2`);v.value=l.competition,k.value=l.ranking||[]}catch{y.fire("Gagal","Gagal memuat ranking","error")}finally{N.value=!1}}},O=async()=>{var n,o,r,g;if(!v.value||x.value)return;const l=((o=(n=v.value)==null?void 0:n.round)==null?void 0:o.name)||"";if(!l.toLowerCase().includes("final")){y.fire("Tidak Diizinkan","Publish hanya diperbolehkan untuk babak FINAL.","warning");return}if((await y.fire({title:"Publish Ranking Final?",html:`
      <div class="text-left text-sm">
        <p><strong>Kompetisi:</strong> ${v.value.full_name}</p>
        <p><strong>Babak:</strong> ${l}</p>
        <hr/>
        <p>
          Sistem akan:
          <ul>
            <li>ğŸ“Š Mengambil ranking final</li>
            <li>ğŸ… Menetapkan <b>Top 6</b> per kategori</li>
            <li>ğŸ“Œ Mengisi medal standing & leaderboard</li>
          </ul>
        </p>
      </div>
    `,icon:"warning",showCancelButton:!0,confirmButtonText:"Ya, Publish",cancelButtonText:"Batal",confirmButtonColor:"#28a745"})).isConfirmed){x.value=!0;try{const _=await F.post(`/api/v1/event-competitions/${v.value.id}/ranking/publish`);y.fire("Berhasil","Ranking final berhasil dipublish (Top 6).","success")}catch(_){const w=((g=(r=_.response)==null?void 0:r.data)==null?void 0:g.message)||"Terjadi kesalahan saat publish ranking.";y.fire("Gagal",w,"error")}finally{x.value=!1}}};return U(f,()=>{k.value=[],v.value=null,d.value="all"}),U(d,async l=>{if(l==="all"||!f.value){m.value=null;return}const e=J();if(!e){m.value=null;return}M.value=!0;try{const{data:n}=await F.get(`/api/v1/event-competitions/${f.value}/ranking-v2/details`,{params:{event_category_id:e}});m.value=n}catch{y.fire("Gagal","Gagal memuat detail nilai","error"),m.value=null}finally{M.value=!1}}),W(K),(l,e)=>(a(),s(c,null,[t("section",et,[t("div",nt,[t("div",st,[t("div",null,[e[7]||(e[7]=t("h1",{class:"mb-1"},"Ranking Kompetisi",-1)),e[8]||(e[8]=t("p",{class:"mb-0 text-muted text-sm"}," Pilih kompetisi berdasarkan ronde, lalu sistem akan menampilkan ranking akhir. ",-1)),v.value?(a(),s("div",at,[e[4]||(e[4]=u(" Group: ")),t("strong",null,i(v.value.event_group.full_name),1),e[5]||(e[5]=u(" â€¢ Mode: ")),t("span",{class:B(["badge",$.value==="BY_PANEL"?"badge-info":"badge-warning"])},i($.value),3),e[6]||(e[6]=u(" â€¢ ")),t("span",lt,i(b.value?"REGU":"INDIVIDU"),1)])):C("",!0)]),t("div",it,[t("button",{class:"btn btn-sm btn-outline-secondary mr-2",disabled:P.value,onClick:K},e[9]||(e[9]=[t("i",{class:"fas fa-sync mr-1"},null,-1),u(" Refresh ")]),8,ot),t("button",{class:"btn btn-sm btn-success",disabled:!G.value||x.value,onClick:O},[t("i",{class:B(["fas mr-1",x.value?"fa-spinner fa-spin":"fa-bullhorn"])},null,2),u(" "+i(x.value?"Publishing...":"Publish Ranking"),1)],8,rt)])])])]),t("section",ut,[t("div",dt,[t("div",ct,[t("div",vt,[t("div",mt,[t("div",pt,[e[12]||(e[12]=t("label",{class:"text-sm mb-1 d-block"},[u(" Pilih Kompetisi "),t("span",{class:"text-danger"},"*")],-1)),X(t("select",{"onUpdate:modelValue":e[0]||(e[0]=n=>f.value=n),class:"form-control form-control-sm",disabled:P.value},[e[10]||(e[10]=t("option",{value:"",disabled:""},"-- Pilih Kompetisi --",-1)),(a(!0),s(c,null,p(D.value,n=>(a(),s("optgroup",{key:n.id,label:n.name},[(a(!0),s(c,null,p(n.competitions,o=>(a(),s("option",{key:o.id,value:String(o.id)},i(o.full_name),9,ht))),128))],8,_t))),128))],8,gt),[[Z,f.value]]),P.value?(a(),s("small",ft,e[11]||(e[11]=[t("i",{class:"fas fa-spinner fa-spin mr-1"},null,-1),u(" Memuat daftar kompetisi... ")]))):C("",!0)]),t("div",bt,[t("button",{class:"btn btn-sm btn-outline-primary w-100",style:{height:"31px"},disabled:!f.value||N.value,onClick:H},e[13]||(e[13]=[t("i",{class:"fas fa-list mr-1"},null,-1),u(" Tampilkan Ranking ")]),8,kt)])])])]),t("div",yt,[t("div",xt,[k.value.length?(a(),s("div",wt,[t("ul",Ct,[t("li",Pt,[t("a",{href:"#",class:B(["nav-link",{active:d.value==="all"}]),onClick:e[1]||(e[1]=T(n=>d.value="all",["prevent"]))}," All ",2)]),t("li",Rt,[t("a",{href:"#",class:B(["nav-link",{active:d.value==="putra"}]),onClick:e[2]||(e[2]=T(n=>d.value="putra",["prevent"]))}," Putra ",2)]),t("li",St,[t("a",{href:"#",class:B(["nav-link",{active:d.value==="putri"}]),onClick:e[3]||(e[3]=T(n=>d.value="putri",["prevent"]))}," Putri ",2)])])])):C("",!0),t("table",Bt,[t("thead",Nt,[b.value?(a(),s("tr",Ft,e[14]||(e[14]=[t("th",{style:{width:"60px"},class:"text-center"},"Rank",-1),t("th",null,"Kontingen",-1),t("th",{class:"text-center",style:{width:"120px"}},"Jumlah Anggota",-1),t("th",{class:"text-center",style:{width:"140px"}},"Final Score",-1)]))):(a(),s("tr",Mt,e[15]||(e[15]=[t("th",{style:{width:"60px"},class:"text-center"},"Rank",-1),t("th",null,"Peserta",-1),t("th",null,"Kontingen",-1),t("th",{class:"text-center",style:{width:"140px"}},"Final Score",-1)])))]),t("tbody",null,[N.value?(a(),s("tr",It,[t("td",{colspan:(b.value,4),class:"text-center p-3 text-muted"},e[16]||(e[16]=[t("i",{class:"fas fa-spinner fa-spin mr-1"},null,-1),u(" Memuat ranking... ")]),8,Lt)])):f.value?k.value.length===0?(a(),s("tr",Dt,[t("td",{colspan:(b.value,4),class:"text-center p-3 text-muted"}," Ranking belum tersedia. ",8,Gt)])):b.value?(a(!0),s(c,{key:3},p(I.value,n=>(a(),s("tr",{key:n.group_key},[t("td",$t,i(n.rank),1),t("td",null,[t("div",Kt,i(n.contingent),1),t("ul",Vt,[(a(!0),s(c,null,p(n.members,o=>(a(),s("li",{key:o.event_participant_id},i(o.full_name),1))),128))])]),t("td",Et,i(n.member_count),1),t("td",Ut,i(R(n.final_score)),1)]))),128)):(a(!0),s(c,{key:4},p(I.value,n=>{var o;return a(),s("tr",{key:n.event_participant_id},[t("td",jt,i(n.rank),1),t("td",null,[t("div",Jt,i(n.full_name),1),t("div",zt,i((o=n.event_category)==null?void 0:o.full_name),1)]),t("td",null,i(n.contingent||"-"),1),t("td",Ht,i(R(n.final_score)),1)])}),128)):(a(),s("tr",Tt,[t("td",{colspan:(b.value,4),class:"text-center p-3 text-muted"}," Silakan pilih kompetisi terlebih dahulu. ",8,At)]))])])]),t("div",Ot,[u(" Total "+i(b.value?"kontingen":"peserta")+": ",1),t("strong",null,i(I.value.length),1)])]),v.value&&!G.value?(a(),s("div",Yt,e[17]||(e[17]=[t("i",{class:"fas fa-info-circle mr-1"},null,-1),u(" Ranking hanya dapat dipublish pada "),t("strong",null,"babak FINAL",-1),u(". ")]))):C("",!0),m.value&&d.value!=="all"?(a(),s("div",qt,e[18]||(e[18]=[t("div",{class:"card-body py-2 text-sm text-muted"},[t("strong",null,"Aturan Penentuan Peringkat (Tie Break):"),t("ol",{class:"mb-0 pl-3"},[t("li",null,[u(" Peringkat ditentukan berdasarkan "),t("strong",null,"Final Score"),u(" tertinggi. ")]),t("li",null,[u(" Jika Final Score sama, maka dibandingkan "),t("strong",null,"rata-rata nilai per bidang"),u(", dimulai dari bidang pertama sesuai urutan penilaian. ")]),t("li",null,[u(" Jika seluruh nilai bidang masih sama, maka urutan ditentukan secara "),t("strong",null,"stabil"),u(" berdasarkan nama peserta / kontingen. ")])])],-1)]))):C("",!0),m.value&&d.value!=="all"?(a(),s("div",Qt,[t("div",Wt,[t("strong",null," Detail Nilai â€“ "+i(d.value.toUpperCase()),1)]),M.value?(a(),s("div",Xt,e[19]||(e[19]=[t("i",{class:"fas fa-spinner fa-spin mr-1"},null,-1),u(" Memuat detail nilai... ")]))):(a(),s("div",Zt,[t("table",te,[t("thead",ee,[t("tr",null,[e[20]||(e[20]=t("th",{rowspan:"2",class:"text-center",style:{width:"50px"}},"#",-1)),e[21]||(e[21]=t("th",{rowspan:"2"},"Kontingen",-1)),e[22]||(e[22]=t("th",{rowspan:"2"},"Peserta",-1)),(a(!0),s(c,null,p(m.value.fields,n=>(a(),s("th",{key:"f-head-"+n.id,colspan:L(n.id).length+1,class:"text-center"},i(n.name),9,ne))),128)),e[23]||(e[23]=t("th",{rowspan:"2",class:"text-center",style:{width:"120px"}}," Final Score ",-1))]),t("tr",null,[(a(!0),s(c,null,p(m.value.fields,n=>(a(),s(c,{key:"f-sub-"+n.id},[(a(!0),s(c,null,p(L(n.id),(o,r)=>(a(),s("th",{key:"j-"+n.id+"-"+o.id,class:"text-center",style:{width:"70px"}}," H"+i(r+1),1))),128)),e[24]||(e[24]=t("th",{class:"text-center",style:{width:"80px"}}," Avg ",-1))],64))),128))])]),t("tbody",null,[(a(!0),s(c,null,p(m.value.rows,(n,o)=>(a(),s("tr",{key:b.value?n.contingent:n.event_participant_id},[t("td",se,i(o+1),1),t("td",null,[t("div",ae,i(n.contingent),1)]),b.value?(a(),s("td",oe,[t("div",re,i(n.contingent),1),t("ul",ue,[(a(!0),s(c,null,p(n.members,r=>(a(),s("li",{key:r.id},i(r.full_name),1))),128))])])):(a(),s("td",le,[t("div",ie,i(n.full_name),1)])),(a(!0),s(c,null,p(m.value.fields,r=>{var g;return a(),s(c,{key:"f-row-"+r.id},[(a(!0),s(c,null,p(L(r.id),_=>{var w,V,E;return a(),s("td",{key:"cell-"+r.id+"-"+_.id,class:"text-center"},[(E=(V=(w=n.scores)==null?void 0:w[r.id])==null?void 0:V[_.id])!=null&&E.length?(a(),s("span",de,i(R(n.scores[r.id][_.id].reduce((Y,q)=>Y+q,0)/n.scores[r.id][_.id].length)),1)):(a(),s("span",ce,"-"))])}),128)),t("td",ve,i(R((g=n.field_avg)==null?void 0:g[r.id])),1)],64)}),128)),t("td",me,i(R(n.final_score)),1)]))),128))])]),e[25]||(e[25]=t("small",{class:"text-muted d-block mt-2 px-2"},[u(" * Nilai bidang = rata-rata nilai hakim pada bidang tersebut."),t("br"),u(" * Final Score = jumlah seluruh rata-rata bidang. ")],-1))]))])):C("",!0)])])],64))}},be=tt(pe,[["__scopeId","data-v-6d98b6dd"]]);export{be as default};
