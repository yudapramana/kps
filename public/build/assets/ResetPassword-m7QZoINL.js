import{X as I,A as w,B as r,V as D,ad as N,C as d,M as O,y as Q,a1 as G,Q as _,D as e,R as A,_ as S,F as K,S as R,as as q,G as L,P as X,L as J,I as M,J as j,K as E,a as F}from"./AuthUserStore-67h2FHdL.js";import{_ as H}from"./app-CZBZEz52.js";const Y={key:1,style:{"min-height":"48px"},"aria-hidden":"true"},W=I({__name:"TurnstileWidget",props:{sitekey:{type:String,required:!0},modelValue:String,disableAutoReload:{type:Boolean,default:!1},theme:{type:String,default:"light"},size:{type:String,default:"normal"}},emits:["update:modelValue","error","expired"],setup(T,{expose:V,emit:P}){const u=T,p=P,y=w(null);let a=null;const n=typeof window<"u",c=w(!1),f=()=>new Promise((i,k)=>{if(!n)return k();if(window.turnstile||document.querySelector("#cf-turnstile"))return i();const l=document.createElement("script");l.id="cf-turnstile",l.src="https://challenges.cloudflare.com/turnstile/v0/api.js?render=explicit",l.async=!0,l.defer=!0,l.onload=()=>i(),l.onerror=()=>k(),document.head.appendChild(l)}),b=()=>{!n||!window.turnstile||!y.value||(a=window.turnstile.render(y.value,{sitekey:u.sitekey,theme:u.theme,size:u.size,callback:i=>p("update:modelValue",i),"expired-callback":()=>{p("update:modelValue",""),p("expired"),u.disableAutoReload||o()},"error-callback":()=>{p("error"),u.disableAutoReload||o()}}))},o=()=>{if(n&&window.turnstile&&a)try{window.turnstile.reset(a)}catch(i){console.warn("[TurnstileWidget] Reset failed:",i)}};return V({reset:o,execute:()=>{if(n&&window.turnstile&&a)try{window.turnstile.execute(a)}catch(i){console.warn("[TurnstileWidget] Execute failed:",i)}}}),D(()=>{c.value=!0,f().then(()=>b()).catch(()=>{p("error"),u.disableAutoReload||o()})}),N(()=>{if(n&&window.turnstile&&a)try{window.turnstile.remove(a)}catch(i){console.warn("[TurnstileWidget] Cleanup failed:",i)}}),(i,k)=>c.value?(d(),r("div",{key:0,ref_key:"containerRef",ref:y},null,512)):(d(),r("div",Y))}}),Z={class:"login-page"},$={key:0,class:"loading-overlay"},ee={class:"login-box"},se={class:"card card-outline card-success"},te={class:"card-body login-card-body"},ae={key:0,class:"login-box-msg"},oe={key:1,class:"login-box-msg"},le={key:0,class:"alert alert-danger",role:"alert"},ne={key:0,class:"alert alert-success",role:"alert"},ie={class:"input-group mb-3"},re={class:"text-center row justify-content-center"},de={class:"form-group recaptcha-container mx-auto"},ue={class:"row mb-3"},pe={class:"col-12"},ce=["disabled"],me={class:"text-center"},ve={class:"input-group mb-3"},fe={class:"input-group mb-3"},ge={class:"input-group mb-3"},we={class:"text-center row justify-content-center"},_e={class:"form-group recaptcha-container mx-auto"},ye={class:"row mb-3"},be={class:"col-12"},ke=["disabled"],he={class:"text-center"},z="0x4AAAAAABg5q-5b8cUPKPGt",xe={__name:"ResetPassword",setup(T){const V=O(),P=J(),u=w(V.query.token||""),p=w(V.query.email||""),y=Q(()=>u.value?"reset":"request"),a=w(""),n=w(!1),c=w(""),f=w(""),b=G({email:""}),o=G({email:p.value||"",password:"",password_confirmation:""});D(()=>{p.value&&!o.email&&(o.email=p.value)});const i=async()=>{var l,s,g,t,h,x;n.value=!0,c.value="",f.value="";try{await F.post("/forgot-password",{email:b.email,"cf-turnstile-response":a.value}),c.value="Link reset password sudah dikirim ke email Anda (cek juga folder Spam)."}catch(m){f.value=((s=(l=m==null?void 0:m.response)==null?void 0:l.data)==null?void 0:s.message)||((x=(h=(t=(g=m==null?void 0:m.response)==null?void 0:g.data)==null?void 0:t.errors)==null?void 0:h.email)==null?void 0:x[0])||"Gagal mengirim link reset. Pastikan email benar."}finally{n.value=!1}},k=async()=>{var l,s,g,t,h,x,m,U,B,C;n.value=!0,c.value="",f.value="";try{await F.post("/reset-password",{token:u.value,email:o.email,password:o.password,password_confirmation:o.password_confirmation,"cf-turnstile-response":a.value}),c.value="Password berhasil direset. Anda akan diarahkan ke halaman login...",setTimeout(()=>{P.push({path:"/"})},1500)}catch(v){f.value=((s=(l=v==null?void 0:v.response)==null?void 0:l.data)==null?void 0:s.message)||((x=(h=(t=(g=v==null?void 0:v.response)==null?void 0:g.data)==null?void 0:t.errors)==null?void 0:h.email)==null?void 0:x[0])||((C=(B=(U=(m=v==null?void 0:v.response)==null?void 0:m.data)==null?void 0:U.errors)==null?void 0:B.password)==null?void 0:C[0])||"Gagal reset password. Periksa kembali data Anda."}finally{n.value=!1}};return(l,s)=>{const g=X("router-link");return d(),r("div",Z,[_(S,{name:"fade"},{default:A(()=>[n.value?(d(),r("div",$,s[6]||(s[6]=[e("div",{class:"spinner"},null,-1),e("p",null,"Memproses...",-1)]))):M("",!0)]),_:1}),e("div",ee,[s[13]||(s[13]=e("div",{class:"login-logo"},[e("img",{src:"http://res.cloudinary.com/dezj1x6xp/image/upload/v1749880420/PandanViewMandeh/LOGO_SIGARDA_FIX_rw2u1g.png",alt:"logo",width:"100%"})],-1)),e("div",se,[e("div",te,[y.value==="request"?(d(),r("p",ae," Masukkan email Anda untuk menerima link reset password ")):(d(),r("p",oe," Atur password baru Anda ")),_(S,{name:"fade"},{default:A(()=>[f.value?(d(),r("div",le,j(f.value),1)):M("",!0)]),_:1}),_(S,{name:"fade"},{default:A(()=>[c.value?(d(),r("div",ne,j(c.value),1)):M("",!0)]),_:1}),y.value==="request"?(d(),r("form",{key:2,onSubmit:K(i,["prevent"]),autocomplete:"off"},[e("div",ie,[R(e("input",{"onUpdate:modelValue":s[0]||(s[0]=t=>b.email=t),type:"email",class:"form-control",placeholder:"Email Anda",required:""},null,512),[[q,b.email]]),s[7]||(s[7]=e("div",{class:"input-group-append"},[e("div",{class:"input-group-text"},[e("span",{class:"fas fa-envelope"})])],-1))]),e("div",re,[e("div",de,[_(L(W),{modelValue:a.value,"onUpdate:modelValue":s[1]||(s[1]=t=>a.value=t),sitekey:z,theme:"light"},null,8,["modelValue"])])]),e("div",ue,[e("div",pe,[e("button",{type:"submit",class:"btn btn-primary btn-block",disabled:n.value||!a.value}," Kirim Link Reset ",8,ce)])]),e("div",me,[_(g,{to:{path:"/login"}},{default:A(()=>s[8]||(s[8]=[E("Kembali ke Login")])),_:1})])],32)):(d(),r("form",{key:3,onSubmit:K(k,["prevent"]),autocomplete:"off"},[e("div",ve,[R(e("input",{"onUpdate:modelValue":s[2]||(s[2]=t=>o.email=t),type:"email",class:"form-control",placeholder:"Email",required:""},null,512),[[q,o.email]]),s[9]||(s[9]=e("div",{class:"input-group-append"},[e("div",{class:"input-group-text"},[e("span",{class:"fas fa-envelope"})])],-1))]),e("div",fe,[R(e("input",{"onUpdate:modelValue":s[3]||(s[3]=t=>o.password=t),type:"password",class:"form-control",placeholder:"Password baru",minlength:"8",required:""},null,512),[[q,o.password]]),s[10]||(s[10]=e("div",{class:"input-group-append"},[e("div",{class:"input-group-text"},[e("span",{class:"fas fa-lock"})])],-1))]),e("div",ge,[R(e("input",{"onUpdate:modelValue":s[4]||(s[4]=t=>o.password_confirmation=t),type:"password",class:"form-control",placeholder:"Ulangi password baru",minlength:"8",required:""},null,512),[[q,o.password_confirmation]]),s[11]||(s[11]=e("div",{class:"input-group-append"},[e("div",{class:"input-group-text"},[e("span",{class:"fas fa-lock"})])],-1))]),e("div",we,[e("div",_e,[_(L(W),{modelValue:a.value,"onUpdate:modelValue":s[5]||(s[5]=t=>a.value=t),sitekey:z,theme:"light"},null,8,["modelValue"])])]),e("div",ye,[e("div",be,[e("button",{type:"submit",class:"btn btn-primary btn-block",disabled:n.value||!a.value}," Simpan Password Baru ",8,ke)])]),e("div",he,[_(g,{to:{path:"/"}},{default:A(()=>s[12]||(s[12]=[E("Kembali ke Login")])),_:1})])],32))])])])])}}},Re=H(xe,[["__scopeId","data-v-bf451f83"]]);export{Re as default};
