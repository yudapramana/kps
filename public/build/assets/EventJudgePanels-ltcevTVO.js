import{z as q,y as E,A as g,O as k,V as Q,B as n,C as i,D as e,I as y,K as p,S as x,aB as R,as as H,U as _,ay as b,J as r,H as C,F as P,aA as W,a as h,aC as J}from"./AuthUserStore-67h2FHdL.js";import{S as m}from"./sweetalert2.esm.all-9Qm2jZ7z.js";import{_ as X}from"./app-CZBZEz52.js";const Y={class:"content-header"},Z={class:"container-fluid"},ee={key:0,class:"text-danger text-sm mt-2 mb-0"},te={class:"content"},se={class:"container-fluid"},ae={class:"card"},le={class:"card-header"},ne={class:"d-flex flex-wrap justify-content-between align-items-center w-100"},ie={class:"d-flex flex-wrap align-items-center"},oe={class:"d-flex align-items-center mt-2 mt-sm-0"},de={class:"card-body table-responsive p-0"},ue={class:"table table-bordered table-hover text-sm mb-0"},re={key:0},ce={key:1},me={class:"text-center"},ve={class:"text-xs text-muted"},ge={class:"text-xs text-muted"},pe={key:0},_e={key:0,class:"fas fa-gavel mr-1"},he={key:1,class:"fas fa-user mr-1"},be={key:2,class:"ml-1"},fe={key:1,class:"text-muted text-xs"},ke={class:"text-center"},ye={class:"text-center"},xe={class:"btn-group btn-group-sm"},Ce=["disabled","onClick"],we=["onClick"],je={class:"card-footer clearfix py-2"},Ge={class:"d-flex justify-content-between align-items-center"},Me={class:"text-muted text-sm"},Se={class:"pagination pagination-sm m-0"},$e={class:"page-item disabled"},He={class:"page-link"},Je={class:"modal fade",id:"branchJudgesModal",tabindex:"-1",role:"dialog","aria-hidden":"true"},Oe={class:"modal-dialog modal-lg",role:"document"},Be={class:"modal-content"},Ue={class:"modal-header"},De={class:"modal-title"},Ve={class:"modal-body"},Ee={class:"form-group"},Pe={key:0,class:"border rounded mt-2 p-2",style:{"max-height":"220px",overflow:"auto"}},Te={class:"text-sm"},Ae=["onClick"],Ke={key:0,class:"text-muted text-sm"},Fe={key:1,class:"table-responsive"},Ie={class:"table table-sm table-bordered mb-0"},Ne={class:"text-center"},Le=["checked","onChange"],ze={class:"text-center"},qe=["onClick"],Qe={class:"modal-footer"},Re=["disabled"],We={class:"modal fade",id:"groupJudgesModal",tabindex:"-1",role:"dialog","aria-hidden":"true"},Xe={class:"modal-dialog modal-lg",role:"document"},Ye={class:"modal-content"},Ze={class:"modal-header"},et={class:"modal-title"},tt={class:"modal-body"},st={class:"d-flex justify-content-between align-items-center mb-2"},at={class:"custom-control custom-switch"},lt={key:0,class:"alert alert-light border text-sm mb-0"},nt={key:1},it={class:"form-group"},ot={key:0,class:"border rounded mt-2 p-2",style:{"max-height":"220px",overflow:"auto"}},dt={class:"text-sm"},ut=["onClick"],rt={key:0,class:"text-muted text-sm"},ct={key:1,class:"table-responsive"},mt={class:"table table-sm table-bordered mb-0"},vt={class:"text-center"},gt=["checked","onChange"],pt={class:"text-center"},_t=["onClick"],ht={class:"modal-footer"},bt=["disabled"],ft={__name:"EventJudgePanels",setup(kt){const T=q(),A=E(()=>T.eventData||null),f=E(()=>{var a;return((a=A.value)==null?void 0:a.id)||null}),M=g([]),w=g(""),j=g(10),S=g(!1),u=g({current_page:1,per_page:10,total:0,from:0,to:0,last_page:1}),K=a=>a+1+(u.value.current_page-1)*u.value.per_page,v=async(a=1)=>{if(f.value){S.value=!0;try{const s=(await h.get(`/api/v1/events/${f.value}/judge-panels`,{params:{page:a,per_page:j.value,search:w.value}})).data;M.value=s.data||[],u.value={current_page:s.current_page,per_page:s.per_page,total:s.total,from:s.from,to:s.to,last_page:s.last_page}}catch(t){console.error(t),m.fire("Gagal","Gagal memuat data majelis hakim.","error")}finally{S.value=!1}}},O=a=>{a<1||a>u.value.last_page||v(a)},B=async a=>{var s;const t=(a||"").trim();if(t.length<2)return[];try{const d=await h.get("/api/v1/users",{params:{search:t,role:"JUDGE",per_page:10}}),c=((s=d.data)==null?void 0:s.data)||d.data||[];return Array.isArray(c)?c:c.data||[]}catch{return[]}},G=()=>({title:"",id:null,saving:!1,userSearch:"",userOptions:[],selected:[],use_custom_judges:!1}),o=g(G()),l=g(G()),U=(a,t)=>{a.selected.some(d=>d.user_id===t.id)||a.selected.push({user_id:t.id,name:t.name,is_chief:!1})},D=(a,t)=>{a.selected=a.selected.filter(s=>s.user_id!==t)},V=(a,t)=>{a.selected=a.selected.map(s=>({...s,is_chief:s.user_id===t}))},F=async a=>{var t;if(a.event_branch_id){o.value=G(),o.value.id=a.event_branch_id,o.value.title=a.branch_name;try{const s=await h.get(`/api/v1/event-branches/${a.event_branch_id}/judges`);o.value.selected=(((t=s.data)==null?void 0:t.judges)||[]).map(d=>({user_id:d.id,name:d.name,is_chief:!!d.is_chief})),$("#branchJudgesModal").modal("show")}catch{m.fire("Gagal","Gagal memuat hakim cabang.","error")}}},I=async()=>{var a,t;if(o.value.id){if(o.value.selected.length===0){m.fire("Validasi","Pilih minimal 1 hakim.","warning");return}o.value.saving=!0;try{await h.put(`/api/v1/event-branches/${o.value.id}/judges`,{judges:o.value.selected.map(s=>({user_id:s.user_id,is_chief:s.is_chief}))}),$("#branchJudgesModal").modal("hide"),m.fire("Berhasil","Hakim cabang disimpan.","success"),v(u.value.current_page||1)}catch(s){m.fire("Gagal",((t=(a=s==null?void 0:s.response)==null?void 0:a.data)==null?void 0:t.message)||"Gagal menyimpan hakim cabang.","error")}finally{o.value.saving=!1}}},N=async a=>{var t,s;l.value=G(),l.value.id=a.id,l.value.title=a.full_name,l.value.use_custom_judges=!!a.use_custom_judges;try{const d=await h.get(`/api/v1/event-groups/${a.id}/judges`);l.value.use_custom_judges=!!((t=d.data)!=null&&t.use_custom_judges),l.value.selected=(((s=d.data)==null?void 0:s.judges)||[]).map(c=>({user_id:c.id,name:c.name,is_chief:!!c.is_chief})),$("#groupJudgesModal").modal("show")}catch{m.fire("Gagal","Gagal memuat hakim golongan.","error")}},L=async()=>{var a,t;if(l.value.id)try{await h.patch(`/api/v1/event-groups/${l.value.id}/use-custom-judges`,{use_custom_judges:!!l.value.use_custom_judges}),v(u.value.current_page||1)}catch(s){m.fire("Gagal",((t=(a=s==null?void 0:s.response)==null?void 0:a.data)==null?void 0:t.message)||"Gagal menyimpan pengaturan.","error")}},z=async()=>{var a,t;if(l.value.id&&l.value.use_custom_judges){if(l.value.selected.length===0){m.fire("Validasi","Pilih minimal 1 hakim untuk override.","warning");return}l.value.saving=!0;try{await h.put(`/api/v1/event-groups/${l.value.id}/judges`,{judges:l.value.selected.map(s=>({user_id:s.user_id,is_chief:s.is_chief}))}),$("#groupJudgesModal").modal("hide"),m.fire("Berhasil","Hakim golongan disimpan.","success"),v(u.value.current_page||1)}catch(s){m.fire("Gagal",((t=(a=s==null?void 0:s.response)==null?void 0:a.data)==null?void 0:t.message)||"Gagal menyimpan hakim golongan.","error")}finally{l.value.saving=!1}}};return k(()=>o.value.userSearch,J(async a=>{o.value.userOptions=await B(a)},300)),k(()=>l.value.userSearch,J(async a=>{l.value.userOptions=await B(a)},300)),k(()=>w.value,J(()=>v(1),400)),k(()=>j.value,()=>v(1)),k(()=>f.value,a=>{a&&v(1)}),Q(()=>{f.value?v(1):m.fire("Event belum dipilih","Silakan pilih event melalui Portal Event terlebih dahulu.","info")}),(a,t)=>(i(),n(_,null,[e("section",Y,[e("div",Z,[t[8]||(t[8]=e("div",{class:"d-flex justify-content-between align-items-center"},[e("div",null,[e("h1",{class:"mb-1"},"Majelis Hakim (Cabang / Golongan)"),e("p",{class:"mb-0 text-muted text-sm"}," Kelola hakim default per cabang dan override per golongan dalam satu tempat. ")])],-1)),f.value?y("",!0):(i(),n("p",ee,t[7]||(t[7]=[e("i",{class:"fas fa-exclamation-triangle mr-1"},null,-1),p(" Event belum dipilih. Silakan pilih event melalui Portal Event terlebih dahulu. ")])))])]),e("section",te,[e("div",se,[e("div",ae,[e("div",le,[e("div",ne,[e("div",ie,[t[10]||(t[10]=e("label",{class:"mb-0 mr-1 text-sm text-muted"},"Tampilkan",-1)),x(e("select",{"onUpdate:modelValue":t[0]||(t[0]=s=>j.value=s),class:"form-control form-control-sm w-auto mr-2"},t[9]||(t[9]=[e("option",{value:10},"10",-1),e("option",{value:25},"25",-1),e("option",{value:50},"50",-1),e("option",{value:100},"100",-1)]),512),[[R,j.value,void 0,{number:!0}]]),t[11]||(t[11]=e("label",{class:"mb-0 text-sm text-muted mr-3"},"Entri",-1))]),e("div",oe,[x(e("input",{"onUpdate:modelValue":t[1]||(t[1]=s=>w.value=s),type:"text",class:"form-control form-control-sm w-auto",style:{"min-width":"280px"},placeholder:"Cari cabang / golongan..."},null,512),[[H,w.value]])])])]),e("div",de,[e("table",ue,[t[16]||(t[16]=e("thead",{class:"thead-light"},[e("tr",null,[e("th",{style:{width:"50px"}},"#"),e("th",null,"Cabang / Golongan"),e("th",{style:{width:"380px"}},"Majelis Hakim"),e("th",{style:{width:"170px"},class:"text-center"},"Mode"),e("th",{style:{width:"160px"},class:"text-center"},"Aksi")])],-1)),e("tbody",null,[S.value?(i(),n("tr",re,t[12]||(t[12]=[e("td",{colspan:"5",class:"text-center py-4"},"Memuat data majelis hakim...",-1)]))):M.value.length===0?(i(),n("tr",ce,t[13]||(t[13]=[e("td",{colspan:"5",class:"text-center py-4"}," Belum ada data golongan untuk event ini. ",-1)]))):y("",!0),(i(!0),n(_,null,b(M.value,(s,d)=>(i(),n("tr",{key:s.id},[e("td",me,r(K(d)),1),e("td",null,[e("div",null,[e("strong",null,r(s.branch_name),1)]),e("div",ve,r(s.group_name),1),e("div",ge,r(s.full_name),1)]),e("td",null,[(s.effective_judges||[]).length?(i(),n("div",pe,[(i(!0),n(_,null,b(s.effective_judges,(c,yt)=>(i(),n("div",{key:c.id,class:"mb-1"},[e("span",{class:C(["badge border",c.is_chief?"badge-warning":"badge-light"])},[c.is_chief?(i(),n("i",_e)):(i(),n("i",he)),p(" "+r(c.name)+" ",1),c.is_chief?(i(),n("span",be,"(Ketua)")):y("",!0)],2)]))),128))])):(i(),n("span",fe," Belum ada hakim. "))]),e("td",ke,[e("span",{class:C(["badge",s.use_custom_judges?"badge-warning":"badge-success"])},[e("i",{class:C(s.use_custom_judges?"fas fa-random mr-1":"fas fa-layer-group mr-1")},null,2),p(" "+r(s.use_custom_judges?"CUSTOM (Golongan)":"DEFAULT (Cabang)"),1)],2)]),e("td",ye,[e("div",xe,[e("button",{class:"btn btn-outline-primary btn-xs",title:"Kelola Hakim Cabang (Default)",disabled:!s.event_branch_id,onClick:c=>F(s)},t[14]||(t[14]=[e("i",{class:"fas fa-sitemap"},null,-1)]),8,Ce),e("button",{class:"btn btn-outline-warning btn-xs",title:"Kelola Hakim Golongan (Override)",onClick:c=>N(s)},t[15]||(t[15]=[e("i",{class:"fas fa-users-cog"},null,-1)]),8,we)])])]))),128))])])]),e("div",je,[e("div",Ge,[e("div",Me," Menampilkan "+r(u.value.from||0)+" - "+r(u.value.to||0)+" dari "+r(u.value.total||0)+" data ",1),e("ul",Se,[e("li",{class:C(["page-item",{disabled:u.value.current_page===1}])},[e("a",{href:"#",class:"page-link",onClick:t[2]||(t[2]=P(s=>O(u.value.current_page-1),["prevent"]))},"«")],2),e("li",$e,[e("span",He,"Halaman "+r(u.value.current_page)+" / "+r(u.value.last_page||1),1)]),e("li",{class:C(["page-item",{disabled:u.value.current_page===u.value.last_page}])},[e("a",{href:"#",class:"page-link",onClick:t[3]||(t[3]=P(s=>O(u.value.current_page+1),["prevent"]))},"»")],2)])])])])]),e("div",Je,[e("div",Oe,[e("div",Be,[e("div",Ue,[e("h5",De," Hakim Cabang (Default) — "+r(o.value.title),1),t[17]||(t[17]=e("button",{type:"button",class:"close","data-dismiss":"modal"},[e("span",null,"×")],-1))]),e("div",Ve,[e("div",Ee,[t[19]||(t[19]=e("label",{class:"text-sm text-muted mb-1"},"Cari Hakim",-1)),x(e("input",{"onUpdate:modelValue":t[4]||(t[4]=s=>o.value.userSearch=s),class:"form-control form-control-sm",placeholder:"Ketik nama..."},null,512),[[H,o.value.userSearch]]),o.value.userOptions.length?(i(),n("div",Pe,[(i(!0),n(_,null,b(o.value.userOptions,s=>(i(),n("div",{key:s.id,class:"d-flex align-items-center justify-content-between py-1"},[e("div",null,[e("strong",Te,r(s.name),1)]),e("button",{class:"btn btn-sm btn-outline-primary",onClick:d=>U(o.value,s)},t[18]||(t[18]=[e("i",{class:"fas fa-plus mr-1"},null,-1),p(" Tambah ")]),8,Ae)]))),128))])):y("",!0)]),t[23]||(t[23]=e("hr",{class:"my-2"},null,-1)),e("div",null,[t[22]||(t[22]=e("div",{class:"d-flex justify-content-between align-items-center mb-2"},[e("strong",null,"Daftar Hakim Cabang"),e("small",{class:"text-muted"},"Pilih 1 ketua majelis (opsional)")],-1)),o.value.selected.length===0?(i(),n("div",Ke," Belum ada hakim dipilih. ")):(i(),n("div",Fe,[e("table",Ie,[t[21]||(t[21]=e("thead",{class:"thead-light"},[e("tr",null,[e("th",null,"Hakim"),e("th",{style:{width:"140px"},class:"text-center"},"Ketua"),e("th",{style:{width:"90px"},class:"text-center"},"Aksi")])],-1)),e("tbody",null,[(i(!0),n(_,null,b(o.value.selected,s=>(i(),n("tr",{key:s.user_id},[e("td",null,[e("strong",null,r(s.name),1)]),e("td",Ne,[e("input",{type:"radio",name:"branchChief",checked:s.is_chief,onChange:d=>V(o.value,s.user_id)},null,40,Le)]),e("td",ze,[e("button",{class:"btn btn-xs btn-outline-danger",onClick:d=>D(o.value,s.user_id)},t[20]||(t[20]=[e("i",{class:"fas fa-times"},null,-1)]),8,qe)])]))),128))])])]))])]),e("div",Qe,[t[25]||(t[25]=e("button",{class:"btn btn-sm btn-secondary","data-dismiss":"modal"},"Tutup",-1)),e("button",{class:"btn btn-sm btn-primary",disabled:o.value.saving,onClick:I},t[24]||(t[24]=[e("i",{class:"fas fa-save mr-1"},null,-1),p(" Simpan ")]),8,Re)])])])]),e("div",We,[e("div",Xe,[e("div",Ye,[e("div",Ze,[e("h5",et," Hakim Golongan (Override) — "+r(l.value.title),1),t[26]||(t[26]=e("button",{type:"button",class:"close","data-dismiss":"modal"},[e("span",null,"×")],-1))]),e("div",tt,[e("div",st,[t[28]||(t[28]=e("div",null,[e("strong",null,"Override untuk golongan ini"),e("div",{class:"text-xs text-muted"},"Jika OFF, sistem memakai default cabang.")],-1)),e("div",at,[x(e("input",{type:"checkbox",class:"custom-control-input",id:"toggleCustom","onUpdate:modelValue":t[5]||(t[5]=s=>l.value.use_custom_judges=s),onChange:L},null,544),[[W,l.value.use_custom_judges]]),t[27]||(t[27]=e("label",{class:"custom-control-label",for:"toggleCustom"}," Gunakan hakim khusus ",-1))])]),l.value.use_custom_judges?(i(),n("div",nt,[e("div",it,[t[30]||(t[30]=e("label",{class:"text-sm text-muted mb-1"},"Cari Hakim",-1)),x(e("input",{"onUpdate:modelValue":t[6]||(t[6]=s=>l.value.userSearch=s),class:"form-control form-control-sm",placeholder:"Ketik nama..."},null,512),[[H,l.value.userSearch]]),l.value.userOptions.length?(i(),n("div",ot,[(i(!0),n(_,null,b(l.value.userOptions,s=>(i(),n("div",{key:s.id,class:"d-flex align-items-center justify-content-between py-1"},[e("div",null,[e("strong",dt,r(s.name),1)]),e("button",{class:"btn btn-sm btn-outline-primary",onClick:d=>U(l.value,s)},t[29]||(t[29]=[e("i",{class:"fas fa-plus mr-1"},null,-1),p(" Tambah ")]),8,ut)]))),128))])):y("",!0)]),t[34]||(t[34]=e("hr",{class:"my-2"},null,-1)),e("div",null,[t[33]||(t[33]=e("div",{class:"d-flex justify-content-between align-items-center mb-2"},[e("strong",null,"Daftar Hakim Golongan"),e("small",{class:"text-muted"},"Pilih 1 ketua majelis (opsional)")],-1)),l.value.selected.length===0?(i(),n("div",rt," Belum ada hakim dipilih. ")):(i(),n("div",ct,[e("table",mt,[t[32]||(t[32]=e("thead",{class:"thead-light"},[e("tr",null,[e("th",null,"Hakim"),e("th",{style:{width:"140px"},class:"text-center"},"Ketua"),e("th",{style:{width:"90px"},class:"text-center"},"Aksi")])],-1)),e("tbody",null,[(i(!0),n(_,null,b(l.value.selected,s=>(i(),n("tr",{key:s.user_id},[e("td",null,[e("strong",null,r(s.name),1)]),e("td",vt,[e("input",{type:"radio",name:"groupChief",checked:s.is_chief,onChange:d=>V(l.value,s.user_id)},null,40,gt)]),e("td",pt,[e("button",{class:"btn btn-xs btn-outline-danger",onClick:d=>D(l.value,s.user_id)},t[31]||(t[31]=[e("i",{class:"fas fa-times"},null,-1)]),8,_t)])]))),128))])])]))])])):(i(),n("div",lt," Override dimatikan. Untuk mengubah majelis, aktifkan toggle di atas. "))]),e("div",ht,[t[36]||(t[36]=e("button",{class:"btn btn-sm btn-secondary","data-dismiss":"modal"},"Tutup",-1)),e("button",{class:"btn btn-sm btn-warning",disabled:l.value.saving||!l.value.use_custom_judges,onClick:z},t[35]||(t[35]=[e("i",{class:"fas fa-save mr-1"},null,-1),p(" Simpan Override ")]),8,bt)])])])])])],64))}},jt=X(ft,[["__scopeId","data-v-62d54e97"]]);export{jt as default};
