import{z as Z,y as S,M as ee,A as c,O as K,V as te,B as n,C as o,D as e,I as b,K as u,J as r,S as p,aB as k,as as N,U as h,ay as M,H as P,F,a as f,aC as ae}from"./AuthUserStore-67h2FHdL.js";import{S as m}from"./sweetalert2.esm.all-9Qm2jZ7z.js";const se={class:"content-header"},le={class:"container-fluid"},ne={class:"d-flex justify-content-between align-items-center"},oe={key:0,class:"mb-0 mt-1 text-sm text-muted"},re={key:0},ie={key:1},ue={class:"d-flex flex-column flex-sm-row gap-2"},de=["disabled"],me={key:0,class:"fas fa-spinner fa-spin mr-1"},ve={key:1,class:"fas fa-magic mr-1"},ce=["disabled"],ge={key:0,class:"text-danger text-sm mt-2 mb-0"},pe={class:"content"},be={class:"container-fluid"},fe={class:"card"},_e={class:"card-header"},ye={class:"d-flex flex-wrap justify-content-between align-items-center w-100"},ke={class:"d-flex align-items-center"},he={class:"card-body table-responsive p-0"},xe={class:"table table-bordered table-hover text-sm mb-0"},Ce={key:0},we={key:1},Ge={class:"text-center"},Be={class:"text-center"},Ee={class:"text-center"},Se={class:"btn-group btn-group-sm"},Ke=["onClick"],Me=["onClick"],Te={class:"card-footer clearfix py-2"},Ue={class:"d-flex justify-content-between align-items-center"},Ve={class:"text-muted text-sm"},De={class:"pagination pagination-sm m-0"},Ne={class:"page-item disabled"},Pe={class:"page-link"},$e={class:"modal fade",id:"eventCategoryModal",tabindex:"-1",role:"dialog","aria-labelledby":"eventCategoryModalLabel"},Fe={class:"modal-dialog modal-lg",role:"document"},Ie={class:"modal-content"},Le={class:"modal-header py-2"},qe={class:"modal-title",id:"eventCategoryModalLabel"},Ae={class:"modal-body pt-2"},He={class:"row"},je={class:"col-md-6"},ze={class:"form-group mb-2"},Je=["value"],Ye={key:0},Oe={class:"form-group mb-2"},Re=["value"],Qe={key:0},We={class:"form-group mb-2"},Xe=["value"],Ze={key:0},et={class:"col-md-6"},tt={class:"form-group mb-2"},at={class:"form-group mb-2"},st={class:"form-group mb-2"},lt={class:"text-right mt-3"},nt=["disabled"],ot={key:0,class:"fas fa-spinner fa-spin mr-1"},rt={key:1,class:"fas fa-save mr-1"},mt={__name:"EventCategories",setup(it){const I=Z(),L=ee(),j=S(()=>I.eventData||null),v=S(()=>{var s;return((s=j.value)==null?void 0:s.id)||null}),_=S(()=>{const s=L.query.branch_id;return s?Number(s):null}),y=S(()=>{const s=L.query.group_id;return s?Number(s):null}),T=c([]),U=c([]),V=c([]),q=c([]),x=c("active"),C=c(""),w=c(10),D=c(!1),G=c(!1),B=c(!1),E=c(!1),d=c({current_page:1,per_page:10,total:0,from:0,to:0,last_page:1}),l=c({id:null,branch_id:"",group_id:"",category_id:"",full_name:"",status:"active",order_number:null}),z=async()=>{try{const[s,t,i]=await Promise.all([f.get("/api/v1/branches",{params:{simple:1}}),f.get("/api/v1/groups",{params:{simple:1}}),f.get("/api/v1/categories",{params:{simple:1}})]);U.value=s.data.data||[],V.value=t.data.data||[],q.value=i.data.data||[]}catch(s){console.error("Gagal memuat branches / groups / categories:",s),m.fire("Gagal","Gagal memuat daftar cabang, golongan, dan kategori.","error")}},g=async(s=1)=>{if(v.value){D.value=!0;try{const i=(await f.get("/api/v1/event-categories",{params:{event_id:v.value,branch_id:_.value||void 0,group_id:y.value||void 0,status:x.value,page:s,per_page:w.value,search:C.value,from_crud:1}})).data.data;T.value=i.data||[],d.value={current_page:i.current_page,per_page:i.per_page,total:i.total,from:i.from,to:i.to,last_page:i.last_page}}catch(t){console.error("Gagal memuat event_categories:",t),t.response&&t.response.status===401?I.logout():m.fire("Gagal","Gagal memuat data event categories.","error")}finally{D.value=!1}}},A=s=>{s<1||s>d.value.last_page||g(s)},J=()=>{if(!v.value){m.fire("Event belum dipilih","Silakan pilih event melalui Portal Event sebelum mengelola kategori.","warning");return}G.value=!1,l.value={id:null,branch_id:_.value||"",group_id:y.value||"",category_id:"",full_name:"",status:"active",order_number:(d.value.total||0)+1},$("#eventCategoryModal").modal("show")},Y=s=>{G.value=!0,l.value={id:s.id,branch_id:s.branch_id,group_id:s.group_id,category_id:s.category_id,full_name:s.full_name,status:s.status,order_number:s.order_number},$("#eventCategoryModal").modal("show")},O=async()=>{if(!v.value){m.fire("Event belum dipilih","Silakan pilih event melalui Portal Event sebelum mengelola kategori.","warning");return}B.value=!0;const s={event_id:v.value,branch_id:l.value.branch_id,group_id:l.value.group_id,category_id:l.value.category_id,full_name:l.value.full_name,status:l.value.status,order_number:l.value.order_number};try{G.value&&l.value.id?(await f.put(`/api/v1/event-categories/${l.value.id}`,s),m.fire("Berhasil","Kategori event berhasil diperbarui.","success")):(await f.post("/api/v1/event-categories",s),m.fire("Berhasil","Kategori event berhasil ditambahkan.","success")),$("#eventCategoryModal").modal("hide"),g(d.value.current_page)}catch(t){console.error("Gagal menyimpan event_category:",t);let i="Gagal menyimpan data kategori event.";t.response&&t.response.status===422&&t.response.data.message&&(i=t.response.data.message),m.fire("Gagal",i,"error")}finally{B.value=!1}},R=async s=>{if((await m.fire({title:"Hapus Kategori Event?",text:`Yakin ingin menghapus kategori "${s.full_name}" dari event ini?`,icon:"warning",showCancelButton:!0,confirmButtonText:"Ya, Hapus",cancelButtonText:"Batal",confirmButtonColor:"#d33",cancelButtonColor:"#3085d6"})).isConfirmed)try{await f.delete(`/api/v1/event-categories/${s.id}`),m.fire("Terhapus","Kategori event berhasil dihapus.","success"),g(d.value.current_page)}catch(i){console.error("Gagal menghapus event_category:",i),m.fire("Gagal","Gagal menghapus kategori event.","error")}},Q=async()=>{if(!v.value){m.fire("Event belum dipilih","Silakan pilih event melalui Portal Event sebelum generate dari template.","warning");return}if((await m.fire({title:"Generate dari Template?",text:"Kategori event akan dibuat berdasarkan Master Categories. Kombinasi yang sudah ada tidak akan diduplikasi.",icon:"question",showCancelButton:!0,confirmButtonText:"Ya, Generate",cancelButtonText:"Batal",confirmButtonColor:"#28a745",cancelButtonColor:"#6c757d"})).isConfirmed){E.value=!0;try{await f.post("/api/v1/event-categories/generate-from-template",{event_id:v.value}),m.fire("Berhasil","Kategori event berhasil digenerate dari template.","success"),g(1)}catch(t){console.error("Gagal generate dari template (event_categories):",t);let i="Gagal generate kategori dari template.";t.response&&t.response.data&&t.response.data.message&&(i=t.response.data.message),m.fire("Gagal",i,"error")}finally{E.value=!1}}};return K(()=>x.value,()=>{g(1)}),K(()=>C.value,ae(()=>g(1),400)),K(()=>w.value,()=>{g(1)}),K(()=>v.value,s=>{s&&g(1)}),te(()=>{z(),v.value?g():m.fire("Event belum dipilih","Silakan pilih event melalui Portal Event terlebih dahulu.","info")}),(s,t)=>{var i,H;return o(),n(h,null,[e("section",se,[e("div",le,[e("div",ne,[e("div",null,[t[14]||(t[14]=e("h1",{class:"mb-1"},"Kategori per Event (Event Categories)",-1)),t[15]||(t[15]=e("p",{class:"mb-0 text-muted text-sm"}," Mengatur kategori (Putra/Putri, dsb) yang diaktifkan pada event terpilih untuk setiap kombinasi Cabang + Golongan. ",-1)),_.value||y.value?(o(),n("p",oe,[t[13]||(t[13]=u(" Filter: ")),_.value?(o(),n("span",re,[t[11]||(t[11]=u(" Cabang ")),e("strong",null,r(((i=U.value.find(a=>a.id===_.value))==null?void 0:i.name)||"ID: "+_.value),1)])):b("",!0),y.value?(o(),n("span",ie,[t[12]||(t[12]=u(" • Golongan ")),e("strong",null,r(((H=V.value.find(a=>a.id===y.value))==null?void 0:H.name)||"ID: "+y.value),1)])):b("",!0)])):b("",!0)]),e("div",ue,[e("button",{class:"btn btn-outline-secondary btn-sm mr-sm-2 mb-2 mb-sm-0",onClick:Q,disabled:E.value||!v.value},[E.value?(o(),n("i",me)):(o(),n("i",ve)),t[16]||(t[16]=u(" Generate dari Template "))],8,de),e("button",{class:"btn btn-primary btn-sm",onClick:J,disabled:!v.value}," + Tambah Kategori ",8,ce)])]),v.value?b("",!0):(o(),n("p",ge,t[17]||(t[17]=[e("i",{class:"fas fa-exclamation-triangle mr-1"},null,-1),u(" Event belum dipilih. Silakan pilih event melalui Portal Event terlebih dahulu. ")])))])]),e("section",pe,[e("div",be,[e("div",fe,[e("div",_e,[e("div",ye,[e("div",ke,[t[20]||(t[20]=e("label",{class:"mb-0 mr-1 text-sm text-muted"},"Tampilkan",-1)),p(e("select",{"onUpdate:modelValue":t[0]||(t[0]=a=>w.value=a),class:"form-control form-control-sm w-auto mr-2"},t[18]||(t[18]=[e("option",{value:10},"10",-1),e("option",{value:25},"25",-1),e("option",{value:50},"50",-1),e("option",{value:100},"100",-1)]),512),[[k,w.value,void 0,{number:!0}]]),t[21]||(t[21]=e("label",{class:"mb-0 text-sm text-muted mr-2"},"|",-1)),p(e("select",{"onUpdate:modelValue":t[1]||(t[1]=a=>x.value=a),class:"form-control form-control-sm w-auto"},t[19]||(t[19]=[e("option",{value:"active"},"Aktif",-1),e("option",{value:"inactive"},"Nonaktif",-1),e("option",{value:"all"},"Semua",-1)]),512),[[k,x.value]])]),p(e("input",{"onUpdate:modelValue":t[2]||(t[2]=a=>C.value=a),type:"text",class:"form-control form-control-sm w-auto",style:{"min-width":"220px"},placeholder:"Cari cabang / golongan / kategori..."},null,512),[[N,C.value]])])]),e("div",he,[e("table",xe,[t[26]||(t[26]=e("thead",{class:"thead-light"},[e("tr",null,[e("th",{style:{width:"40px"}},"#"),e("th",null,"Cabang"),e("th",null,"Golongan"),e("th",null,"Kategori"),e("th",null,"Nama Lengkap"),e("th",{style:{width:"90px"},class:"text-center"},"Status"),e("th",{style:{width:"80px"},class:"text-center"},"Urutan"),e("th",{style:{width:"110px"},class:"text-center"},"Aksi")])],-1)),e("tbody",null,[D.value?(o(),n("tr",Ce,t[22]||(t[22]=[e("td",{colspan:"8",class:"text-center"},"Memuat data event categories...",-1)]))):T.value.length===0?(o(),n("tr",we,t[23]||(t[23]=[e("td",{colspan:"8",class:"text-center"},[u(" Belum ada kategori terdaftar untuk event ini. "),e("br"),e("small",{class:"text-muted"},[u(" Klik "),e("strong",null,"Generate dari Template"),u(" atau "),e("strong",null,"Tambah Kategori Event"),u(". ")])],-1)]))):b("",!0),(o(!0),n(h,null,M(T.value,(a,W)=>(o(),n("tr",{key:a.id},[e("td",null,r(W+1+(d.value.current_page-1)*d.value.per_page),1),e("td",null,[e("strong",null,r(a.branch_name),1)]),e("td",null,[e("strong",null,r(a.group_name),1)]),e("td",null,[e("strong",null,r(a.category_name),1)]),e("td",null,r(a.full_name),1),e("td",Ge,[e("span",{class:P(["badge",a.status==="active"?"badge-success":"badge-secondary"])},r(a.status==="active"?"Aktif":"Nonaktif"),3)]),e("td",Be,r(a.order_number??"-"),1),e("td",Ee,[e("div",Se,[e("button",{class:"btn btn-warning",onClick:X=>Y(a)},t[24]||(t[24]=[e("i",{class:"fas fa-edit"},null,-1)]),8,Ke),e("button",{class:"btn btn-danger",onClick:X=>R(a)},t[25]||(t[25]=[e("i",{class:"fas fa-trash"},null,-1)]),8,Me)])])]))),128))])])]),e("div",Te,[e("div",Ue,[e("div",Ve," Menampilkan "+r(d.value.from||0)+" - "+r(d.value.to||0)+" dari "+r(d.value.total||0)+" kategori event ",1),e("ul",De,[e("li",{class:P(["page-item",{disabled:d.value.current_page===1}])},[e("a",{href:"#",class:"page-link",onClick:t[3]||(t[3]=F(a=>A(d.value.current_page-1),["prevent"]))}," « ")],2),e("li",Ne,[e("span",Pe," Halaman "+r(d.value.current_page)+" / "+r(d.value.last_page||1),1)]),e("li",{class:P(["page-item",{disabled:d.value.current_page===d.value.last_page}])},[e("a",{href:"#",class:"page-link",onClick:t[4]||(t[4]=F(a=>A(d.value.current_page+1),["prevent"]))}," » ")],2)])])])])]),e("div",$e,[e("div",Fe,[e("div",Ie,[e("div",Le,[e("h5",qe,[t[27]||(t[27]=e("i",{class:"fas fa-venus-mars mr-1"},null,-1)),u(" "+r(G.value?"Edit Kategori Event":"Tambah Kategori Event"),1)]),t[28]||(t[28]=e("button",{type:"button",class:"close","data-dismiss":"modal"},[e("span",null,"×")],-1))]),e("div",Ae,[e("form",{onSubmit:F(O,["prevent"])},[e("div",He,[e("div",je,[e("div",ze,[t[30]||(t[30]=e("label",{class:"mb-1"},"Cabang Lomba",-1)),p(e("select",{"onUpdate:modelValue":t[5]||(t[5]=a=>l.value.branch_id=a),class:"form-control form-control-sm",required:""},[t[29]||(t[29]=e("option",{value:"",disabled:""},"-- pilih cabang --",-1)),(o(!0),n(h,null,M(U.value,a=>(o(),n("option",{key:a.id,value:a.id},[u(r(a.name)+" ",1),a.code?(o(),n("span",Ye," ("+r(a.code)+")",1)):b("",!0)],8,Je))),128))],512),[[k,l.value.branch_id]]),t[31]||(t[31]=e("small",{class:"text-muted"},[u(" Data diambil dari master "),e("strong",null,"Branches"),u(". ")],-1))]),e("div",Oe,[t[33]||(t[33]=e("label",{class:"mb-1"},"Golongan",-1)),p(e("select",{"onUpdate:modelValue":t[6]||(t[6]=a=>l.value.group_id=a),class:"form-control form-control-sm",required:""},[t[32]||(t[32]=e("option",{value:"",disabled:""},"-- pilih golongan --",-1)),(o(!0),n(h,null,M(V.value,a=>(o(),n("option",{key:a.id,value:a.id},[u(r(a.name)+" ",1),a.code?(o(),n("span",Qe," ("+r(a.code)+")",1)):b("",!0)],8,Re))),128))],512),[[k,l.value.group_id]]),t[34]||(t[34]=e("small",{class:"text-muted"},[u(" Data diambil dari master "),e("strong",null,"Groups"),u(". ")],-1))]),e("div",We,[t[36]||(t[36]=e("label",{class:"mb-1"},"Kategori",-1)),p(e("select",{"onUpdate:modelValue":t[7]||(t[7]=a=>l.value.category_id=a),class:"form-control form-control-sm",required:""},[t[35]||(t[35]=e("option",{value:"",disabled:""},"-- pilih kategori --",-1)),(o(!0),n(h,null,M(q.value,a=>(o(),n("option",{key:a.id,value:a.id},[u(r(a.name)+" ",1),a.code?(o(),n("span",Ze," ("+r(a.code)+")",1)):b("",!0)],8,Xe))),128))],512),[[k,l.value.category_id]]),t[37]||(t[37]=e("small",{class:"text-muted"},[u(" Data diambil dari master "),e("strong",null,"Categories"),u(". ")],-1))])]),e("div",et,[e("div",tt,[t[38]||(t[38]=e("label",{class:"mb-1"},"Nama Lengkap (Full Name)",-1)),p(e("input",{"onUpdate:modelValue":t[8]||(t[8]=a=>l.value.full_name=a),type:"text",class:"form-control form-control-sm",placeholder:"Contoh: Hafalan 10 Juz - Remaja - Putra"},null,512),[[N,l.value.full_name]]),t[39]||(t[39]=e("small",{class:"text-muted"}," Jika dikosongkan, akan digenerate dari Cabang + Golongan + Kategori. ",-1))]),e("div",at,[t[41]||(t[41]=e("label",{class:"mb-1"},"Status",-1)),p(e("select",{"onUpdate:modelValue":t[9]||(t[9]=a=>l.value.status=a),class:"form-control form-control-sm"},t[40]||(t[40]=[e("option",{value:"active"},"Aktif",-1),e("option",{value:"inactive"},"Nonaktif",-1)]),512),[[k,l.value.status]])]),e("div",st,[t[42]||(t[42]=e("label",{class:"mb-1"},"Urutan Tampil",-1)),p(e("input",{"onUpdate:modelValue":t[10]||(t[10]=a=>l.value.order_number=a),type:"number",min:"1",class:"form-control form-control-sm"},null,512),[[N,l.value.order_number,void 0,{number:!0}]])])])]),e("div",lt,[e("button",{type:"submit",class:"btn btn-sm btn-primary",disabled:B.value||!v.value},[B.value?(o(),n("i",ot)):(o(),n("i",rt)),t[43]||(t[43]=u(" Simpan "))],8,nt)])],32)])])])])])],64)}}};export{mt as default};
