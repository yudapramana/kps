import{z as Y,y as W,A as m,O as P,V as X,B as r,C as d,D as e,I as S,K as k,S as n,as as v,G as R,J as s,U as x,ay as K,H as N,F as G,aB as h,a as p,aC as Z}from"./AuthUserStore-67h2FHdL.js";const ee={class:"content-header"},te={class:"container-fluid"},ae={class:"d-flex justify-content-between align-items-center"},le={class:"content"},oe={class:"container-fluid"},se={class:"card"},ne={class:"card-header d-flex justify-content-between align-items-center"},ie={key:0,class:"text-muted text-sm"},re={class:"card-body table-responsive p-0"},de={class:"table table-bordered table-hover text-sm"},ue={key:0},ve={key:1},me={class:"text-xs text-muted"},_e={class:"badge badge-info text-uppercase"},pe={class:"text-center"},ce={class:"btn-group btn-group-sm"},ge=["onClick"],fe=["onClick"],be={class:"card-footer clearfix"},ye={class:"d-flex justify-content-between align-items-center"},ke={class:"text-muted text-sm"},xe={class:"pagination pagination-sm m-0"},he={class:"page-item disabled"},we={class:"page-link"},Ue={class:"modal fade",id:"eventModal",tabindex:"-1",role:"dialog"},Ee={class:"modal-dialog modal-lg",role:"document"},Me={class:"modal-content"},Ve={class:"modal-header py-2"},Se={class:"modal-title",id:"eventModalLabel"},Ke={class:"modal-body pt-2"},Ce={class:"row"},Te={class:"col-md-6"},De={class:"form-group mb-2"},Le=["readonly"],$e={class:"form-group mb-2"},Ae={class:"form-group mb-2"},Pe={class:"form-group mb-2"},Ne={class:"form-group mb-2"},Ge={class:"form-group mb-2"},Ie={class:"col-md-6"},Oe={class:"form-group mb-2"},qe={class:"form-group mb-2"},Be={class:"form-group mb-2"},Fe={class:"form-group mb-2"},Re={class:"form-group mb-2"},je=["disabled"],He=["value"],Je={class:"form-group mb-2"},Qe=["disabled"],ze={value:""},Ye=["value"],We={class:"form-group mb-2"},Xe=["disabled"],Ze={value:""},et=["value"],tt={class:"form-group mb-2"},at={class:"form-group mb-2"},lt={class:"form-group mb-2"},ot={class:"form-group mb-2"},st={class:"form-group mb-2"},nt={class:"text-end mt-3"},it=["disabled"],rt={key:0,class:"fas fa-spinner fa-spin mr-1"},dt={key:1,class:"fas fa-save mr-1"},_t={__name:"EventList",setup(ut){const c=Y(),w=W(()=>{var o,t;return((t=(o=c.user)==null?void 0:o.role)==null?void 0:t.slug)==="superadmin"}),C=m([]),u=m({current_page:1,per_page:10,total:0,from:0,to:0,last_page:1}),U=m(""),T=m(!1),D=m([]),f=m([]),_=m([]),E=m(!1),M=m(!1),g=m(!1),b=m(!1),V=m(!1),a=m({id:null,event_key:"",event_name:"",app_name:"",event_location:"",event_tagline:"",assessment_token:"",start_date:"",end_date:"",age_limit_date:"",logo_event:"",logo_sponsor_1:"",logo_sponsor_2:"",logo_sponsor_3:"",event_level:"regency",province_id:"",regency_id:"",district_id:"",is_active:!0}),I=o=>{if(!o)return"-";const t=String(o).substring(0,10),[l,i,A]=t.split("-");return`${A} ${["Jan","Feb","Mar","Apr","Mei","Jun","Jul","Agu","Sep","Okt","Nov","Des"][parseInt(i,10)-1]} ${l}`},L=o=>o?/^\d{4}-\d{2}-\d{2}$/.test(o)?o:String(o).substring(0,10):"",O=async()=>{try{const o=await p.get("/api/v1/get/provinces");D.value=o.data.data||o.data||[]}catch(o){console.error("Gagal memuat daftar province:",o)}},q=async(o=!1)=>{if(!a.value.province_id){f.value=[],_.value=[],o||(a.value.regency_id="",a.value.district_id="");return}E.value=!0,o||(f.value=[],a.value.regency_id="",_.value=[],a.value.district_id="");try{const t=await p.get("/api/v1/get/regencies",{params:{province_id:a.value.province_id}});f.value=t.data.data||t.data||[]}catch(t){console.error("Gagal memuat kab/kota:",t)}finally{E.value=!1}},B=async(o=!1)=>{if(!a.value.regency_id){_.value=[],o||(a.value.district_id="");return}M.value=!0,o||(_.value=[],a.value.district_id="");try{const t=await p.get("/api/v1/get/districts",{params:{regency_id:a.value.regency_id}});_.value=t.data.data||t.data||[]}catch(t){console.error("Gagal memuat kecamatan:",t)}finally{M.value=!1}},y=async(o=1)=>{var t;T.value=!0;try{const l={page:o,search:U.value};!w.value&&((t=c.eventData)!=null&&t.id)&&(l.event_id=c.eventData.id);const i=await p.get("/api/v1/events",{params:l});C.value=i.data.data||[],u.value={current_page:i.data.current_page,per_page:i.data.per_page,total:i.data.total,from:i.data.from,to:i.data.to,last_page:i.data.last_page}}catch(l){console.error("Gagal memuat data event:",l),l.response&&l.response.status===401&&c.logout()}finally{T.value=!1}},F=o=>{o<1||o>u.value.last_page||y(o)},j=()=>{a.value={id:null,event_key:"",event_name:"",app_name:"",event_location:"",event_tagline:"",assessment_token:"",start_date:"",end_date:"",age_limit_date:"",logo_event:"",logo_sponsor_1:"",logo_sponsor_2:"",logo_sponsor_3:"",event_level:"regency",province_id:"",regency_id:"",district_id:"",is_active:!0}},H=()=>{b.value=!1,g.value=!0,j(),f.value=[],_.value=[],g.value=!1,$("#eventModal").modal("show")},J=async o=>{b.value=!0,g.value=!0,a.value={id:o.id,event_key:o.event_key,event_name:o.event_name,app_name:o.app_name,event_location:o.event_location,event_tagline:o.event_tagline,assessment_token:o.assessment_token,start_date:L(o.start_date),end_date:L(o.end_date),age_limit_date:L(o.age_limit_date),logo_event:o.logo_event,logo_sponsor_1:o.logo_sponsor_1,logo_sponsor_2:o.logo_sponsor_2,logo_sponsor_3:o.logo_sponsor_3,event_level:o.event_level||"regency",province_id:o.province_id||"",regency_id:o.regency_id||"",district_id:o.district_id||"",is_active:!!o.is_active},D.value.length||await O(),a.value.province_id&&await q(!0),a.value.regency_id&&await B(!0),g.value=!1,$("#eventModal").modal("show")},Q=async()=>{var t,l;V.value=!0;const o={event_key:a.value.event_key,event_name:a.value.event_name,app_name:a.value.app_name,event_location:a.value.event_location,event_tagline:a.value.event_tagline,assessment_token:a.value.assessment_token,start_date:a.value.start_date||null,end_date:a.value.end_date||null,age_limit_date:a.value.age_limit_date||null,logo_event:a.value.logo_event,logo_sponsor_1:a.value.logo_sponsor_1,logo_sponsor_2:a.value.logo_sponsor_2,logo_sponsor_3:a.value.logo_sponsor_3,event_level:a.value.event_level,province_id:a.value.province_id||null,regency_id:a.value.regency_id||null,district_id:a.value.district_id||null,is_active:a.value.is_active};try{b.value&&a.value.id?await p.put(`/api/v1/events/${a.value.id}`,o):await p.post("/api/v1/events",o),$("#eventModal").modal("hide"),y(u.value.current_page)}catch(i){console.error("Gagal menyimpan event:",i),alert(((l=(t=i.response)==null?void 0:t.data)==null?void 0:l.message)||"Gagal menyimpan event.")}finally{V.value=!1}},z=async o=>{var t,l;if(confirm(`Yakin ingin menghapus event "${o.event_name}"?`))try{await p.delete(`/api/v1/events/${o.id}`),y(1)}catch(i){console.error("Gagal menghapus event:",i),alert(((l=(t=i.response)==null?void 0:t.data)==null?void 0:l.message)||"Gagal menghapus event.")}};return P(()=>U.value,Z(()=>y(1),400)),P(()=>a.value.province_id,()=>{g.value||q()}),P(()=>a.value.regency_id,()=>{g.value||B()}),X(async()=>{await O(),y()}),(o,t)=>(d(),r(x,null,[e("section",ee,[e("div",te,[e("div",ae,[t[22]||(t[22]=e("div",null,[e("h1",{class:"mb-1"},"Data Event MTQ"),e("p",{class:"mb-0 text-muted text-sm"}," Kelola konfigurasi event Musabaqah Tilawatil Qur'an. ")],-1)),w.value?(d(),r("button",{key:0,class:"btn btn-primary btn-sm",onClick:H},t[21]||(t[21]=[e("i",{class:"fas fa-plus mr-1"},null,-1),k(" Tambah Event ")]))):S("",!0)])])]),e("section",le,[e("div",oe,[e("div",se,[e("div",ne,[n(e("input",{"onUpdate:modelValue":t[0]||(t[0]=l=>U.value=l),type:"text",class:"form-control form-control-sm w-50",placeholder:"Cari nama event, aplikasi, atau lokasi..."},null,512),[[v,U.value]]),!w.value&&R(c).eventData?(d(),r("span",ie,[t[23]||(t[23]=k(" Event aktif: ")),e("strong",null,s(R(c).eventData.event_name),1)])):S("",!0)]),e("div",re,[e("table",de,[t[29]||(t[29]=e("thead",{class:"thead-light"},[e("tr",null,[e("th",{style:{width:"40px"}},"#"),e("th",null,"Nama Event"),e("th",null,"Nama Aplikasi"),e("th",null,"Lokasi"),e("th",null,"Periode"),e("th",null,"Tingkat"),e("th",null,"Status"),e("th",{style:{width:"90px"}},"Aksi")])],-1)),e("tbody",null,[T.value?(d(),r("tr",ue,t[24]||(t[24]=[e("td",{colspan:"8",class:"text-center"},"Memuat data...",-1)]))):C.value.length===0?(d(),r("tr",ve,t[25]||(t[25]=[e("td",{colspan:"8",class:"text-center"},"Tidak ada data event.",-1)]))):S("",!0),(d(!0),r(x,null,K(C.value,(l,i)=>(d(),r("tr",{key:l.id},[e("td",null,s(i+1+(u.value.current_page-1)*u.value.per_page),1),e("td",null,[e("strong",null,s(l.event_name),1),e("div",me,[t[26]||(t[26]=k(" key: ")),e("code",null,s(l.event_key),1)])]),e("td",null,s(l.app_name),1),e("td",null,s(l.event_location||"-"),1),e("td",null,s(I(l.start_date))+" – "+s(I(l.end_date)),1),e("td",null,[e("span",_e,s(l.event_level),1)]),e("td",null,[e("span",{class:N(["badge",l.is_active?"badge-success":"badge-secondary"])},s(l.is_active?"Aktif":"Nonaktif"),3)]),e("td",pe,[e("div",ce,[e("button",{class:"btn btn-outline-warning",title:"Edit",onClick:A=>J(l)},t[27]||(t[27]=[e("i",{class:"fas fa-edit"},null,-1)]),8,ge),w.value?(d(),r("button",{key:0,class:"btn btn-outline-danger",title:"Hapus",onClick:A=>z(l)},t[28]||(t[28]=[e("i",{class:"fas fa-trash-alt"},null,-1)]),8,fe)):S("",!0)])])]))),128))])])]),e("div",be,[e("div",ye,[e("div",ke," Menampilkan "+s(u.value.from||0)+" - "+s(u.value.to||0)+" dari "+s(u.value.total||0)+" event ",1),e("ul",xe,[e("li",{class:N(["page-item",{disabled:u.value.current_page===1}])},[e("a",{class:"page-link",href:"#",onClick:t[1]||(t[1]=G(l=>F(u.value.current_page-1),["prevent"]))}," « ")],2),e("li",he,[e("span",we," Halaman "+s(u.value.current_page)+" / "+s(u.value.last_page||1),1)]),e("li",{class:N(["page-item",{disabled:u.value.current_page===u.value.last_page}])},[e("a",{class:"page-link",href:"#",onClick:t[2]||(t[2]=G(l=>F(u.value.current_page+1),["prevent"]))}," » ")],2)])])])])]),e("div",Ue,[e("div",Ee,[e("div",Me,[e("div",Ve,[e("h5",Se,[t[30]||(t[30]=e("i",{class:"fas fa-calendar-alt mr-2"},null,-1)),k(" "+s(b.value?"Edit Event":"Tambah Event"),1)]),t[31]||(t[31]=e("button",{type:"button",class:"close","data-dismiss":"modal"},[e("span",null,"×")],-1))]),e("div",Ke,[e("form",{onSubmit:G(Q,["prevent"])},[e("div",Ce,[e("div",Te,[e("div",De,[t[32]||(t[32]=e("label",{class:"mb-1"},"Event Key",-1)),n(e("input",{"onUpdate:modelValue":t[3]||(t[3]=l=>a.value.event_key=l),class:"form-control form-control-sm",readonly:b.value,required:"",placeholder:"Contoh: MTQ_KAB_PESISIRSELATAN_2027"},null,8,Le),[[v,a.value.event_key]])]),e("div",$e,[t[33]||(t[33]=e("label",{class:"mb-1"},"Nama Event",-1)),n(e("input",{"onUpdate:modelValue":t[4]||(t[4]=l=>a.value.event_name=l),class:"form-control form-control-sm",required:""},null,512),[[v,a.value.event_name]])]),e("div",Ae,[t[34]||(t[34]=e("label",{class:"mb-1"},"Nama Aplikasi",-1)),n(e("input",{"onUpdate:modelValue":t[5]||(t[5]=l=>a.value.app_name=l),class:"form-control form-control-sm",required:"",placeholder:"Contoh: e-MTQ Pesisir Selatan"},null,512),[[v,a.value.app_name]])]),e("div",Pe,[t[35]||(t[35]=e("label",{class:"mb-1"},"Lokasi Event",-1)),n(e("input",{"onUpdate:modelValue":t[6]||(t[6]=l=>a.value.event_location=l),class:"form-control form-control-sm",placeholder:"Contoh: Painan, Kab. Pesisir Selatan"},null,512),[[v,a.value.event_location]])]),e("div",Ne,[t[36]||(t[36]=e("label",{class:"mb-1"},"tagline",-1)),n(e("input",{"onUpdate:modelValue":t[7]||(t[7]=l=>a.value.event_tagline=l),class:"form-control form-control-sm",placeholder:"Contoh: Merajut Ukhuwah dengan Kalam Ilahi"},null,512),[[v,a.value.event_tagline]])]),e("div",Ge,[t[37]||(t[37]=e("label",{class:"mb-1"},"Token Hasil Penilaian",-1)),n(e("input",{"onUpdate:modelValue":t[8]||(t[8]=l=>a.value.assessment_token=l),class:"form-control form-control-sm",placeholder:"Opsional: token untuk publikasi hasil"},null,512),[[v,a.value.assessment_token]])])]),e("div",Ie,[e("div",Oe,[t[38]||(t[38]=e("label",{class:"mb-1"},"Tanggal Mulai",-1)),n(e("input",{"onUpdate:modelValue":t[9]||(t[9]=l=>a.value.start_date=l),type:"date",class:"form-control form-control-sm",required:""},null,512),[[v,a.value.start_date]])]),e("div",qe,[t[39]||(t[39]=e("label",{class:"mb-1"},"Tanggal Selesai",-1)),n(e("input",{"onUpdate:modelValue":t[10]||(t[10]=l=>a.value.end_date=l),type:"date",class:"form-control form-control-sm",required:""},null,512),[[v,a.value.end_date]])]),e("div",Be,[t[40]||(t[40]=e("label",{class:"mb-1"},"Tanggal Batas Umur Peserta",-1)),n(e("input",{"onUpdate:modelValue":t[11]||(t[11]=l=>a.value.age_limit_date=l),type:"date",class:"form-control form-control-sm"},null,512),[[v,a.value.age_limit_date]])]),e("div",Fe,[t[42]||(t[42]=e("label",{class:"mb-1"},"Tingkat Event",-1)),n(e("select",{"onUpdate:modelValue":t[12]||(t[12]=l=>a.value.event_level=l),class:"form-control form-control-sm",required:""},t[41]||(t[41]=[e("option",{value:"national"},"national",-1),e("option",{value:"province"},"province",-1),e("option",{value:"regency"},"Kabupaten/Kota",-1),e("option",{value:"district"},"Kecamatan",-1)]),512),[[h,a.value.event_level]])]),e("div",Re,[t[44]||(t[44]=e("label",{class:"mb-1"},"province Event",-1)),n(e("select",{"onUpdate:modelValue":t[13]||(t[13]=l=>a.value.province_id=l),class:"form-control form-control-sm",disabled:a.value.event_level==="national"},[t[43]||(t[43]=e("option",{value:""},"-- Pilih province --",-1)),(d(!0),r(x,null,K(D.value,l=>(d(),r("option",{key:l.id,value:l.id},s(l.name),9,He))),128))],8,je),[[h,a.value.province_id]])]),e("div",Je,[t[45]||(t[45]=e("label",{class:"mb-1"},"Kabupaten / Kota Event",-1)),n(e("select",{"onUpdate:modelValue":t[14]||(t[14]=l=>a.value.regency_id=l),class:"form-control form-control-sm",disabled:a.value.event_level==="national"||a.value.event_level==="province"||!a.value.province_id||E.value},[e("option",ze,s(E.value?"Memuat Kab/Kota...":"-- Pilih Kab/Kota --"),1),(d(!0),r(x,null,K(f.value,l=>(d(),r("option",{key:l.id,value:l.id},s(l.name),9,Ye))),128))],8,Qe),[[h,a.value.regency_id]])]),e("div",We,[t[46]||(t[46]=e("label",{class:"mb-1"},"Kecamatan Event",-1)),n(e("select",{"onUpdate:modelValue":t[15]||(t[15]=l=>a.value.district_id=l),class:"form-control form-control-sm",disabled:a.value.event_level==="national"||a.value.event_level==="province"||a.value.event_level==="regency"||!a.value.regency_id||M.value},[e("option",Ze,s(M.value?"Memuat Kecamatan...":"-- Pilih Kecamatan --"),1),(d(!0),r(x,null,K(_.value,l=>(d(),r("option",{key:l.id,value:l.id},s(l.name),9,et))),128))],8,Xe),[[h,a.value.district_id]])]),e("div",tt,[t[47]||(t[47]=e("label",{class:"mb-1"},"Logo Event (URL / path)",-1)),n(e("input",{"onUpdate:modelValue":t[16]||(t[16]=l=>a.value.logo_event=l),class:"form-control form-control-sm"},null,512),[[v,a.value.logo_event]])]),e("div",at,[t[48]||(t[48]=e("label",{class:"mb-1"},"Logo Sponsor 1",-1)),n(e("input",{"onUpdate:modelValue":t[17]||(t[17]=l=>a.value.logo_sponsor_1=l),class:"form-control form-control-sm"},null,512),[[v,a.value.logo_sponsor_1]])]),e("div",lt,[t[49]||(t[49]=e("label",{class:"mb-1"},"Logo Sponsor 2",-1)),n(e("input",{"onUpdate:modelValue":t[18]||(t[18]=l=>a.value.logo_sponsor_2=l),class:"form-control form-control-sm"},null,512),[[v,a.value.logo_sponsor_2]])]),e("div",ot,[t[50]||(t[50]=e("label",{class:"mb-1"},"Logo Sponsor 3",-1)),n(e("input",{"onUpdate:modelValue":t[19]||(t[19]=l=>a.value.logo_sponsor_3=l),class:"form-control form-control-sm"},null,512),[[v,a.value.logo_sponsor_3]])]),e("div",st,[t[52]||(t[52]=e("label",{class:"mb-1"},"Status",-1)),n(e("select",{"onUpdate:modelValue":t[20]||(t[20]=l=>a.value.is_active=l),class:"form-control form-control-sm"},t[51]||(t[51]=[e("option",{value:!0},"Aktif",-1),e("option",{value:!1},"Nonaktif",-1)]),512),[[h,a.value.is_active]])])])]),e("div",nt,[e("button",{type:"submit",class:"btn btn-sm btn-primary",disabled:V.value},[V.value?(d(),r("i",rt)):(d(),r("i",dt)),t[53]||(t[53]=k(" Simpan "))],8,it)])],32)])])])])])],64))}};export{_t as default};
