import{z as N,A as i,O as B,V as A,B as r,C as d,D as a,S as m,as as c,K as u,J as o,I as G,U as w,ay as L,H as y,F as k,aB as E,a as f,aC as F}from"./AuthUserStore-67h2FHdL.js";const H={class:"content"},j={class:"container-fluid"},q={class:"card"},z={class:"card-header d-flex justify-content-between align-items-center"},J={class:"text-muted text-sm"},K={class:"card-body table-responsive p-0"},I={class:"table table-bordered table-hover text-sm"},O={key:0},P={key:1},Y={class:"text-center"},Q={class:"text-center"},R={class:"btn-group btn-group-sm"},W=["onClick"],X=["onClick"],Z={class:"card-footer clearfix"},aa={class:"d-flex justify-content-between align-items-center"},ea={class:"text-muted text-sm"},ta={class:"pagination pagination-sm m-0"},sa={class:"page-item disabled"},la={class:"page-link"},na={class:"modal fade",id:"masterStageModal",tabindex:"-1",role:"dialog"},oa={class:"modal-dialog modal-lg",role:"document"},ia={class:"modal-content"},ra={class:"modal-header py-2"},da={class:"modal-title",id:"masterStageModalLabel"},ua={class:"modal-body pt-2"},ma={class:"row"},pa={class:"col-md-6"},ca={class:"form-group mb-2"},va={class:"form-group mb-2"},ga={class:"form-group mb-2"},ba={class:"form-group mb-2"},fa={class:"col-md-6"},_a={class:"form-group mb-2"},ha={class:"text-end mt-3"},ya=["disabled"],ka={key:0,class:"fas fa-spinner fa-spin me-1"},xa={key:1,class:"fas fa-save me-1"},Sa={__name:"MasterStageList",setup(wa){const T=N(),_=i([]),n=i({current_page:1,per_page:10,total:0,from:0,to:0,last_page:1}),v=i(""),h=i(!1),g=i(!1),b=i(!1),s=i({id:null,name:"",order_number:1,days:1,description:"",is_active:!0}),p=async(l=1)=>{h.value=!0;try{const t=(await f.get("/api/v1/stages",{params:{page:l,search:v.value}})).data.data;_.value=t.data||[],n.value={current_page:t.current_page,per_page:t.per_page,total:t.total,from:t.from,to:t.to,last_page:t.last_page}}catch(e){e.response&&e.response.status===401?(console.warn("Unauthorized. Logging out..."),T.logout()):console.error("Gagal memuat master stages:",e)}finally{h.value=!1}},x=l=>{l<1||l>n.value.last_page||p(l)},S=()=>{g.value=!1,s.value={id:null,name:"",order_number:(n.value.total||0)+1,days:1,description:"",is_active:!0},$("#masterStageModal").modal("show")},M=l=>{g.value=!0,s.value={id:l.id,name:l.name,order_number:l.order_number,days:l.days,description:l.description,is_active:!!l.is_active},$("#masterStageModal").modal("show")},C=async()=>{b.value=!0;const l={name:s.value.name,order_number:s.value.order_number,days:s.value.days,description:s.value.description,is_active:s.value.is_active};try{g.value&&s.value.id?await f.put(`/api/v1/stages/${s.value.id}`,l):await f.post("/api/v1/stages",l),$("#masterStageModal").modal("hide"),p(n.value.current_page)}catch(e){console.error("Gagal menyimpan master stage:",e),alert("Gagal menyimpan data tahapan.")}finally{b.value=!1}},U=async l=>{if(confirm(`Yakin ingin menghapus template tahapan "${l.name}"?`))try{await f.delete(`/api/v1/stages/${l.id}`),p(n.value.current_page)}catch(e){console.error("Gagal menghapus master stage:",e),alert("Gagal menghapus tahapan.")}};return B(()=>v.value,F(()=>p(1),400)),A(()=>{p()}),(l,e)=>(d(),r(w,null,[a("section",{class:"content-header"},[a("div",{class:"container-fluid"},[a("div",{class:"d-flex justify-content-between align-items-center"},[e[8]||(e[8]=a("h1",{class:"mb-2"},"Template Tahapan (Master)",-1)),a("button",{class:"btn btn-primary btn-sm",onClick:S}," + Tambah Template Tahapan ")]),e[9]||(e[9]=a("p",{class:"text-muted text-sm mb-0"}," Master tahapan ini akan dipakai sebagai template saat generate tahapan pada setiap event. ",-1))])]),a("section",H,[a("div",j,[a("div",q,[a("div",z,[m(a("input",{"onUpdate:modelValue":e[0]||(e[0]=t=>v.value=t),type:"text",class:"form-control form-control-sm w-50",placeholder:"Cari nama tahapan..."},null,512),[[c,v.value]]),a("span",J,[e[10]||(e[10]=u(" Total: ")),a("strong",null,o(n.value.total||0),1),e[11]||(e[11]=u(" tahapan "))])]),a("div",K,[a("table",I,[e[16]||(e[16]=a("thead",{class:"thead-light"},[a("tr",null,[a("th",{style:{width:"40px"}},"#"),a("th",null,"Nama Tahapan"),a("th",{style:{width:"80px"}},"Hari"),a("th",null,"Deskripsi"),a("th",{style:{width:"90px"}},"Status"),a("th",{style:{width:"110px"}},"Aksi")])],-1)),a("tbody",null,[h.value?(d(),r("tr",O,e[12]||(e[12]=[a("td",{colspan:"7",class:"text-center"},"Memuat data...",-1)]))):_.value.length===0?(d(),r("tr",P,e[13]||(e[13]=[a("td",{colspan:"7",class:"text-center"},[u(" Belum ada template tahapan. "),a("br"),a("small",{class:"text-muted"},[u(" Klik "),a("strong",null,"Tambah Template Tahapan"),u(" untuk menambahkan. ")])],-1)]))):G("",!0),(d(!0),r(w,null,L(_.value,(t,V)=>(d(),r("tr",{key:t.id},[a("td",null,o(V+1+(n.value.current_page-1)*n.value.per_page),1),a("td",null,[a("strong",null,o(t.name),1)]),a("td",Y,o(t.days),1),a("td",null,o(t.description||"-"),1),a("td",null,[a("span",{class:y(["badge",t.is_active?"badge-success":"badge-secondary"])},o(t.is_active?"Aktif":"Nonaktif"),3)]),a("td",Q,[a("div",R,[a("button",{class:"btn btn-warning",onClick:D=>M(t)},e[14]||(e[14]=[a("i",{class:"fas fa-edit"},null,-1)]),8,W),a("button",{class:"btn btn-danger",onClick:D=>U(t)},e[15]||(e[15]=[a("i",{class:"fas fa-trash"},null,-1)]),8,X)])])]))),128))])])]),a("div",Z,[a("div",aa,[a("div",ea," Menampilkan "+o(n.value.from||0)+" - "+o(n.value.to||0)+" dari "+o(n.value.total||0)+" tahapan ",1),a("ul",ta,[a("li",{class:y(["page-item",{disabled:n.value.current_page===1}])},[a("a",{class:"page-link",href:"#",onClick:e[1]||(e[1]=k(t=>x(n.value.current_page-1),["prevent"]))}," « ")],2),a("li",sa,[a("span",la," Halaman "+o(n.value.current_page)+" / "+o(n.value.last_page||1),1)]),a("li",{class:y(["page-item",{disabled:n.value.current_page===n.value.last_page}])},[a("a",{class:"page-link",href:"#",onClick:e[2]||(e[2]=k(t=>x(n.value.current_page+1),["prevent"]))}," » ")],2)])])])])]),a("div",na,[a("div",oa,[a("div",ia,[a("div",ra,[a("h5",da,[e[17]||(e[17]=a("i",{class:"fas fa-layer-group me-2"},null,-1)),u(" "+o(g.value?"Edit Template Tahapan":"Tambah Template Tahapan"),1)]),e[18]||(e[18]=a("button",{type:"button",class:"close","data-dismiss":"modal"},[a("span",null,"×")],-1))]),a("div",ua,[a("form",{onSubmit:k(C,["prevent"])},[a("div",ma,[a("div",pa,[a("div",ca,[e[19]||(e[19]=a("label",{class:"mb-1"},"Nama Tahapan",-1)),m(a("input",{"onUpdate:modelValue":e[3]||(e[3]=t=>s.value.name=t),class:"form-control form-control-sm",required:""},null,512),[[c,s.value.name]])]),a("div",va,[e[20]||(e[20]=a("label",{class:"mb-1"},"Urutan Tahapan",-1)),m(a("input",{"onUpdate:modelValue":e[4]||(e[4]=t=>s.value.order_number=t),type:"number",min:"1",class:"form-control form-control-sm",required:""},null,512),[[c,s.value.order_number,void 0,{number:!0}]])]),a("div",ga,[e[21]||(e[21]=a("label",{class:"mb-1"},"Jumlah Hari",-1)),m(a("input",{"onUpdate:modelValue":e[5]||(e[5]=t=>s.value.days=t),type:"number",min:"1",class:"form-control form-control-sm",required:""},null,512),[[c,s.value.days,void 0,{number:!0}]]),e[22]||(e[22]=a("small",{class:"text-muted"}," Digunakan sebagai dasar generate tanggal otomatis pada event. ",-1))]),a("div",ba,[e[24]||(e[24]=a("label",{class:"mb-1"},"Status",-1)),m(a("select",{"onUpdate:modelValue":e[6]||(e[6]=t=>s.value.is_active=t),class:"form-control form-control-sm"},e[23]||(e[23]=[a("option",{value:!0},"Aktif",-1),a("option",{value:!1},"Nonaktif",-1)]),512),[[E,s.value.is_active]])])]),a("div",fa,[a("div",_a,[e[25]||(e[25]=a("label",{class:"mb-1"},"Deskripsi",-1)),m(a("textarea",{"onUpdate:modelValue":e[7]||(e[7]=t=>s.value.description=t),rows:"5",class:"form-control form-control-sm",placeholder:"Contoh: Tahap verifikasi awal kelengkapan berkas peserta."},null,512),[[c,s.value.description]])])])]),a("div",ha,[a("button",{type:"submit",class:"btn btn-sm btn-primary",disabled:b.value},[b.value?(d(),r("i",ka)):(d(),r("i",xa)),e[26]||(e[26]=u(" Simpan "))],8,ya)])],32)])])])])])],64))}};export{Sa as default};
