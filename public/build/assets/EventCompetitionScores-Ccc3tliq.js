import{z as at,y as w,M as lt,A as f,O as K,V as it,B as a,C as l,D as t,I as R,K as C,J as u,H,S as F,aB as J,U as h,ay as b,as as rt,aD as ut,a as G,L as dt,F as ct}from"./AuthUserStore-67h2FHdL.js";import{S as Q}from"./sweetalert2.esm.all-9Qm2jZ7z.js";import{_ as mt}from"./app-CZBZEz52.js";const vt={class:"content-header"},_t={class:"container-fluid"},pt={class:"d-flex justify-content-between align-items-center"},gt={class:"mb-0 text-muted text-sm"},ft={key:0,class:"ml-2"},ht=["disabled"],bt={class:"row mt-3"},yt={class:"col-md-12 mb-2"},xt=["disabled"],kt=["label"],St=["value"],wt={key:0,class:"text-muted"},Ct={class:"row"},At={class:"col-md-6 mb-2"},Mt=["placeholder","disabled"],Ut={class:"col-md-3 mb-2"},Et=["disabled"],Nt={class:"col-md-3 mb-2"},Tt=["disabled"],jt={key:0,class:"mb-2"},Bt={class:"nav nav-pills"},Kt=["onClick"],Dt={class:"badge badge-light border ml-2"},Vt={class:"content"},It={class:"container-fluid"},Pt={class:"card"},$t={class:"card-body table-responsive p-0"},Lt={key:0,class:"table table-bordered table-hover text-sm mb-0"},Rt={class:"thead-light"},Ft={key:0},Gt=["colspan"],Ot={key:1},qt=["colspan"],zt={key:2},Ht=["colspan"],Jt={class:"text-center"},Qt={class:"font-weight-bold"},Wt={class:"text-muted"},Xt={class:"text-sm"},Yt={class:"text-center font-weight-bold"},Zt={class:"text-center"},te={key:1,class:"table table-bordered table-hover text-sm mb-0"},ee={class:"thead-light"},se={key:0},ne=["colspan"],oe={key:1},ae=["colspan"],le={key:2},ie=["colspan"],re={class:"font-weight-bold"},ue={class:"text-muted"},de={class:"d-flex flex-column align-items-center"},ce={class:"btn-group btn-group-sm mt-1"},me=["disabled","onClick"],ve=["disabled","onClick"],_e={class:"text-muted mt-1"},pe={class:"text-center font-weight-bold"},ge={class:"text-center"},fe={class:"card-footer text-muted text-sm"},he={__name:"EventCompetitionScores",setup(be){const A=lt(),W=dt(),X=at(),Y=w(()=>X.eventData||null),T=w(()=>{var n;return((n=Y.value)==null?void 0:n.id)||null}),O=w(()=>String(A.params.id||"")),j=f(!1),q=f([]),c=f(String(A.params.id||"")),M=f(!1),D=f(""),V=f(""),U=f(null),m=f([]),y=f([]),E=n=>Number(n||0).toFixed(2),g=w(()=>{var e;const n=U.value||{};return typeof n.is_team<"u"?!!n.is_team:!!((e=n==null?void 0:n.event_group)!=null&&e.is_team)}),Z=async()=>{if(T.value){j.value=!0;try{const{data:n}=await G.get(`/api/v1/events/${T.value}/competitions/tree`,{params:{search:""}});q.value=n.rounds||[]}catch(n){console.error(n),Q.fire("Gagal","Gagal memuat daftar kompetisi.","error")}finally{j.value=!1}}},x=async()=>{const n=c.value||O.value;if(!n){U.value=null,m.value=[],y.value=[];return}M.value=!0;try{const{data:e}=await G.get(`/api/v1/event-competitions/${n}/scores`,{params:{search:D.value||void 0,status:V.value||void 0}});U.value=e.competition,m.value=e.judges||[],y.value=e.participants||[]}finally{M.value=!1}},z=async(n,e)=>{const d=c.value||O.value;!d||!n||(await G.patch(`/api/v1/event-competitions/${d}/scoresheets/${n}`,e),await x())},tt=async n=>{n&&(A.name!=="admin.event.scores.index"||String(A.params.id)!==String(n))&&await W.replace({name:"admin.event.scores.index",params:{id:String(n)},query:{...A.query}})},k=f("all"),I=w(()=>{var s,v,r;if(g.value)return[{id:"all",name:"SEMUA KONTINGEN",count:(y.value||[]).length}];const n=new Map;for(const o of y.value||[]){const i=o.event_category_id??((s=o.event_category)==null?void 0:s.id)??null,p=o.category_name??((v=o.event_category)==null?void 0:v.category_name)??((r=o.event_category)==null?void 0:r.full_name)??o.category??null;i&&(n.has(String(i))||n.set(String(i),{id:String(i),name:String(p||"Kategori"),count:0}),n.get(String(i)).count++)}const e=Array.from(n.values()),d=o=>{const i=(o||"").toLowerCase();return i.includes("putera")||i.includes("putra")?1:i.includes("puteri")||i.includes("putri")?2:99};return e.sort((o,i)=>{const p=d(o.name),_=d(i.name);return p!==_?p-_:o.name.localeCompare(i.name)}),[{id:"all",name:"SEMUA PESERTA",count:(y.value||[]).length},...e.map(o=>({id:o.id,name:`PESERTA ${o.name.toUpperCase()}`,count:o.count}))]}),B=w(()=>{const n=y.value||[];return k.value==="all"||g.value?n:n.filter(e=>String(e.event_category_id||"")===String(k.value))});K(()=>y.value,()=>{if(k.value==="all")return;(I.value||[]).some(e=>e.id===k.value)||(k.value="all")}),K(()=>g.value,()=>{k.value="all"});const P=w(()=>{var v;if(!g.value)return[];const n=B.value||[],e=new Map;for(const r of n){const o=String(r.contingent||"-");e.has(o)||e.set(o,{contingent:o,members:[],judgeScores:{}});const i=e.get(o);i.members.push(r.full_name||"-");for(const p of m.value||[]){const _=p.id,N=Number(((v=r.scores)==null?void 0:v[_])??0);i.judgeScores[_]||(i.judgeScores[_]=[]),r.scores&&typeof r.scores[_]<"u"&&i.judgeScores[_].push(N)}}const d=[],s=Array.from(e.keys()).sort((r,o)=>r==="-"?1:o==="-"?-1:r.localeCompare(o));for(const r of s){const o=e.get(r),i={};let p=0,_=0;for(const S of m.value||[]){const $=S.id,L=o.judgeScores[$]||[],st=L.length?L.reduce((nt,ot)=>nt+ot,0)/L.length:0;i[$]=Number(st.toFixed(2)),p+=i[$],_++}const N=_?p/_:0;d.push({contingent:o.contingent,members:o.members,member_count:o.members.length,scores:i,sum_score:Number(p.toFixed(2)),avg_score:Number(N.toFixed(2))})}return d}),et=(n=[],e=6)=>{const d=Array.isArray(n)?n.filter(Boolean):[];return d.length?d.length<=e?d.join(", "):`${d.slice(0,e).join(", ")}, ...`:"-"};return it(async()=>{if(!T.value){Q.fire("Event belum dipilih","Silakan pilih event melalui Portal Event terlebih dahulu.","info");return}await Z(),c.value&&await x()}),K(()=>A.params.id,async n=>{const e=String(n||"");c.value=e,await x()}),K(()=>c.value,async n=>{if(!n){U.value=null,m.value=[],y.value=[];return}await tt(n),await x()}),(n,e)=>{var d;return l(),a(h,null,[t("section",vt,[t("div",_t,[t("div",pt,[t("div",null,[e[3]||(e[3]=t("h1",{class:"mb-1"},"Rekap Nilai Kompetisi",-1)),t("p",gt,[C(u(((d=U.value)==null?void 0:d.full_name)||"Pilih kompetisi terlebih dahulu.")+" ",1),c.value&&U.value?(l(),a("span",ft,[t("span",{class:H(["badge",g.value?"badge-info":"badge-secondary"])},u(g.value?"TEAM / GROUP (By Kontingen)":"INDIVIDU"),3)])):R("",!0)])]),t("button",{class:"btn btn-sm btn-outline-secondary",onClick:x,disabled:M.value||!c.value},e[4]||(e[4]=[t("i",{class:"fas fa-sync"},null,-1),C(" Refresh ")]),8,ht)]),t("div",bt,[t("div",yt,[e[7]||(e[7]=t("label",{class:"mb-1 text-sm"},[C("Kompetisi "),t("span",{class:"text-danger"},"*")],-1)),F(t("select",{"onUpdate:modelValue":e[0]||(e[0]=s=>c.value=s),class:"form-control form-control-sm",disabled:!T.value||j.value},[e[5]||(e[5]=t("option",{value:"",disabled:""},"-- Pilih Kompetisi --",-1)),(l(!0),a(h,null,b(q.value,s=>(l(),a("optgroup",{key:"round-"+s.id,label:s.name},[(l(!0),a(h,null,b(s.competitions,v=>(l(),a("option",{key:v.id,value:String(v.id)},u(v.full_name),9,St))),128))],8,kt))),128))],8,xt),[[J,c.value]]),j.value?(l(),a("small",wt,e[6]||(e[6]=[t("i",{class:"fas fa-spinner fa-spin mr-1"},null,-1),C(" Memuat daftar kompetisi... ")]))):R("",!0)])]),t("div",Ct,[t("div",At,[F(t("input",{"onUpdate:modelValue":e[1]||(e[1]=s=>D.value=s),class:"form-control form-control-sm",placeholder:g.value?"Cari nama kontingen/anggota...":"Cari nama peserta...",disabled:!c.value,onKeyup:ut(x,["enter"])},null,40,Mt),[[rt,D.value]])]),t("div",Ut,[F(t("select",{"onUpdate:modelValue":e[2]||(e[2]=s=>V.value=s),class:"form-control form-control-sm",disabled:!c.value,onChange:x},e[8]||(e[8]=[t("option",{value:""},"Semua Status",-1),t("option",{value:"draft"},"Draft",-1),t("option",{value:"submitted"},"Submitted",-1),t("option",{value:"locked"},"Locked",-1)]),40,Et),[[J,V.value]])]),t("div",Nt,[t("button",{class:"btn btn-sm btn-primary w-100",onClick:x,disabled:M.value||!c.value},e[9]||(e[9]=[t("i",{class:"fas fa-search"},null,-1),C(" Filter ")]),8,Tt)])]),c.value&&!g.value&&I.value.length?(l(),a("div",jt,[t("ul",Bt,[(l(!0),a(h,null,b(I.value,s=>(l(),a("li",{class:"nav-item",key:"tab-"+s.id},[t("a",{href:"#",class:H(["nav-link",{active:k.value===s.id}]),onClick:ct(v=>k.value=s.id,["prevent"]),style:{"font-weight":"600"}},[C(u(s.name)+" ",1),t("span",Dt,u(s.count),1)],10,Kt)]))),128))])])):R("",!0)])]),t("section",Vt,[t("div",It,[t("div",Pt,[t("div",$t,[g.value?(l(),a("table",Lt,[t("thead",Rt,[t("tr",null,[e[10]||(e[10]=t("th",{style:{width:"50px"}},"#",-1)),e[11]||(e[11]=t("th",{style:{"min-width":"220px"}},"Kontingen",-1)),e[12]||(e[12]=t("th",{style:{"min-width":"420px"}},"Anggota",-1)),(l(!0),a(h,null,b(m.value,s=>(l(),a("th",{key:s.id,class:"text-center"},u(s.name),1))),128)),e[13]||(e[13]=t("th",{class:"text-center"},"AVG",-1)),e[14]||(e[14]=t("th",{class:"text-center"},"SUM",-1))])]),t("tbody",null,[c.value?M.value?(l(),a("tr",Ot,[t("td",{colspan:5+m.value.length,class:"text-center p-3 text-muted"},"Loading...",8,qt)])):P.value.length===0?(l(),a("tr",zt,[t("td",{colspan:5+m.value.length,class:"text-center p-3 text-muted"},"Tidak ada data.",8,Ht)])):(l(!0),a(h,{key:3},b(P.value,(s,v)=>(l(),a("tr",{key:"cont-"+s.contingent},[t("td",Jt,u(v+1),1),t("td",null,[t("div",Qt,u(s.contingent),1),t("small",Wt,u(s.member_count)+" anggota",1)]),t("td",null,[t("div",Xt,u(et(s.members,10)),1)]),(l(!0),a(h,null,b(m.value,r=>{var o;return l(),a("td",{key:r.id,class:"text-center font-weight-bold"},u(E((o=s.scores)==null?void 0:o[r.id])),1)}),128)),t("td",Yt,u(E(s.avg_score)),1),t("td",Zt,u(E(s.sum_score)),1)]))),128)):(l(),a("tr",Ft,[t("td",{colspan:5+m.value.length,class:"text-center p-3 text-muted"}," Silakan pilih kompetisi terlebih dahulu. ",8,Gt)]))])])):(l(),a("table",te,[t("thead",ee,[t("tr",null,[e[15]||(e[15]=t("th",{style:{width:"50px"}},"#",-1)),e[16]||(e[16]=t("th",null,"Peserta",-1)),e[17]||(e[17]=t("th",null,"Kontingen",-1)),(l(!0),a(h,null,b(m.value,s=>(l(),a("th",{key:s.id,class:"text-center"},u(s.name),1))),128)),e[18]||(e[18]=t("th",{class:"text-center"},"AVG",-1)),e[19]||(e[19]=t("th",{class:"text-center"},"SUM",-1))])]),t("tbody",null,[c.value?M.value?(l(),a("tr",oe,[t("td",{colspan:6+m.value.length,class:"text-center p-3 text-muted"},"Loading...",8,ae)])):B.value.length===0?(l(),a("tr",le,[t("td",{colspan:6+m.value.length,class:"text-center p-3 text-muted"},"Tidak ada data.",8,ie)])):(l(!0),a(h,{key:3},b(B.value,(s,v)=>(l(),a("tr",{key:s.event_participant_id||v},[t("td",null,u(v+1),1),t("td",null,[t("div",re,u(s.full_name),1),t("small",ue,u(s.category_name||"-"),1)]),t("td",null,u(s.contingent||"-"),1),(l(!0),a(h,null,b(m.value,r=>{var o,i,p,_;return l(),a("td",{key:r.id,class:"text-center"},[t("div",de,[t("span",null,u(E((o=s.scores)==null?void 0:o[r.id])),1),t("div",ce,[t("button",{class:"btn btn-outline-secondary",disabled:!((i=s.scoresheet_id_by_judge)!=null&&i[r.id]),onClick:N=>{var S;return z((S=s.scoresheet_id_by_judge)==null?void 0:S[r.id],{status:"locked"})},title:"Lock"},e[20]||(e[20]=[t("i",{class:"fas fa-lock"},null,-1)]),8,me),t("button",{class:"btn btn-outline-secondary",disabled:!((p=s.scoresheet_id_by_judge)!=null&&p[r.id]),onClick:N=>{var S;return z((S=s.scoresheet_id_by_judge)==null?void 0:S[r.id],{status:"submitted"})},title:"Unlock (Submitted)"},e[21]||(e[21]=[t("i",{class:"fas fa-unlock"},null,-1)]),8,ve)]),t("small",_e,u(((_=s.status_by_judge)==null?void 0:_[r.id])||"-"),1)])])}),128)),t("td",pe,u(E(s.avg_score)),1),t("td",ge,u(E(s.sum_score)),1)]))),128)):(l(),a("tr",se,[t("td",{colspan:6+m.value.length,class:"text-center p-3 text-muted"}," Silakan pilih kompetisi terlebih dahulu. ",8,ne)]))])]))]),t("div",fe,[e[22]||(e[22]=C(" Total: ")),t("strong",null,u(g.value?P.value.length+" kontingen":B.value.length+" peserta"),1)])])])])],64)}}},Se=mt(he,[["__scopeId","data-v-2ead7b88"]]);export{Se as default};
