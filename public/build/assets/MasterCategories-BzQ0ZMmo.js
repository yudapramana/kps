import{A as d,O as V,V as L,B as n,C as i,D as a,S as m,aB as v,as as S,I as P,K as p,U as b,ay as k,J as r,H as w,F as M,a as c,aC as j}from"./AuthUserStore-67h2FHdL.js";import{S as u}from"./sweetalert2.esm.all-9Qm2jZ7z.js";const q={class:"content"},I={class:"container-fluid"},z={class:"card"},J={class:"card-header"},O={class:"d-flex flex-wrap justify-content-between align-items-center w-100"},Q={class:"d-flex align-items-center"},Y={class:"card-body table-responsive p-0"},R={class:"table table-bordered table-hover text-sm mb-0"},W={key:0},X={key:1},Z={class:"text-center"},aa={class:"text-center"},ea={class:"text-center"},ta={class:"btn-group btn-group-sm"},sa=["onClick"],oa=["onClick"],la={class:"card-footer clearfix py-2"},ra={class:"d-flex justify-content-between align-items-center"},na={class:"text-muted text-sm"},ia={class:"pagination pagination-sm m-0"},da={class:"page-item disabled"},ua={class:"page-link"},ma={class:"modal fade",id:"masterCategoryModal",tabindex:"-1",role:"dialog","aria-labelledby":"masterCategoryModalLabel"},ca={class:"modal-dialog modal-lg",role:"document"},ga={class:"modal-content"},pa={class:"modal-header py-2"},va={class:"modal-title",id:"masterCategoryModalLabel"},ba={class:"modal-body pt-2"},_a={class:"row"},fa={class:"col-md-6"},ya={class:"form-group mb-2"},ha=["value"],ka={class:"form-group mb-2"},xa=["value"],Ca={class:"form-group mb-2"},wa=["value"],Ma={class:"col-md-6"},Ga={class:"form-group mb-2"},Ba={class:"form-group mb-2"},Ta={class:"text-right mt-3"},Ua=["disabled"],Va={key:0,class:"fas fa-spinner fa-spin mr-1"},Sa={key:1,class:"fas fa-save mr-1"},Aa={__name:"MasterCategories",setup($a){const x=d([]),G=d([]),B=d([]),T=d([]),_=d(""),f=d(10),C=d(!1),y=d(!1),h=d(!1),l=d({current_page:1,per_page:10,total:0,from:0,to:0,last_page:1}),o=d({id:null,branch_id:"",group_id:"",category_id:"",order_number:null,is_active:!0}),K=async()=>{try{const[s,e,t]=await Promise.all([c.get("/api/v1/branches?simple=1"),c.get("/api/v1/groups?simple=1"),c.get("/api/v1/categories?simple=1")]);G.value=s.data.data||[],B.value=e.data.data||[],T.value=t.data.data||[]}catch(s){console.error("Gagal memuat options master:",s),u.fire("Gagal","Gagal memuat data cabang/golongan/kategori.","error")}},g=async(s=1)=>{C.value=!0;try{const t=(await c.get("/api/v1/master-categories",{params:{page:s,per_page:f.value,search:_.value}})).data.data;x.value=t.data||[],l.value={current_page:t.current_page,per_page:t.per_page,total:t.total,from:t.from,to:t.to,last_page:t.last_page}}catch(e){console.error("Gagal memuat master_categories:",e),u.fire("Gagal","Gagal memuat data master categories.","error")}finally{C.value=!1}},U=s=>{s<1||s>l.value.last_page||g(s)},N=()=>{y.value=!1,o.value={id:null,branch_id:"",group_id:"",category_id:"",order_number:(l.value.total||0)+1,is_active:!0},$("#masterCategoryModal").modal("show")},A=s=>{y.value=!0,o.value={id:s.id,branch_id:s.branch_id,group_id:s.group_id,category_id:s.category_id,order_number:s.order_number,is_active:!!s.is_active},$("#masterCategoryModal").modal("show")},E=async()=>{h.value=!0;const s={branch_id:o.value.branch_id,group_id:o.value.group_id,category_id:o.value.category_id,order_number:o.value.order_number,is_active:o.value.is_active};try{y.value&&o.value.id?(await c.put(`/api/v1/master-categories/${o.value.id}`,s),u.fire("Berhasil","Master category berhasil diperbarui.","success")):(await c.post("/api/v1/master-categories",s),u.fire("Berhasil","Master category berhasil ditambahkan.","success")),$("#masterCategoryModal").modal("hide"),g(l.value.current_page)}catch(e){console.error("Gagal menyimpan master_category:",e),u.fire("Gagal","Gagal menyimpan data master category.","error")}finally{h.value=!1}},F=async s=>{if((await u.fire({title:"Hapus Master Category?",text:`Yakin ingin menghapus "${s.full_name}"? Tindakan ini tidak bisa dibatalkan.`,icon:"warning",showCancelButton:!0,confirmButtonText:"Ya, Hapus",cancelButtonText:"Batal",confirmButtonColor:"#d33",cancelButtonColor:"#3085d6"})).isConfirmed)try{await c.delete(`/api/v1/master-categories/${s.id}`),u.fire("Terhapus","Master category berhasil dihapus.","success"),g(l.value.current_page)}catch(t){console.error("Gagal menghapus master_category:",t),u.fire("Gagal","Gagal menghapus master category.","error")}};return V(()=>_.value,j(()=>g(1),400)),V(()=>f.value,()=>{g(1)}),L(()=>{K(),g()}),(s,e)=>(i(),n(b,null,[a("section",{class:"content-header"},[a("div",{class:"container-fluid"},[a("div",{class:"d-flex justify-content-between align-items-center"},[e[9]||(e[9]=a("div",null,[a("h1",{class:"mb-1"},"Master Kategori Cabang (Master Categories)"),a("p",{class:"mb-0 text-muted text-sm"}," Kombinasi Cabang + Golongan + Kategori sebagai template MTQ. Contoh: Hafalan Al Qur'an - 10 Juz - Putra. ")],-1)),a("button",{class:"btn btn-primary btn-sm",onClick:N}," + Tambah Master Category ")])])]),a("section",q,[a("div",I,[a("div",z,[a("div",J,[a("div",O,[a("div",Q,[e[11]||(e[11]=a("label",{class:"mb-0 mr-1 text-sm text-muted"},"Tampilkan",-1)),m(a("select",{"onUpdate:modelValue":e[0]||(e[0]=t=>f.value=t),class:"form-control form-control-sm w-auto mr-2"},e[10]||(e[10]=[a("option",{value:10},"10",-1),a("option",{value:25},"25",-1),a("option",{value:50},"50",-1),a("option",{value:100},"100",-1)]),512),[[v,f.value,void 0,{number:!0}]]),e[12]||(e[12]=a("label",{class:"mb-0 text-sm text-muted"},"Entri",-1))]),m(a("input",{"onUpdate:modelValue":e[1]||(e[1]=t=>_.value=t),type:"text",class:"form-control form-control-sm w-auto",style:{"min-width":"220px"},placeholder:"Cari cabang / golongan / kategori..."},null,512),[[S,_.value]])])]),a("div",Y,[a("table",R,[e[17]||(e[17]=a("thead",{class:"thead-light"},[a("tr",null,[a("th",{style:{width:"40px"}},"#"),a("th",null,"Cabang"),a("th",null,"Golongan"),a("th",null,"Kategori"),a("th",null,"Full Name"),a("th",{style:{width:"80px"},class:"text-center"},"Urutan"),a("th",{style:{width:"80px"},class:"text-center"},"Status"),a("th",{style:{width:"110px"},class:"text-center"},"Aksi")])],-1)),a("tbody",null,[C.value?(i(),n("tr",W,e[13]||(e[13]=[a("td",{colspan:"8",class:"text-center"},"Memuat data master categories...",-1)]))):x.value.length===0?(i(),n("tr",X,e[14]||(e[14]=[a("td",{colspan:"8",class:"text-center"},[p(" Belum ada master category. "),a("br"),a("small",{class:"text-muted"},[p(" Klik "),a("strong",null,"Tambah Master Category"),p(" untuk menambahkan. ")])],-1)]))):P("",!0),(i(!0),n(b,null,k(x.value,(t,H)=>(i(),n("tr",{key:t.id},[a("td",null,r(H+1+(l.value.current_page-1)*l.value.per_page),1),a("td",null,r(t.branch_name),1),a("td",null,r(t.group_name),1),a("td",null,r(t.category_name),1),a("td",null,[a("strong",null,r(t.full_name),1)]),a("td",Z,r(t.order_number||"-"),1),a("td",aa,[a("span",{class:w(["badge",t.is_active?"badge-success":"badge-secondary"])},r(t.is_active?"Aktif":"Nonaktif"),3)]),a("td",ea,[a("div",ta,[a("button",{class:"btn btn-warning",onClick:D=>A(t)},e[15]||(e[15]=[a("i",{class:"fas fa-edit"},null,-1)]),8,sa),a("button",{class:"btn btn-danger",onClick:D=>F(t)},e[16]||(e[16]=[a("i",{class:"fas fa-trash"},null,-1)]),8,oa)])])]))),128))])])]),a("div",la,[a("div",ra,[a("div",na," Menampilkan "+r(l.value.from||0)+" - "+r(l.value.to||0)+" dari "+r(l.value.total||0)+" master category ",1),a("ul",ia,[a("li",{class:w(["page-item",{disabled:l.value.current_page===1}])},[a("a",{href:"#",class:"page-link",onClick:e[2]||(e[2]=M(t=>U(l.value.current_page-1),["prevent"]))}," « ")],2),a("li",da,[a("span",ua," Halaman "+r(l.value.current_page)+" / "+r(l.value.last_page||1),1)]),a("li",{class:w(["page-item",{disabled:l.value.current_page===l.value.last_page}])},[a("a",{href:"#",class:"page-link",onClick:e[3]||(e[3]=M(t=>U(l.value.current_page+1),["prevent"]))}," » ")],2)])])])])]),a("div",ma,[a("div",ca,[a("div",ga,[a("div",pa,[a("h5",va,[e[18]||(e[18]=a("i",{class:"fas fa-tags mr-1"},null,-1)),p(" "+r(y.value?"Edit Master Category":"Tambah Master Category"),1)]),e[19]||(e[19]=a("button",{type:"button",class:"close","data-dismiss":"modal"},[a("span",null,"×")],-1))]),a("div",ba,[a("form",{onSubmit:M(E,["prevent"])},[a("div",_a,[a("div",fa,[a("div",ya,[e[21]||(e[21]=a("label",{class:"mb-1"},"Cabang",-1)),m(a("select",{"onUpdate:modelValue":e[4]||(e[4]=t=>o.value.branch_id=t),class:"form-control form-control-sm",required:""},[e[20]||(e[20]=a("option",{value:"",disabled:""},"-- pilih cabang --",-1)),(i(!0),n(b,null,k(G.value,t=>(i(),n("option",{key:t.id,value:t.id},r(t.name),9,ha))),128))],512),[[v,o.value.branch_id]])]),a("div",ka,[e[23]||(e[23]=a("label",{class:"mb-1"},"Golongan",-1)),m(a("select",{"onUpdate:modelValue":e[5]||(e[5]=t=>o.value.group_id=t),class:"form-control form-control-sm",required:""},[e[22]||(e[22]=a("option",{value:"",disabled:""},"-- pilih golongan --",-1)),(i(!0),n(b,null,k(B.value,t=>(i(),n("option",{key:t.id,value:t.id},r(t.name),9,xa))),128))],512),[[v,o.value.group_id]])]),a("div",Ca,[e[25]||(e[25]=a("label",{class:"mb-1"},"Kategori",-1)),m(a("select",{"onUpdate:modelValue":e[6]||(e[6]=t=>o.value.category_id=t),class:"form-control form-control-sm",required:""},[e[24]||(e[24]=a("option",{value:"",disabled:""},"-- pilih kategori --",-1)),(i(!0),n(b,null,k(T.value,t=>(i(),n("option",{key:t.id,value:t.id},r(t.name),9,wa))),128))],512),[[v,o.value.category_id]])])]),a("div",Ma,[a("div",Ga,[e[26]||(e[26]=a("label",{class:"mb-1"},"Urutan Tampil",-1)),m(a("input",{"onUpdate:modelValue":e[7]||(e[7]=t=>o.value.order_number=t),type:"number",min:"1",class:"form-control form-control-sm"},null,512),[[S,o.value.order_number,void 0,{number:!0}]]),e[27]||(e[27]=a("small",{class:"text-muted"}," Urutan master category saat tampil (boleh dikosongkan). ",-1))]),a("div",Ba,[e[29]||(e[29]=a("label",{class:"mb-1"},"Status",-1)),m(a("select",{"onUpdate:modelValue":e[8]||(e[8]=t=>o.value.is_active=t),class:"form-control form-control-sm"},e[28]||(e[28]=[a("option",{value:!0},"Aktif",-1),a("option",{value:!1},"Nonaktif",-1)]),512),[[v,o.value.is_active]])]),e[30]||(e[30]=a("div",{class:"alert alert-info py-2 px-3 mt-3 text-sm"},[a("strong",null,"Catatan:"),p(" Nama lengkap (full name) akan dibentuk otomatis dari Cabang + Golongan + Kategori di server. ")],-1))])]),a("div",Ta,[a("button",{type:"submit",class:"btn btn-sm btn-primary",disabled:h.value},[h.value?(i(),n("i",Va)):(i(),n("i",Sa)),e[31]||(e[31]=p(" Simpan "))],8,Ua)])],32)])])])])])],64))}};export{Aa as default};
