import{F as d,B as O,G as L,J as ce,P as o,Q as r,R as e,ah as V,av as Q,a5 as S,aw as R,U as n,W as h,Z as g,ap as Y,T as F,S as U}from"./pinia-BDOwh8JO.js";import{_ as pe,i as fe,b as k,e as ve}from"./app-D-g1j7c6.js";import{S as _}from"./sweetalert2.esm.all-9Qm2jZ7z.js";const ge={class:"content-header py-1"},ke={class:"container-fluid"},_e={class:"row align-items-center mb-2"},be={class:"col-12 col-md-5 col-lg-4 mt-2 mt-md-0"},ye={class:"input-group input-group-sm"},he=["value"],we={class:"row"},xe={class:"col-12"},De={class:"d-flex flex-wrap align-items-center justify-content-between justify-content-md-end"},Ce={type:"button",class:"btn btn-info btn-sm font-weight-bold mb-2 mb-md-0 mr-md-2 d-inline-flex align-items-center",disabled:""},Ae={key:0,class:"fas fa-spinner fa-spin mr-1"},Pe={key:1,class:"fas fa-inbox mr-1"},Ve={class:"btn-group btn-group-sm"},Se=["disabled"],Ge={key:0,class:"fas fa-spinner fa-spin mr-1"},Ie={class:"content"},Ne={class:"container-fluid"},Me={class:"card"},je={class:"card-header d-flex"},Le={class:"card-body table-responsive p-0"},Re={class:"table table-bordered table-hover text-sm"},Fe={key:0},Ue={key:1},$e={class:"text-truncate",style:{"max-width":"240px"}},Be=["onClick"],Ee=["onClick","disabled"],Te={key:0,class:"fas fa-spinner fa-spin mr-1"},He={class:"card-footer clearfix"},We={class:"d-flex justify-content-between align-items-center"},Je={class:"text-muted"},ze={class:"pagination pagination-sm m-0"},Ke={class:"page-item disabled"},qe={class:"page-link"},Oe={class:"modal fade",id:"verifModal",tabindex:"-1",role:"dialog"},Qe={class:"modal-dialog modal-fullscreen",role:"document"},Ye={class:"modal-content"},Ze={class:"modal-body row"},Xe={class:"col-md-7"},et={class:"border rounded p-2",style:{height:"500px",overflow:"hidden"}},tt=["src"],at={key:1,class:"text-muted text-center py-5"},st={key:0},nt={key:1},lt={class:"col-md-5"},it={class:"mb-3"},ot={class:"table table-bordered table-sm"},rt=["innerHTML"],ut={style:{"font-size":"smaller"}},dt={class:"form-group"},mt={key:0,class:"form-group"},ct=["value"],pt={class:"form-group"},ft={class:"text-end mt-3"},vt=["disabled"],gt={key:0,class:"fas fa-spinner fa-spin me-1"},kt={__name:"VervalList",setup(_t){const B=fe();B.setting.maintenance=["1",1,!0,"true","on"].includes(B.setting.maintenance);const G=d([]),b=d(""),w=d(""),y=d([]),I=d(!1),x=d(!1),D=d(!1),C=d(null),A=d(null),Z=O(()=>A.value===null?"—":A.value),N=d(!1),X=d(null),p=d(!1),m=d(null),c=d({status:"",verif_notes:""}),ee=/iPhone|iPad|iPod|Android/i.test(navigator.userAgent),te=O(()=>{var t;const a=(t=m.value)==null?void 0:t.file_url;return a?ee?`https://docs.google.com/gview?url=${encodeURIComponent(a)}`:a:""}),u=d({current_page:1,per_page:10,total:0,from:0,to:0,last_page:1}),ae=[{code:"G001",note:"Dokumen yang diunggah tidak sesuai dengan jenis dokumen yang dipilih."},{code:"G002",note:"Identitas pada dokumen tidak sesuai dengan data pegawai."},{code:"G003",note:"Dokumen bukan termasuk dokumen resmi yang dibutuhkan."},{code:"G004",note:"Informasi pada dokumen tidak terbaca dengan jelas (buram/tidak fokus)."},{code:"G005",note:"Dokumen tidak mencantumkan informasi identitas penting (nama, tanggal lahir, NIP/NIM, dsb.)."},{code:"G006",note:"Dokumen tidak mencantumkan cap resmi, tanda tangan, atau atribut legalitas lainnya."},{code:"G007",note:"Format atau isi dokumen tidak relevan dengan tujuan verifikasi."},{code:"G008",note:"Dokumen rusak atau tidak dapat dibuka."},{code:"G009",note:"Tanggal dokumen tidak valid atau tidak sesuai konteks."},{code:"G010",note:"Dokumen mengandung data palsu atau terindikasi tidak asli."}],E=a=>{if(a==null||a===""||a==="null")return null;const t=parseInt(a,10);return Number.isNaN(t)?null:t},se=async()=>{try{const{data:a}=await k.get("/api/work-units/monitor");G.value=Array.isArray(a)?a:(a==null?void 0:a.data)||[]}catch{G.value=[]}},M=async(a=1)=>{I.value=!0;try{const t=await k.get("/api/emp-documents",{params:{search:w.value,page:a,per_page:u.value.per_page}});y.value=t.data.data||[],u.value={...u.value,...t.data.meta,...t.data}}catch(t){console.error("Gagal memuat dokumen",t)}finally{I.value=!1}},T=async()=>{N.value=!0;try{const a={},t=E(b.value);t!==null&&(a.id_work_unit=t);const{data:l}=await k.get("/api/emp-documents/remaining",{params:a});A.value=typeof(l==null?void 0:l.remaining)=="number"?l.remaining:null}catch{A.value=null}finally{N.value=!1}},f=async()=>{await Promise.all([M(u.value.current_page),T()])},ne=async()=>{var a,t;D.value=!0;try{const l={count:5},v=E(b.value);v!==null&&(l.id_work_unit=v);const{data:i}=await k.post("/api/emp-documents/claim",l);await f();const P=(i==null?void 0:i.claimed)??(Array.isArray(i==null?void 0:i.data)?i.data.length:i!=null&&i.data?1:0);_.fire({icon:"success",title:"Berhasil",text:`${P} dokumen berhasil diambil dari antrian.`,timer:1800,showConfirmButton:!1}),Array.isArray(i==null?void 0:i.data)&&i.data.length?j(i.data[0]):y.value.length&&j(y.value[0])}catch(l){const v=((t=(a=l==null?void 0:l.response)==null?void 0:a.data)==null?void 0:t.message)||"Tidak ada dokumen tersedia untuk di-claim";_.fire({icon:"info",title:"Info",text:v})}finally{D.value=!1}},le=async a=>{if(!(!(a!=null&&a.id)||!confirm("Lepaskan assignment dokumen ini? Dokumen akan kembali ke antrian umum."))){C.value=a.id;try{await k.post(`/api/emp-documents/${a.id}/release`),await f(),_.fire({icon:"success",title:"Dilepas",text:"Dokumen berhasil dilepas dari tugas Anda.",timer:1500,showConfirmButton:!1})}catch{_.fire({icon:"error",title:"Gagal",text:"Gagal melepas dokumen."})}finally{C.value=null}}},H=a=>{a>=1&&a<=u.value.last_page&&M(a)},j=a=>{m.value=a,c.value={status:a.status==="Pending"?"Approved":a.status,verif_notes:a.verif_notes||""},$("#verifModal").modal("show")},ie=async()=>{x.value=!0;try{const a=await k.put(`/api/emp-documents/${m.value.id}/verify`,c.value);$("#verifModal").modal("hide"),await f(),_.fire({icon:"success",title:"Berhasil",text:a.data.message||"Dokumen berhasil diverifikasi.",timer:2e3,showConfirmButton:!1})}catch(a){let t="Gagal memverifikasi dokumen.";a.response&&(a.response.status===409&&a.response.data.code==="DOCUMENT_ALREADY_VERIFIED"||a.response.data.message)&&(t=a.response.data.message),_.fire({icon:"error",title:"Verifikasi Gagal",text:t}),$("#verifModal").modal("hide"),await f()}finally{x.value=!1}},oe=a=>{const t=a.target.value;t&&(c.value.verif_notes=t)},re=()=>{p.value=!1},ue=()=>{p.value=!0};return L(()=>{var a;return(a=m.value)==null?void 0:a.file_url},async a=>{var t;if(p.value=!1,!!a)try{const l=await fetch(a,{method:"HEAD"});(!l.ok||!((t=l.headers.get("content-type"))!=null&&t.includes("pdf")))&&(p.value=!0)}catch{p.value=!0}}),L(w,ve(()=>M(1),300)),L(b,()=>T()),ce(async()=>{await se(),await f()}),(a,t)=>{var l,v,i,P,W,J,z,K,q;return r(),o(S,null,[e("section",ge,[e("div",ke,[e("div",_e,[t[8]||(t[8]=e("div",{class:"col-12 col-md-7 col-lg-8"},[e("h1",{class:"m-0 font-weight-bold text-dark text-truncate"}," Verifikasi Dokumen Pegawai ")],-1)),e("div",be,[e("div",ye,[V(e("select",{"onUpdate:modelValue":t[0]||(t[0]=s=>b.value=s),class:"form-control form-control-sm"},[t[7]||(t[7]=e("option",{value:""},"Semua Unit Kerja",-1)),(r(!0),o(S,null,R(G.value,s=>(r(),o("option",{key:s.id,value:String(s.id)},n(s.unit_code)+" — "+n(s.unit_name),9,he))),128))],512),[[Q,b.value]])])])]),e("div",we,[e("div",xe,[e("div",De,[e("button",Ce,[N.value?(r(),o("i",Ae)):(r(),o("span",Pe)),e("span",null,"Sisa: "+n(Z.value),1)]),e("div",Ve,[e("button",{class:"btn btn-outline-primary",onClick:ne,disabled:D.value},[D.value?(r(),o("i",Ge)):h("",!0),t[9]||(t[9]=g(" Ambil 5 Dokumen "))],8,Se),e("button",{class:"btn btn-secondary",onClick:f},"Refresh")])])])])])]),e("section",Ie,[e("div",Ne,[e("div",Me,[e("div",je,[V(e("input",{"onUpdate:modelValue":t[1]||(t[1]=s=>w.value=s),type:"text",class:"form-control mr-2",placeholder:"Cari nama atau NIP pegawai (tugas saya)..."},null,512),[[Y,w.value]]),e("button",{class:"btn btn-secondary btn-sm",onClick:f}," Refresh ")]),e("div",Le,[e("table",Re,[t[14]||(t[14]=e("thead",null,[e("tr",null,[e("th",null,"#"),e("th",null,"Nama"),e("th",null,"NIP"),e("th",null,"Jenis Dokumen"),e("th",null,"Nama File"),e("th",null,"Status"),e("th",{style:{width:"160px"}},"Aksi")])],-1)),e("tbody",null,[I.value?(r(),o("tr",Fe,t[10]||(t[10]=[e("td",{colspan:"7",class:"text-center"},"Memuat data...",-1)]))):y.value.length===0?(r(),o("tr",Ue,t[11]||(t[11]=[e("td",{colspan:"7",class:"text-center"},[g(" Belum ada dokumen yang ditugaskan ke Anda. "),e("br"),e("small",{class:"text-muted"},"Klik “Ambil 5 Dokumen” untuk mengambil dari antrian umum.")],-1)]))):h("",!0),(r(!0),o(S,null,R(y.value,(s,de)=>(r(),o("tr",{key:s.id},[e("td",null,n(de+1+(u.value.current_page-1)*u.value.per_page),1),e("td",null,[g(n(s.employee.full_name)+" ",1),t[12]||(t[12]=e("br",null,null,-1)),e("strong",null,n(s.employee.workunit.unit_name),1)]),e("td",null,n(s.employee.nip),1),e("td",null,n(s.doc_type.type_name),1),e("td",$e,n(s.file_name),1),e("td",null,[e("span",{class:F({"badge badge-warning":s.status==="Pending","badge badge-success":s.status==="Approved","badge badge-danger":s.status==="Rejected"})},n(s.status),3)]),e("td",null,[e("button",{class:"btn btn-sm btn-primary mr-1 mb-1",onClick:me=>j(s)}," Verifikasi ",8,Be),e("button",{class:"btn btn-sm btn-outline-danger",onClick:me=>le(s),disabled:C.value===s.id,title:"Lepaskan assignment dokumen ini"},[C.value===s.id?(r(),o("i",Te)):h("",!0),t[13]||(t[13]=g(" Lepas "))],8,Ee)])]))),128))])])]),e("div",He,[e("div",We,[e("div",Je," Menampilkan "+n(u.value.from)+" - "+n(u.value.to)+" dari "+n(u.value.total)+" dokumen (tugas saya) ",1),e("ul",ze,[e("li",{class:F(["page-item",{disabled:u.value.current_page===1}])},[e("a",{class:"page-link",href:"#",onClick:t[2]||(t[2]=U(s=>H(u.value.current_page-1),["prevent"]))},"«")],2),e("li",Ke,[e("span",qe,"Halaman "+n(u.value.current_page)+" / "+n(u.value.last_page),1)]),e("li",{class:F(["page-item",{disabled:u.value.current_page===u.value.last_page}])},[e("a",{class:"page-link",href:"#",onClick:t[3]||(t[3]=U(s=>H(u.value.current_page+1),["prevent"]))},"»")],2)])])])])]),e("div",Oe,[e("div",Qe,[e("div",Ye,[t[27]||(t[27]=e("div",{class:"modal-header py-2"},[e("h5",{class:"modal-title"},"Verifikasi Dokumen Pegawai"),e("button",{type:"button",class:"close","data-dismiss":"modal","aria-label":"Close"},[e("span",{"aria-hidden":"true"},"×")])],-1)),e("div",Ze,[e("div",Xe,[e("div",et,[(l=m.value)!=null&&l.file_url&&!p.value?(r(),o("iframe",{key:0,ref_key:"pdfFrame",ref:X,src:te.value,width:"100%",height:"100%",frameborder:"0",style:{border:"1px solid #ccc"},onLoad:re,onError:ue},null,40,tt)):(r(),o("div",at,[p.value?(r(),o("p",st,"Gagal memuat dokumen. Pastikan file tersedia dan dapat diakses.")):(r(),o("p",nt,"File tidak tersedia."))]))])]),e("div",lt,[e("div",it,[e("table",ot,[e("tbody",null,[e("tr",null,[t[16]||(t[16]=e("th",null,"Nama",-1)),e("td",null,[g(n(((i=(v=m.value)==null?void 0:v.employee)==null?void 0:i.full_name)||"-"),1),t[15]||(t[15]=e("br",null,null,-1))])]),e("tr",null,[t[17]||(t[17]=e("th",null,"NIP",-1)),e("td",null,n(((W=(P=m.value)==null?void 0:P.employee)==null?void 0:W.nip)||"-"),1)]),e("tr",null,[t[18]||(t[18]=e("th",null,"Jenis Dokumen",-1)),e("td",null,n(((z=(J=m.value)==null?void 0:J.doc_type)==null?void 0:z.type_name)||"-"),1)]),e("tr",null,[t[19]||(t[19]=e("th",null,"Parameter",-1)),e("td",{innerHTML:((K=m.value)==null?void 0:K.parameter)||"<i>no_param</i>"},null,8,rt)]),e("tr",null,[t[20]||(t[20]=e("th",null,"Filename",-1)),e("td",ut,n(((q=m.value)==null?void 0:q.file_name)||"-"),1)])])])]),e("form",{onSubmit:U(ie,["prevent"])},[e("div",dt,[t[22]||(t[22]=e("label",null,"Status Verifikasi",-1)),V(e("select",{"onUpdate:modelValue":t[4]||(t[4]=s=>c.value.status=s),class:"form-control",required:""},t[21]||(t[21]=[e("option",{value:"Approved"},"Disetujui",-1),e("option",{value:"Rejected"},"Ditolak",-1)]),512),[[Q,c.value.status]])]),c.value.status==="Rejected"?(r(),o("div",mt,[t[24]||(t[24]=e("label",null,"Pilih Alasan Penolakan (opsional)",-1)),e("select",{class:"form-control mb-2",onChange:t[5]||(t[5]=s=>oe(s))},[t[23]||(t[23]=e("option",{value:""},"-- Pilih alasan penolakan standar --",-1)),(r(),o(S,null,R(ae,s=>e("option",{key:s.code,value:s.note},n(s.code)+" - "+n(s.note),9,ct)),64))],32)])):h("",!0),e("div",pt,[t[25]||(t[25]=e("label",null,"Catatan Verifikasi",-1)),V(e("textarea",{"onUpdate:modelValue":t[6]||(t[6]=s=>c.value.verif_notes=s),class:"form-control",rows:"4",placeholder:"Tulis catatan jika dokumen ditolak..."},null,512),[[Y,c.value.verif_notes]])]),e("div",ft,[e("button",{type:"submit",class:"btn btn-sm btn-primary",disabled:x.value},[x.value?(r(),o("i",gt)):h("",!0),t[26]||(t[26]=g(" Simpan Verifikasi "))],8,vt)])],32)])])])])])])],64)}}},wt=pe(kt,[["__scopeId","data-v-020cbe93"]]);export{wt as default};
