import{F as i,G as S,J as F,P as r,Q as u,R as e,ah as v,av as R,Z as O,ap as A,W as h,a5 as j,aw as D,U as n,T as E,S as B,aj as Q,x as H}from"./pinia-BDOwh8JO.js";import{a as N}from"./api-CIOX86af.js";import{b as W,u as X,e as z}from"./app-D-g1j7c6.js";import{S as o}from"./sweetalert2.esm.all-9Qm2jZ7z.js";W.create({withCredentials:!1,headers:{"X-Requested-With":"XMLHttpRequest"}});const I={class:"content"},J={class:"container-fluid"},Y={class:"card"},Z={class:"card-header"},K={class:"d-flex justify-content-between align-items-center"},ee={class:"d-flex align-items-center gap-2"},te={class:"card-body table-responsive p-0"},ae={class:"table table-bordered table-hover text-sm mb-0"},se={key:0},le={key:1},ne={class:"text-muted"},ie=["onClick"],oe={class:"text-center"},re=["onClick"],ue={class:"card-footer clearfix py-2"},de={class:"d-flex justify-content-between align-items-center"},me={class:"text-muted text-sm"},ce={class:"pagination pagination-sm m-0"},pe={class:"page-item disabled"},ve={class:"page-link"},be={class:"modal fade",id:"verifyModal"},fe={class:"modal-dialog modal-lg modal-dialog-centered modal-dialog-scrollable"},ge={key:0,class:"modal-content"},ye={class:"modal-header"},ke={class:"text-muted"},he={class:"modal-body"},xe={class:"border rounded p-2 mb-3"},_e={class:"d-flex justify-content-between"},we={class:"d-flex justify-content-between"},Ce={class:"text-danger"},je={class:"mb-3 text-center"},Be={key:0,class:"d-flex justify-content-center align-items-center",style:{height:"360px"}},Pe=["src"],Ve={key:1,class:"text-danger text-sm"},Me={class:"form-group"},Te=["value"],$e={class:"modal-footer py-2"},Le=["disabled"],Se=["disabled"],Ue={__name:"PaymentVerificationQueue",setup(Re){const P=o.mixin({toast:!0,position:"top-end",showConfirmButton:!1,timer:2500,timerProgressBar:!0,didOpen:l=>{l.addEventListener("mouseenter",o.stopTimer),l.addEventListener("mouseleave",o.resumeTimer)}}),U=[{value:"",label:"-- Pilih template catatan --"},{value:"Bukti pembayaran tidak jelas atau buram. Mohon unggah ulang bukti pembayaran yang lebih jelas.",label:"Bukti tidak jelas / buram"},{value:"Nominal pembayaran tidak sesuai dengan tagihan yang tertera di sistem.",label:"Nominal tidak sesuai"},{value:"Bukti pembayaran bukan milik peserta yang bersangkutan.",label:"Bukti bukan milik peserta"},{value:"Pembayaran belum masuk ke rekening tujuan. Silakan konfirmasi ulang.",label:"Dana belum masuk"},{value:"Bukti pembayaran valid dan sesuai. Pembayaran disetujui.",label:"Pembayaran valid (approve)"}],b=i(""),G=()=>{b.value&&(m.value=b.value)};X();const x=i([]),s=i({}),f=i(""),g=i(10),_=i(!1),d=i(null),m=i(""),y=i(!1),c=i(!0),k=i(!1),V=l=>{d.value=l,m.value="",c.value=!0,k.value=!1,$("#verifyModal").modal("show")},p=async(l=1)=>{_.value=!0;try{const t=await N.get("/api/v1/payment-verifications/queue",{params:{page:l,per_page:g.value,search:f.value}});x.value=t.data.data.data,s.value=t.data.data}catch{o.fire({icon:"error",title:"Gagal",text:"Gagal memuat data pembayaran"})}finally{_.value=!1}},M=async l=>{if(l==="reject"&&!m.value.trim()){o.fire({icon:"warning",title:"Catatan wajib",text:"Catatan wajib diisi untuk reject"});return}if((await o.fire({title:l==="approve"?"Approve pembayaran?":"Reject pembayaran?",icon:"question",showCancelButton:!0,confirmButtonText:"Ya",cancelButtonText:"Batal"})).isConfirmed){y.value=!0,o.fire({title:"Memproses...",allowOutsideClick:!1,didOpen:()=>o.showLoading()});try{await N.post(`/api/v1/payment-verifications/${d.value.id}/verify`,{action:l,notes:m.value}),o.close(),$("#verifyModal").modal("hide"),p(s.value.current_page),P.fire({icon:"success",title:"Verifikasi pembayaran berhasil"})}catch{o.close(),o.fire({icon:"error",title:"Gagal",text:"Verifikasi pembayaran gagal"})}finally{y.value=!1}}},T=l=>Number(l).toLocaleString("id-ID");return S(f,z(()=>p(1),400)),S(g,()=>p(1)),F(p),(l,t)=>{var w;return u(),r(j,null,[t[26]||(t[26]=e("section",{class:"content-header"},[e("div",{class:"container-fluid"},[e("h1",{class:"mb-1"},"Payment Verification Queue"),e("p",{class:"mb-0 text-muted text-sm"}," Antrian pembayaran menunggu verifikasi ")])],-1)),e("section",I,[e("div",J,[e("div",Y,[e("div",Z,[e("div",K,[e("div",ee,[t[13]||(t[13]=e("label",{class:"mb-0 mr-2 text-sm text-muted"},"Tampilkan",-1)),v(e("select",{"onUpdate:modelValue":t[0]||(t[0]=a=>g.value=a),class:"form-control form-control-sm w-auto"},t[11]||(t[11]=[e("option",{value:10},"10",-1),e("option",{value:25},"25",-1),e("option",{value:50},"50",-1)]),512),[[R,g.value,void 0,{number:!0}]]),t[14]||(t[14]=e("span",{class:"text-sm text-muted ml-1 mr-3"},"Entri",-1)),e("button",{class:"btn btn-outline-secondary btn-sm",title:"Refresh data",onClick:t[1]||(t[1]=a=>p(s.value.current_page||1))},t[12]||(t[12]=[e("i",{class:"fas fa-sync"},null,-1),O(" Refresh ")]))]),v(e("input",{"onUpdate:modelValue":t[2]||(t[2]=a=>f.value=a),class:"form-control form-control-sm w-auto",style:{"min-width":"260px"},placeholder:"Cari peserta / email"},null,512),[[A,f.value]])])]),e("div",te,[e("table",ae,[t[18]||(t[18]=e("thead",{class:"thead-light"},[e("tr",null,[e("th",{style:{width:"40px"}},"#"),e("th",null,"Peserta"),e("th",null,"Bank"),e("th",null,"Amount"),e("th",null,"Proof"),e("th",{style:{width:"120px"},class:"text-center"},"Aksi")])],-1)),e("tbody",null,[_.value?(u(),r("tr",se,t[15]||(t[15]=[e("td",{colspan:"6",class:"text-center"},"Memuat data...",-1)]))):x.value.length===0?(u(),r("tr",le,t[16]||(t[16]=[e("td",{colspan:"6",class:"text-center text-muted"}," Tidak ada pembayaran pending ",-1)]))):h("",!0),(u(!0),r(j,null,D(x.value,(a,C)=>{var L;return u(),r("tr",{key:a.id},[e("td",null,n(C+1+(s.value.current_page-1)*s.value.per_page),1),e("td",null,[e("strong",null,n(a.registration.participant.full_name),1),t[17]||(t[17]=e("br",null,null,-1)),e("small",ne,n(a.registration.participant.email),1)]),e("td",null,n(((L=a.registration.bank)==null?void 0:L.name)||"-"),1),e("td",null," Rp "+n(T(a.amount)),1),e("td",null,[e("a",{href:"#",onClick:B(q=>V(a),["prevent"])},"Lihat",8,ie)]),e("td",oe,[e("button",{class:"btn btn-primary btn-sm",onClick:q=>V(a)}," Verifikasi ",8,re)])])}),128))])])]),e("div",ue,[e("div",de,[e("div",me," Menampilkan "+n(s.value.from||0)+" - "+n(s.value.to||0)+" dari "+n(s.value.total||0)+" data ",1),e("ul",ce,[e("li",{class:E(["page-item",{disabled:s.value.current_page===1}])},[e("a",{href:"#",class:"page-link",onClick:t[3]||(t[3]=B(a=>l.changePage(s.value.current_page-1),["prevent"]))},"«")],2),e("li",pe,[e("span",ve," Halaman "+n(s.value.current_page)+" / "+n(s.value.last_page),1)]),e("li",{class:E(["page-item",{disabled:s.value.current_page===s.value.last_page}])},[e("a",{href:"#",class:"page-link",onClick:t[4]||(t[4]=B(a=>l.changePage(s.value.current_page+1),["prevent"]))},"»")],2)])])])])])]),e("div",be,[e("div",fe,[d.value?(u(),r("div",ge,[e("div",ye,[e("div",null,[t[19]||(t[19]=e("h5",{class:"mb-0"},"Verifikasi Pembayaran",-1)),e("small",ke,n(d.value.registration.participant.full_name),1)]),t[20]||(t[20]=e("button",{class:"close","data-dismiss":"modal"},"×",-1))]),e("div",he,[e("div",xe,[e("div",_e,[t[21]||(t[21]=e("span",null,"Bank",-1)),e("strong",null,n((w=d.value.registration.bank)==null?void 0:w.name),1)]),e("div",we,[t[22]||(t[22]=e("span",null,"Amount",-1)),e("strong",Ce," Rp "+n(T(d.value.amount)),1)])]),e("div",je,[c.value?(u(),r("div",Be,t[23]||(t[23]=[e("div",{class:"spinner-border text-primary",role:"status"},[e("span",{class:"sr-only"},"Loading...")],-1)]))):h("",!0),v(e("img",{src:`/api/v1/secure/payments/proof/${d.value.id}`,class:"img-fluid rounded border",style:{"max-height":"360px"},onLoad:t[5]||(t[5]=a=>c.value=!1),onError:t[6]||(t[6]=a=>{c.value=!1,k.value=!0,H(P).fire({icon:"error",title:"Bukti pembayaran gagal dimuat"})})},null,40,Pe),[[Q,!c.value&&!k.value]]),k.value?(u(),r("div",Ve," Gagal memuat bukti pembayaran ")):h("",!0)]),e("div",Me,[t[24]||(t[24]=e("label",{class:"text-sm"}," Catatan Verifikasi (wajib jika reject) ",-1)),v(e("select",{class:"form-control form-control-sm mb-2","onUpdate:modelValue":t[7]||(t[7]=a=>b.value=a),onChange:G},[(u(),r(j,null,D(U,(a,C)=>e("option",{key:C,value:a.value},n(a.label),9,Te)),64))],544),[[R,b.value]]),v(e("textarea",{"onUpdate:modelValue":t[8]||(t[8]=a=>m.value=a),class:"form-control form-control-sm",rows:"3",placeholder:"Catatan bisa diedit atau ditambahkan..."},null,512),[[A,m.value]])])]),e("div",$e,[t[25]||(t[25]=e("button",{class:"btn btn-secondary btn-sm","data-dismiss":"modal"}," Batal ",-1)),e("button",{class:"btn btn-danger btn-sm",disabled:y.value,onClick:t[9]||(t[9]=a=>M("reject"))}," Reject ",8,Le),e("button",{class:"btn btn-success btn-sm",disabled:y.value,onClick:t[10]||(t[10]=a=>M("approve"))}," Approve ",8,Se)])])):h("",!0)])])],64)}}};export{Ue as default};
