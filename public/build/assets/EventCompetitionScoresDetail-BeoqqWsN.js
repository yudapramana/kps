import{z as pe,y as C,A as y,M as ge,O,V as he,B as l,C as o,D as e,I as Q,K as j,J as c,H as te,S as W,aB as ne,U as _,ay as b,as as be,aD as ye,a as se,L as xe,F as we}from"./AuthUserStore-67h2FHdL.js";import{S as le}from"./sweetalert2.esm.all-9Qm2jZ7z.js";import{_ as ke}from"./app-CZBZEz52.js";const Ce={class:"content-header"},Se={class:"container-fluid"},Me={class:"d-flex justify-content-between align-items-center"},Ne={class:"mb-0 text-muted text-sm"},$e={key:0,class:"ml-2"},je=["disabled"],De={class:"row mt-3"},Ie={class:"col-md-12 mb-2"},Ae=["disabled"],Be=["label"],Fe=["value"],Ke={key:0,class:"text-muted"},Te={class:"row"},Ue={class:"col-md-6 mb-2"},Ve=["placeholder","disabled"],Pe={class:"col-md-3 mb-2"},Re=["disabled"],Le={class:"col-md-3 mb-2"},Ee=["disabled"],Ge={key:0,class:"mb-2"},qe={class:"nav nav-pills"},ze=["onClick"],He={class:"badge badge-light border ml-2"},Je={class:"content"},Oe={class:"container-fluid"},Qe={class:"card"},We={class:"card-body table-responsive p-0"},Xe={class:"table table-bordered table-hover text-sm mb-0"},Ye={class:"thead-light"},Ze=["colspan"],et={key:0},tt=["colspan"],nt={key:1},st=["colspan"],lt={key:2},ot=["colspan"],at={key:3},it=["colspan"],rt={class:"text-center"},dt={class:"font-weight-bold"},ct={class:"text-center font-weight-bold"},ut={class:"text-center font-weight-bold"},vt={class:"text-center font-weight-bold"},mt={class:"text-center"},_t={class:"text-center"},ft={class:"font-weight-bold"},pt={class:"text-center font-weight-bold"},gt={class:"text-center font-weight-bold"},ht={class:"text-center"},bt={class:"card-footer text-muted text-sm"},yt={__name:"EventCompetitionScoresDetail",setup(xt){const U=ge(),oe=xe(),ae=pe(),ie=C(()=>ae.eventData||null),V=C(()=>{var s;return((s=ie.value)==null?void 0:s.id)||null}),A=y("all"),f=y(String(U.params.id||"")),X=C(()=>f.value||null),P=y(!1),Y=y([]),B=y(!1),q=y(""),z=y(""),F=y(null),g=y([]),D=y([]),x=y([]),h=C(()=>{var n;const s=F.value||{};return typeof s.is_team<"u"?!!s.is_team:!!((n=s==null?void 0:s.event_group)!=null&&n.is_team)}),Z=C(()=>{const s=D.value||[];if(h.value)return[{id:"all",name:"Semua Kontingen",count:s.length}];const n=new Map;for(const d of s){const t=String((d==null?void 0:d.event_category_id)||"");if(!t)continue;const i=(d==null?void 0:d.category_name)||(d==null?void 0:d.category)||"-";n.has(t)||n.set(t,{id:t,name:i,count:0}),n.get(t).count++}return[{id:"all",name:"Semua Peserta",count:s.length},...Array.from(n.values())]}),R=C(()=>h.value?D.value||[]:A.value==="all"?D.value||[]:(D.value||[]).filter(s=>String((s==null?void 0:s.event_category_id)||"")===String(A.value)));O(()=>f.value,()=>{A.value="all"});const re=async()=>{if(V.value){P.value=!0;try{const{data:s}=await se.get(`/api/v1/events/${V.value}/competitions/tree`);Y.value=s.rounds||[]}catch(s){console.error(s),le.fire("Gagal","Gagal memuat daftar kompetisi.","error")}finally{P.value=!1}}},$=async()=>{if(!X.value){F.value=null,g.value=[],D.value=[],x.value=[];return}B.value=!0;try{const{data:s}=await se.get(`/api/v1/event-competitions/${X.value}/scores-detail`,{params:{search:q.value||void 0,status:z.value||void 0}});F.value=s.competition,g.value=s.judges||[],D.value=s.participants||[],x.value=s.fields||[]}finally{B.value=!1}},de=async s=>{s&&String(U.params.id)!==String(s)&&await oe.replace({name:"admin.event.scores.detail.index",params:{id:String(s)},query:{...U.query}})},S=s=>Number(s??0).toFixed(2),ce=s=>`H${s+1}`,ee=(s,n)=>{const d=(g.value||[]).map(i=>{var r,a,u;return(u=(a=(r=s==null?void 0:s.field_scores)==null?void 0:r[i.id])==null?void 0:a[n])==null?void 0:u.score}).filter(i=>i!=null&&i!=="");if(!d.length)return null;const t=d.reduce((i,r)=>i+Number(r),0);return Math.round(t/d.length*100)/100},ue=(s=[],n=14)=>{const d=Array.isArray(s)?s.filter(Boolean):[];return d.length?d.length<=n?d.join(", "):`${d.slice(0,n).join(", ")}, ...`:"-"},ve=(s,n,d)=>{var i,r,a;const t=(a=(r=(i=s==null?void 0:s.field_scores)==null?void 0:i[n])==null?void 0:r[d])==null?void 0:a.score;return t==null||t===""?null:Number(t)},H=C(()=>{var i,r;if(!h.value)return[];const s=R.value||[],n=new Map;for(const a of s){const u=String((a==null?void 0:a.contingent)||"-");n.has(u)||n.set(u,{contingent:u,members:[],fieldCollector:{},totalCollector:{}});const v=n.get(u);v.members.push((a==null?void 0:a.full_name)||"-");for(const w of g.value||[]){const m=w.id;if(!((a==null?void 0:a.scores)&&typeof a.scores[m]<"u"))continue;const p=Number(a.scores[m]??0);v.totalCollector[m]||(v.totalCollector[m]=[]),v.totalCollector[m].push(p)}for(const w of x.value||[]){const m=w.event_field_component_id;v.fieldCollector[m]||(v.fieldCollector[m]={});for(const k of g.value||[]){const p=k.id,E=ve(a,p,m);E!==null&&(v.fieldCollector[m][p]||(v.fieldCollector[m][p]=[]),v.fieldCollector[m][p].push(E))}}}const d=Array.from(n.keys()).sort((a,u)=>a==="-"?1:u==="-"?-1:a.localeCompare(u)),t=[];for(const a of d){const u=n.get(a),v={},w={};for(const J of x.value||[]){const M=J.event_field_component_id;v[M]={};const N=[];for(const K of g.value||[]){const I=K.id,T=((r=(i=u.fieldCollector)==null?void 0:i[M])==null?void 0:r[I])||[],G=T.length?T.reduce((_e,fe)=>_e+fe,0)/T.length:null;v[M][I]=G!==null?Number(G.toFixed(2)):null,G!==null&&N.push(G)}w[M]=N.length?Number((N.reduce((K,I)=>K+I,0)/N.length).toFixed(2)):null}const m={};let k=0,p=0;for(const J of g.value||[]){const M=J.id,N=u.totalCollector[M]||[],K=N.length?N.reduce((I,T)=>I+T,0)/N.length:0;m[M]=Number(K.toFixed(2)),k+=m[M],p++}const E=p?k/p:0;t.push({contingent:u.contingent,members:u.members,member_count:u.members.length,field_scores:v,field_avg:w,total_by_judge:m,sum_score:Number(k.toFixed(2)),avg_score:Number(E.toFixed(2))})}return t}),me=C(()=>h.value?4:3),L=C(()=>me.value+x.value.length*((g.value.length||0)+1)+2);return he(async()=>{if(!V.value){le.fire("Event belum dipilih","Silakan pilih event terlebih dahulu.","info");return}await re(),f.value&&await $()}),O(()=>U.params.id,async s=>{f.value=String(s||""),await $()}),O(()=>f.value,async s=>{s&&(await de(s),await $())}),(s,n)=>{var d;return o(),l(_,null,[e("section",Ce,[e("div",Se,[e("div",Me,[e("div",null,[n[3]||(n[3]=e("h1",{class:"mb-1"},"Rekap Nilai Kompetisi",-1)),e("p",Ne,[j(c(((d=F.value)==null?void 0:d.full_name)||"Pilih kompetisi terlebih dahulu.")+" ",1),f.value&&F.value?(o(),l("span",$e,[e("span",{class:te(["badge",h.value?"badge-info":"badge-secondary"])},c(h.value?"TEAM / GROUP (By Kontingen)":"INDIVIDU"),3)])):Q("",!0)])]),e("button",{class:"btn btn-sm btn-outline-secondary",onClick:$,disabled:B.value||!f.value},n[4]||(n[4]=[e("i",{class:"fas fa-sync"},null,-1),j(" Refresh ")]),8,je)]),e("div",De,[e("div",Ie,[n[7]||(n[7]=e("label",{class:"mb-1 text-sm"},[j("Kompetisi "),e("span",{class:"text-danger"},"*")],-1)),W(e("select",{"onUpdate:modelValue":n[0]||(n[0]=t=>f.value=t),class:"form-control form-control-sm",disabled:!V.value||P.value},[n[5]||(n[5]=e("option",{value:"",disabled:""},"-- Pilih Kompetisi --",-1)),(o(!0),l(_,null,b(Y.value,t=>(o(),l("optgroup",{key:"round-"+t.id,label:t.name},[(o(!0),l(_,null,b(t.competitions,i=>(o(),l("option",{key:i.id,value:String(i.id)},c(i.full_name),9,Fe))),128))],8,Be))),128))],8,Ae),[[ne,f.value]]),P.value?(o(),l("small",Ke,n[6]||(n[6]=[e("i",{class:"fas fa-spinner fa-spin mr-1"},null,-1),j(" Memuat daftar kompetisi... ")]))):Q("",!0)])]),e("div",Te,[e("div",Ue,[W(e("input",{"onUpdate:modelValue":n[1]||(n[1]=t=>q.value=t),class:"form-control form-control-sm",placeholder:h.value?"Cari kontingen/anggota...":"Cari nama peserta...",disabled:!f.value,onKeyup:ye($,["enter"])},null,40,Ve),[[be,q.value]])]),e("div",Pe,[W(e("select",{"onUpdate:modelValue":n[2]||(n[2]=t=>z.value=t),class:"form-control form-control-sm",disabled:!f.value,onChange:$},n[8]||(n[8]=[e("option",{value:""},"Semua Status",-1),e("option",{value:"draft"},"Draft",-1),e("option",{value:"submitted"},"Submitted",-1),e("option",{value:"locked"},"Locked",-1)]),40,Re),[[ne,z.value]])]),e("div",Le,[e("button",{class:"btn btn-sm btn-primary w-100",onClick:$,disabled:B.value||!f.value},n[9]||(n[9]=[e("i",{class:"fas fa-search"},null,-1),j(" Filter ")]),8,Ee)])]),f.value&&Z.value.length?(o(),l("div",Ge,[e("ul",qe,[(o(!0),l(_,null,b(Z.value,t=>(o(),l("li",{class:"nav-item",key:"tab-"+t.id},[e("a",{href:"#",class:te(["nav-link",{active:A.value===t.id}]),onClick:we(i=>A.value=t.id,["prevent"]),style:{"font-weight":"600"}},[j(c(t.name)+" ",1),e("span",He,c(t.count),1)],10,ze)]))),128))])])):Q("",!0)])]),e("section",Je,[e("div",Oe,[e("div",Qe,[e("div",We,[e("table",Xe,[e("thead",Ye,[e("tr",null,[n[15]||(n[15]=e("th",{rowspan:"2",style:{width:"50px"},class:"align-middle text-center"},"#",-1)),h.value?(o(),l(_,{key:1},[n[12]||(n[12]=e("th",{rowspan:"2",class:"align-middle"},"Kontingen",-1)),n[13]||(n[13]=e("th",{rowspan:"2",class:"align-middle text-center",style:{width:"110px"}},"Jml Anggota",-1)),n[14]||(n[14]=e("th",{rowspan:"2",class:"align-middle"},"Anggota",-1))],64)):(o(),l(_,{key:0},[n[10]||(n[10]=e("th",{rowspan:"2",class:"align-middle"},"Peserta",-1)),n[11]||(n[11]=e("th",{rowspan:"2",class:"align-middle"},"Kontingen",-1))],64)),(o(!0),l(_,null,b(x.value,t=>{var i;return o(),l("th",{key:"g-"+t.event_field_component_id,class:"text-center align-middle",colspan:(((i=g.value)==null?void 0:i.length)||0)+1,style:{"white-space":"nowrap"}},c(t.name),9,Ze)}),128)),n[16]||(n[16]=e("th",{rowspan:"2",class:"text-center align-middle"},"AVG Total",-1)),n[17]||(n[17]=e("th",{rowspan:"2",class:"text-center align-middle"},"SUM Total",-1))]),e("tr",null,[(o(!0),l(_,null,b(x.value,t=>(o(),l(_,{key:"h-"+t.event_field_component_id},[(o(!0),l(_,null,b(g.value,(i,r)=>(o(),l("th",{key:`h-${t.event_field_component_id}-${i.id}`,class:"text-center",style:{"white-space":"nowrap"}},c(ce(r)),1))),128)),n[18]||(n[18]=e("th",{class:"text-center",style:{"white-space":"nowrap"}},"Rerata",-1))],64))),128))])]),e("tbody",null,[f.value?B.value?(o(),l("tr",nt,[e("td",{colspan:L.value,class:"text-center p-3 text-muted"}," Loading... ",8,st)])):h.value&&H.value.length===0?(o(),l("tr",lt,[e("td",{colspan:L.value,class:"text-center p-3 text-muted"}," Tidak ada data. ",8,ot)])):!h.value&&R.value.length===0?(o(),l("tr",at,[e("td",{colspan:L.value,class:"text-center p-3 text-muted"}," Tidak ada data. ",8,it)])):h.value?(o(!0),l(_,{key:4},b(H.value,(t,i)=>(o(),l("tr",{key:"cont-"+t.contingent},[e("td",rt,c(i+1),1),e("td",null,[e("div",dt,c(t.contingent),1)]),e("td",ct,c(t.member_count),1),e("td",null,[e("div",null,c(ue(t.members,16)),1)]),(o(!0),l(_,null,b(x.value,r=>{var a,u;return o(),l(_,{key:"gb-"+r.event_field_component_id},[(o(!0),l(_,null,b(g.value,v=>{var w,m,k,p;return o(),l("td",{key:`gb-${t.contingent}-${r.event_field_component_id}-${v.id}`,class:"text-center"},c(((m=(w=t.field_scores)==null?void 0:w[r.event_field_component_id])==null?void 0:m[v.id])!==null&&((p=(k=t.field_scores)==null?void 0:k[r.event_field_component_id])==null?void 0:p[v.id])!==void 0?S(t.field_scores[r.event_field_component_id][v.id]):"-"),1)}),128)),e("td",ut,c(((a=t.field_avg)==null?void 0:a[r.event_field_component_id])!==null&&((u=t.field_avg)==null?void 0:u[r.event_field_component_id])!==void 0?S(t.field_avg[r.event_field_component_id]):"-"),1)],64)}),128)),e("td",vt,c(S(t.avg_score)),1),e("td",mt,c(S(t.sum_score)),1)]))),128)):(o(!0),l(_,{key:5},b(R.value,(t,i)=>(o(),l("tr",{key:t.event_participant_id},[e("td",_t,c(i+1),1),e("td",null,[e("div",ft,c(t.full_name),1)]),e("td",null,c(t.contingent||"-"),1),(o(!0),l(_,null,b(x.value,r=>(o(),l(_,{key:"b-"+r.event_field_component_id},[(o(!0),l(_,null,b(g.value,a=>{var u,v;return o(),l("td",{key:`b-${t.event_participant_id}-${r.event_field_component_id}-${a.id}`,class:"text-center"},c((v=(u=t.field_scores)==null?void 0:u[a.id])!=null&&v[r.event_field_component_id]?S(t.field_scores[a.id][r.event_field_component_id].score):"-"),1)}),128)),e("td",pt,c(ee(t,r.event_field_component_id)!==null?S(ee(t,r.event_field_component_id)):"-"),1)],64))),128)),e("td",gt,c(S(t.avg_score)),1),e("td",ht,c(S(t.sum_score)),1)]))),128)):(o(),l("tr",et,[e("td",{colspan:L.value,class:"text-center p-3 text-muted"}," Silakan pilih kompetisi terlebih dahulu. ",8,tt)]))])])]),e("div",bt,[n[19]||(n[19]=j(" Total: ")),e("strong",null,c(h.value?H.value.length+" kontingen":R.value.length+" peserta"),1)])])])])],64)}}},St=ke(yt,[["__scopeId","data-v-8979c248"]]);export{St as default};
