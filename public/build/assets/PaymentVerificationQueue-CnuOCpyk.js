import{F as i,G as S,J as O,P as r,Q as u,R as e,ah as g,av as R,Z as Q,ap as A,W as p,a5 as j,aw as E,U as n,T as D,S as B,aj as H}from"./pinia-BDOwh8JO.js";import{a as N}from"./api-B1dFaPBY.js";import{b as W,u as X,e as z}from"./app-qojnDOIY.js";import{S as d}from"./sweetalert2.esm.all-9Qm2jZ7z.js";W.create({withCredentials:!1,headers:{"X-Requested-With":"XMLHttpRequest"}});const I={class:"content"},J={class:"container-fluid"},Y={class:"card"},Z={class:"card-header"},K={class:"d-flex justify-content-between align-items-center"},ee={class:"d-flex align-items-center gap-2"},ae={class:"card-body table-responsive p-0"},te={class:"table table-bordered table-hover text-sm mb-0"},se={key:0},le={key:1},ne={class:"text-muted"},oe=["onClick"],ie={class:"text-center"},re=["onClick"],ue={class:"card-footer clearfix py-2"},de={class:"d-flex justify-content-between align-items-center"},me={class:"text-muted text-sm"},ce={class:"pagination pagination-sm m-0"},ve={class:"page-item disabled"},pe={class:"page-link"},be={class:"modal fade",id:"verifyModal"},fe={class:"modal-dialog modal-lg modal-dialog-centered modal-dialog-scrollable"},ge={key:0,class:"modal-content"},ye={class:"modal-header"},ke={class:"text-muted"},_e={class:"modal-body"},he={class:"border rounded p-2 mb-3"},xe={class:"d-flex justify-content-between"},we={class:"d-flex justify-content-between"},Ce={class:"text-danger"},je={class:"mb-3 text-center"},Be={key:0,class:"d-flex justify-content-center align-items-center",style:{height:"360px"}},Pe=["src"],Me={key:2,class:"text-muted text-sm"},Te={key:3,class:"text-danger text-sm"},Ve={class:"form-group"},$e=["value"],Le={class:"modal-footer py-2"},Se=["disabled"],Re=["disabled"],Ge={__name:"PaymentVerificationQueue",setup(Ae){const P=d.mixin({toast:!0,position:"top-end",showConfirmButton:!1,timer:2500,timerProgressBar:!0,didOpen:l=>{l.addEventListener("mouseenter",d.stopTimer),l.addEventListener("mouseleave",d.resumeTimer)}});$("#verifyModal").on("hidden.bs.modal",()=>{o.value=null,m.value="",v.value="",c.value=!0,b.value=!1});const U=()=>{c.value=!1,b.value=!0,P.fire({icon:"error",title:"Bukti pembayaran gagal dimuat"})},G=[{value:"",label:"-- Pilih template catatan --"},{value:"Bukti pembayaran tidak jelas atau buram. Mohon unggah ulang bukti pembayaran yang lebih jelas.",label:"Bukti tidak jelas / buram"},{value:"Nominal pembayaran tidak sesuai dengan tagihan yang tertera di sistem.",label:"Nominal tidak sesuai"},{value:"Bukti pembayaran bukan milik peserta yang bersangkutan.",label:"Bukti bukan milik peserta"},{value:"Pembayaran belum masuk ke rekening tujuan. Silakan konfirmasi ulang.",label:"Dana belum masuk"},{value:"Bukti pembayaran valid dan sesuai. Pembayaran disetujui.",label:"Pembayaran valid (approve)"}],v=i(""),q=()=>{v.value&&(m.value=v.value)};X();const h=i([]),s=i({}),y=i(""),k=i(10),x=i(!1),o=i(null),m=i(""),_=i(!1),c=i(!0),b=i(!1),M=l=>{o.value=null,c.value=!0,b.value=!1,setTimeout(()=>{o.value=l,$("#verifyModal").modal("show")},0)},f=async(l=1)=>{x.value=!0;try{const a=await N.get("/api/v1/payment-verifications/queue",{params:{page:l,per_page:k.value,search:y.value}});h.value=a.data.data.data,s.value=a.data.data}catch{d.fire({icon:"error",title:"Gagal",text:"Gagal memuat data pembayaran"})}finally{x.value=!1}},T=async l=>{if(l==="reject"&&!m.value.trim()){d.fire({icon:"warning",title:"Catatan wajib",text:"Catatan wajib diisi untuk reject"});return}if((await d.fire({title:l==="approve"?"Approve pembayaran?":"Reject pembayaran?",icon:"question",showCancelButton:!0,confirmButtonText:"Ya",cancelButtonText:"Batal"})).isConfirmed){_.value=!0,d.fire({title:"Memproses...",allowOutsideClick:!1,didOpen:()=>d.showLoading()});try{await N.post(`/api/v1/payment-verifications/${o.value.id}/verify`,{action:l,notes:m.value}),d.close(),m.value="",v.value="",c.value=!0,b.value=!1,o.value=null,$("#verifyModal").modal("hide"),f(s.value.current_page),P.fire({icon:"success",title:"Verifikasi pembayaran berhasil"})}catch{d.close(),d.fire({icon:"error",title:"Gagal",text:"Verifikasi pembayaran gagal"})}finally{_.value=!1}}},V=l=>Number(l).toLocaleString("id-ID");return S(y,z(()=>f(1),400)),S(k,()=>f(1)),O(f),(l,a)=>{var w;return u(),r(j,null,[a[25]||(a[25]=e("section",{class:"content-header"},[e("div",{class:"container-fluid"},[e("h1",{class:"mb-1"},"Payment Verification Queue"),e("p",{class:"mb-0 text-muted text-sm"}," Antrian pembayaran menunggu verifikasi ")])],-1)),e("section",I,[e("div",J,[e("div",Y,[e("div",Z,[e("div",K,[e("div",ee,[a[12]||(a[12]=e("label",{class:"mb-0 mr-2 text-sm text-muted"},"Tampilkan",-1)),g(e("select",{"onUpdate:modelValue":a[0]||(a[0]=t=>k.value=t),class:"form-control form-control-sm w-auto"},a[10]||(a[10]=[e("option",{value:10},"10",-1),e("option",{value:25},"25",-1),e("option",{value:50},"50",-1)]),512),[[R,k.value,void 0,{number:!0}]]),a[13]||(a[13]=e("span",{class:"text-sm text-muted ml-1 mr-3"},"Entri",-1)),e("button",{class:"btn btn-outline-secondary btn-sm",title:"Refresh data",onClick:a[1]||(a[1]=t=>f(s.value.current_page||1))},a[11]||(a[11]=[e("i",{class:"fas fa-sync"},null,-1),Q(" Refresh ")]))]),g(e("input",{"onUpdate:modelValue":a[2]||(a[2]=t=>y.value=t),class:"form-control form-control-sm w-auto",style:{"min-width":"260px"},placeholder:"Cari peserta / email"},null,512),[[A,y.value]])])]),e("div",ae,[e("table",te,[a[17]||(a[17]=e("thead",{class:"thead-light"},[e("tr",null,[e("th",{style:{width:"40px"}},"#"),e("th",null,"Peserta"),e("th",null,"Bank"),e("th",null,"Amount"),e("th",null,"Proof"),e("th",{style:{width:"120px"},class:"text-center"},"Aksi")])],-1)),e("tbody",null,[x.value?(u(),r("tr",se,a[14]||(a[14]=[e("td",{colspan:"6",class:"text-center"},"Memuat data...",-1)]))):h.value.length===0?(u(),r("tr",le,a[15]||(a[15]=[e("td",{colspan:"6",class:"text-center text-muted"}," Tidak ada pembayaran pending ",-1)]))):p("",!0),(u(!0),r(j,null,E(h.value,(t,C)=>{var L;return u(),r("tr",{key:t.id},[e("td",null,n(C+1+(s.value.current_page-1)*s.value.per_page),1),e("td",null,[e("strong",null,n(t.registration.participant.full_name),1),a[16]||(a[16]=e("br",null,null,-1)),e("small",ne,n(t.registration.participant.email),1)]),e("td",null,n(((L=t.registration.bank)==null?void 0:L.name)||"-"),1),e("td",null," Rp "+n(V(t.amount)),1),e("td",null,[e("a",{href:"#",onClick:B(F=>M(t),["prevent"])},"Lihat",8,oe)]),e("td",ie,[e("button",{class:"btn btn-primary btn-sm",onClick:F=>M(t)}," Verifikasi ",8,re)])])}),128))])])]),e("div",ue,[e("div",de,[e("div",me," Menampilkan "+n(s.value.from||0)+" - "+n(s.value.to||0)+" dari "+n(s.value.total||0)+" data ",1),e("ul",ce,[e("li",{class:D(["page-item",{disabled:s.value.current_page===1}])},[e("a",{href:"#",class:"page-link",onClick:a[3]||(a[3]=B(t=>l.changePage(s.value.current_page-1),["prevent"]))},"«")],2),e("li",ve,[e("span",pe," Halaman "+n(s.value.current_page)+" / "+n(s.value.last_page),1)]),e("li",{class:D(["page-item",{disabled:s.value.current_page===s.value.last_page}])},[e("a",{href:"#",class:"page-link",onClick:a[4]||(a[4]=B(t=>l.changePage(s.value.current_page+1),["prevent"]))},"»")],2)])])])])])]),e("div",be,[e("div",fe,[o.value?(u(),r("div",ge,[e("div",ye,[e("div",null,[a[18]||(a[18]=e("h5",{class:"mb-0"},"Verifikasi Pembayaran",-1)),e("small",ke,n(o.value.registration.participant.full_name),1)]),a[19]||(a[19]=e("button",{class:"close","data-dismiss":"modal"},"×",-1))]),e("div",_e,[e("div",he,[e("div",xe,[a[20]||(a[20]=e("span",null,"Bank",-1)),e("strong",null,n((w=o.value.registration.bank)==null?void 0:w.name),1)]),e("div",we,[a[21]||(a[21]=e("span",null,"Amount",-1)),e("strong",Ce," Rp "+n(V(o.value.amount)),1)])]),e("div",je,[c.value?(u(),r("div",Be,a[22]||(a[22]=[e("div",{class:"spinner-border text-primary"},null,-1)]))):p("",!0),o.value.cloudinary_proof_url?g((u(),r("img",{key:o.value.id,src:o.value.cloudinary_proof_url,class:"img-fluid rounded border",style:{"max-height":"360px"},onLoad:a[5]||(a[5]=t=>c.value=!1),onError:U},null,40,Pe)),[[H,!c.value]]):p("",!0),o.value.cloudinary_proof_url?p("",!0):(u(),r("div",Me," Bukti pembayaran belum tersedia ")),b.value?(u(),r("div",Te," Gagal memuat bukti pembayaran ")):p("",!0)]),e("div",Ve,[a[23]||(a[23]=e("label",{class:"text-sm"}," Catatan Verifikasi (wajib jika reject) ",-1)),g(e("select",{class:"form-control form-control-sm mb-2","onUpdate:modelValue":a[6]||(a[6]=t=>v.value=t),onChange:q},[(u(),r(j,null,E(G,(t,C)=>e("option",{key:C,value:t.value},n(t.label),9,$e)),64))],544),[[R,v.value]]),g(e("textarea",{"onUpdate:modelValue":a[7]||(a[7]=t=>m.value=t),class:"form-control form-control-sm",rows:"3",placeholder:"Catatan bisa diedit atau ditambahkan..."},null,512),[[A,m.value]])])]),e("div",Le,[a[24]||(a[24]=e("button",{class:"btn btn-secondary btn-sm","data-dismiss":"modal"}," Batal ",-1)),e("button",{class:"btn btn-danger btn-sm",disabled:_.value,onClick:a[8]||(a[8]=t=>T("reject"))}," Reject ",8,Se),e("button",{class:"btn btn-success btn-sm",disabled:_.value,onClick:a[9]||(a[9]=t=>T("approve"))}," Approve ",8,Re)])])):p("",!0)])])],64)}}};export{Ge as default};
